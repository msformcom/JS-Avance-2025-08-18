import{Subject}from"./Subject";import{dateTimestampProvider}from"./scheduler/dateTimestampProvider";class ReplaySubject extends Subject{constructor(e=1/0,i=1/0,t=dateTimestampProvider){super(),this._bufferSize=e,this._windowTime=i,this._timestampProvider=t,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=i===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,i)}next(e){var{isStopped:i,_buffer:t,_infiniteTimeWindow:r,_timestampProvider:s,_windowTime:n}=this;i||(t.push(e),r)||t.push(s.now()+n),this._trimBuffer(),super.next(e)}_subscribe(i){this._throwIfClosed(),this._trimBuffer();var e=this._innerSubscribe(i),{_infiniteTimeWindow:t,_buffer:r}=this,s=r.slice();for(let e=0;e<s.length&&!i.closed;e+=t?1:2)i.next(s[e]);return this._checkFinalizedStatuses(i),e}_trimBuffer(){var{_bufferSize:e,_timestampProvider:t,_buffer:r,_infiniteTimeWindow:i}=this,s=(i?1:2)*e;if(e<1/0&&s<r.length&&r.splice(0,r.length-s),!i){var n=t.now();let i=0;for(let e=1;e<r.length&&r[e]<=n;e+=2)i=e;i&&r.splice(0,i+1)}}}export{ReplaySubject};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9yeGpzL3NyYy9pbnRlcm5hbC9SZXBsYXlTdWJqZWN0LnRzIl0sIm5hbWVzIjpbIlN1YmplY3QiLCJkYXRlVGltZXN0YW1wUHJvdmlkZXIiLCJSZXBsYXlTdWJqZWN0IiwiY29uc3RydWN0b3IiLCJfYnVmZmVyU2l6ZSIsIkluZmluaXR5IiwiX3dpbmRvd1RpbWUiLCJfdGltZXN0YW1wUHJvdmlkZXIiLCJzdXBlciIsInRoaXMiLCJfYnVmZmVyIiwiX2luZmluaXRlVGltZVdpbmRvdyIsIk1hdGgiLCJtYXgiLCJuZXh0IiwidmFsdWUiLCJpc1N0b3BwZWQiLCJwdXNoIiwibm93IiwiX3RyaW1CdWZmZXIiLCJfc3Vic2NyaWJlIiwic3Vic2NyaWJlciIsIl90aHJvd0lmQ2xvc2VkIiwic3Vic2NyaXB0aW9uIiwiX2lubmVyU3Vic2NyaWJlIiwiY29weSIsInNsaWNlIiwibGV0IiwiaSIsImxlbmd0aCIsImNsb3NlZCIsIl9jaGVja0ZpbmFsaXplZFN0YXR1c2VzIiwiYWRqdXN0ZWRCdWZmZXJTaXplIiwic3BsaWNlIiwibGFzdCJdLCJtYXBwaW5ncyI6Ik9BQVNBLE9BQTBCLEtBQVgsbUJBSWZDLHFCQUFnRSxLQUFuQywwQ0FnQ3pCQyxzQkFBeUJGLFFBVXBDRyxZQUNVQyxFQUFjQyxFQUFBQSxFQUNkQyxFQUFjRCxFQUFBQSxFQUNkRSxFQUF3Q04sdUJBRWhETyxNQUFLLEVBSkdDLEtBQUFMLFlBQUFBLEVBQ0FLLEtBQUFILFlBQUFBLEVBQ0FHLEtBQUFGLG1CQUFBQSxFQVpGRSxLQUFBQyxRQUEwQixHQUMxQkQsS0FBQUUsb0JBQXNCLENBQUEsRUFjNUJGLEtBQUtFLG9CQUFzQkwsSUFBZ0JELEVBQUFBLEVBQzNDSSxLQUFLTCxZQUFjUSxLQUFLQyxJQUFJLEVBQUdULENBQVcsRUFDMUNLLEtBQUtILFlBQWNNLEtBQUtDLElBQUksRUFBR1AsQ0FBVyxDQUM1QyxDQUVBUSxLQUFLQyxHQUNILEdBQU0sQ0FBRUMsVUFBQUEsRUFBV04sUUFBQUEsRUFBU0Msb0JBQUFBLEVBQXFCSixtQkFBQUEsRUFBb0JELFlBQUFBLENBQVcsRUFBS0csS0FDaEZPLElBQ0hOLEVBQVFPLEtBQUtGLENBQUssRUFDakJKLElBQXVCRCxFQUFRTyxLQUFLVixFQUFtQlcsSUFBRyxFQUFLWixDQUFXLEVBRTdFRyxLQUFLVSxZQUFXLEVBQ2hCWCxNQUFNTSxLQUFLQyxDQUFLLENBQ2xCLENBR1VLLFdBQVdDLEdBQ25CWixLQUFLYSxlQUFjLEVBQ25CYixLQUFLVSxZQUFXLEVBRWhCLElBQU1JLEVBQWVkLEtBQUtlLGdCQUFnQkgsQ0FBVSxFQUU5QyxDQUFFVixvQkFBQUEsRUFBcUJELFFBQUFBLENBQU8sRUFBS0QsS0FHbkNnQixFQUFPZixFQUFRZ0IsTUFBSyxFQUMxQixJQUFLQyxJQUFJQyxFQUFJLEVBQUdBLEVBQUlILEVBQUtJLFFBQVUsQ0FBQ1IsRUFBV1MsT0FBUUYsR0FBS2pCLEVBQXNCLEVBQUksRUFDcEZVLEVBQVdQLEtBQUtXLEVBQUtHLEVBQU8sRUFLOUIsT0FGQW5CLEtBQUtzQix3QkFBd0JWLENBQVUsRUFFaENFLENBQ1QsQ0FFUUosY0FDTixHQUFNLENBQUVmLFlBQUFBLEVBQWFHLG1CQUFBQSxFQUFvQkcsUUFBQUEsRUFBU0Msb0JBQUFBLENBQW1CLEVBQUtGLEtBS3BFdUIsR0FBc0JyQixFQUFzQixFQUFJLEdBQUtQLEVBSzNELEdBSkFBLEVBQWNDLEVBQUFBLEdBQVkyQixFQUFxQnRCLEVBQVFtQixRQUFVbkIsRUFBUXVCLE9BQU8sRUFBR3ZCLEVBQVFtQixPQUFTRyxDQUFrQixFQUlsSCxDQUFDckIsRUFBcUIsQ0FDeEIsSUFBTU8sRUFBTVgsRUFBbUJXLElBQUcsRUFDbENTLElBQUlPLEVBQU8sRUFHWCxJQUFLUCxJQUFJQyxFQUFJLEVBQUdBLEVBQUlsQixFQUFRbUIsUUFBV25CLEVBQVFrQixJQUFpQlYsRUFBS1UsR0FBSyxFQUN4RU0sRUFBT04sRUFFVE0sR0FBUXhCLEVBQVF1QixPQUFPLEVBQUdDLEVBQU8sQ0FBQyxDQUNwQyxDQUNGLEMsUUF4RVdoQyxhIiwiZmlsZSI6Im5vZGVfbW9kdWxlcy9yeGpzL3NyYy9pbnRlcm5hbC9SZXBsYXlTdWJqZWN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJy4vU3ViamVjdCc7XG5pbXBvcnQgeyBUaW1lc3RhbXBQcm92aWRlciB9IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IHsgU3Vic2NyaWJlciB9IGZyb20gJy4vU3Vic2NyaWJlcic7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICcuL1N1YnNjcmlwdGlvbic7XG5pbXBvcnQgeyBkYXRlVGltZXN0YW1wUHJvdmlkZXIgfSBmcm9tICcuL3NjaGVkdWxlci9kYXRlVGltZXN0YW1wUHJvdmlkZXInO1xuXG4vKipcbiAqIEEgdmFyaWFudCBvZiB7QGxpbmsgU3ViamVjdH0gdGhhdCBcInJlcGxheXNcIiBvbGQgdmFsdWVzIHRvIG5ldyBzdWJzY3JpYmVycyBieSBlbWl0dGluZyB0aGVtIHdoZW4gdGhleSBmaXJzdCBzdWJzY3JpYmUuXG4gKlxuICogYFJlcGxheVN1YmplY3RgIGhhcyBhbiBpbnRlcm5hbCBidWZmZXIgdGhhdCB3aWxsIHN0b3JlIGEgc3BlY2lmaWVkIG51bWJlciBvZiB2YWx1ZXMgdGhhdCBpdCBoYXMgb2JzZXJ2ZWQuIExpa2UgYFN1YmplY3RgLFxuICogYFJlcGxheVN1YmplY3RgIFwib2JzZXJ2ZXNcIiB2YWx1ZXMgYnkgaGF2aW5nIHRoZW0gcGFzc2VkIHRvIGl0cyBgbmV4dGAgbWV0aG9kLiBXaGVuIGl0IG9ic2VydmVzIGEgdmFsdWUsIGl0IHdpbGwgc3RvcmUgdGhhdFxuICogdmFsdWUgZm9yIGEgdGltZSBkZXRlcm1pbmVkIGJ5IHRoZSBjb25maWd1cmF0aW9uIG9mIHRoZSBgUmVwbGF5U3ViamVjdGAsIGFzIHBhc3NlZCB0byBpdHMgY29uc3RydWN0b3IuXG4gKlxuICogV2hlbiBhIG5ldyBzdWJzY3JpYmVyIHN1YnNjcmliZXMgdG8gdGhlIGBSZXBsYXlTdWJqZWN0YCBpbnN0YW5jZSwgaXQgd2lsbCBzeW5jaHJvbm91c2x5IGVtaXQgYWxsIHZhbHVlcyBpbiBpdHMgYnVmZmVyIGluXG4gKiBhIEZpcnN0LUluLUZpcnN0LU91dCAoRklGTykgbWFubmVyLiBUaGUgYFJlcGxheVN1YmplY3RgIHdpbGwgYWxzbyBjb21wbGV0ZSwgaWYgaXQgaGFzIG9ic2VydmVkIGNvbXBsZXRpb247IGFuZCBpdCB3aWxsXG4gKiBlcnJvciBpZiBpdCBoYXMgb2JzZXJ2ZWQgYW4gZXJyb3IuXG4gKlxuICogVGhlcmUgYXJlIHR3byBtYWluIGNvbmZpZ3VyYXRpb24gaXRlbXMgdG8gYmUgY29uY2VybmVkIHdpdGg6XG4gKlxuICogMS4gYGJ1ZmZlclNpemVgIC0gVGhpcyB3aWxsIGRldGVybWluZSBob3cgbWFueSBpdGVtcyBhcmUgc3RvcmVkIGluIHRoZSBidWZmZXIsIGRlZmF1bHRzIHRvIGluZmluaXRlLlxuICogMi4gYHdpbmRvd1RpbWVgIC0gVGhlIGFtb3VudCBvZiB0aW1lIHRvIGhvbGQgYSB2YWx1ZSBpbiB0aGUgYnVmZmVyIGJlZm9yZSByZW1vdmluZyBpdCBmcm9tIHRoZSBidWZmZXIuXG4gKlxuICogQm90aCBjb25maWd1cmF0aW9ucyBtYXkgZXhpc3Qgc2ltdWx0YW5lb3VzbHkuIFNvIGlmIHlvdSB3b3VsZCBsaWtlIHRvIGJ1ZmZlciBhIG1heGltdW0gb2YgMyB2YWx1ZXMsIGFzIGxvbmcgYXMgdGhlIHZhbHVlc1xuICogYXJlIGxlc3MgdGhhbiAyIHNlY29uZHMgb2xkLCB5b3UgY291bGQgZG8gc28gd2l0aCBhIGBuZXcgUmVwbGF5U3ViamVjdCgzLCAyMDAwKWAuXG4gKlxuICogIyMjIERpZmZlcmVuY2VzIHdpdGggQmVoYXZpb3JTdWJqZWN0XG4gKlxuICogYEJlaGF2aW9yU3ViamVjdGAgaXMgc2ltaWxhciB0byBgbmV3IFJlcGxheVN1YmplY3QoMSlgLCB3aXRoIGEgY291cGxlIG9mIGV4Y2VwdGlvbnM6XG4gKlxuICogMS4gYEJlaGF2aW9yU3ViamVjdGAgY29tZXMgXCJwcmltZWRcIiB3aXRoIGEgc2luZ2xlIHZhbHVlIHVwb24gY29uc3RydWN0aW9uLlxuICogMi4gYFJlcGxheVN1YmplY3RgIHdpbGwgcmVwbGF5IHZhbHVlcywgZXZlbiBhZnRlciBvYnNlcnZpbmcgYW4gZXJyb3IsIHdoZXJlIGBCZWhhdmlvclN1YmplY3RgIHdpbGwgbm90LlxuICpcbiAqIEBzZWUge0BsaW5rIFN1YmplY3R9XG4gKiBAc2VlIHtAbGluayBCZWhhdmlvclN1YmplY3R9XG4gKiBAc2VlIHtAbGluayBzaGFyZVJlcGxheX1cbiAqL1xuZXhwb3J0IGNsYXNzIFJlcGxheVN1YmplY3Q8VD4gZXh0ZW5kcyBTdWJqZWN0PFQ+IHtcbiAgcHJpdmF0ZSBfYnVmZmVyOiAoVCB8IG51bWJlcilbXSA9IFtdO1xuICBwcml2YXRlIF9pbmZpbml0ZVRpbWVXaW5kb3cgPSB0cnVlO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gX2J1ZmZlclNpemUgVGhlIHNpemUgb2YgdGhlIGJ1ZmZlciB0byByZXBsYXkgb24gc3Vic2NyaXB0aW9uXG4gICAqIEBwYXJhbSBfd2luZG93VGltZSBUaGUgYW1vdW50IG9mIHRpbWUgdGhlIGJ1ZmZlcmVkIGl0ZW1zIHdpbGwgc3RheSBidWZmZXJlZFxuICAgKiBAcGFyYW0gX3RpbWVzdGFtcFByb3ZpZGVyIEFuIG9iamVjdCB3aXRoIGEgYG5vdygpYCBtZXRob2QgdGhhdCBwcm92aWRlcyB0aGUgY3VycmVudCB0aW1lc3RhbXAuIFRoaXMgaXMgdXNlZCB0b1xuICAgKiBjYWxjdWxhdGUgdGhlIGFtb3VudCBvZiB0aW1lIHNvbWV0aGluZyBoYXMgYmVlbiBidWZmZXJlZC5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgX2J1ZmZlclNpemUgPSBJbmZpbml0eSxcbiAgICBwcml2YXRlIF93aW5kb3dUaW1lID0gSW5maW5pdHksXG4gICAgcHJpdmF0ZSBfdGltZXN0YW1wUHJvdmlkZXI6IFRpbWVzdGFtcFByb3ZpZGVyID0gZGF0ZVRpbWVzdGFtcFByb3ZpZGVyXG4gICkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5faW5maW5pdGVUaW1lV2luZG93ID0gX3dpbmRvd1RpbWUgPT09IEluZmluaXR5O1xuICAgIHRoaXMuX2J1ZmZlclNpemUgPSBNYXRoLm1heCgxLCBfYnVmZmVyU2l6ZSk7XG4gICAgdGhpcy5fd2luZG93VGltZSA9IE1hdGgubWF4KDEsIF93aW5kb3dUaW1lKTtcbiAgfVxuXG4gIG5leHQodmFsdWU6IFQpOiB2b2lkIHtcbiAgICBjb25zdCB7IGlzU3RvcHBlZCwgX2J1ZmZlciwgX2luZmluaXRlVGltZVdpbmRvdywgX3RpbWVzdGFtcFByb3ZpZGVyLCBfd2luZG93VGltZSB9ID0gdGhpcztcbiAgICBpZiAoIWlzU3RvcHBlZCkge1xuICAgICAgX2J1ZmZlci5wdXNoKHZhbHVlKTtcbiAgICAgICFfaW5maW5pdGVUaW1lV2luZG93ICYmIF9idWZmZXIucHVzaChfdGltZXN0YW1wUHJvdmlkZXIubm93KCkgKyBfd2luZG93VGltZSk7XG4gICAgfVxuICAgIHRoaXMuX3RyaW1CdWZmZXIoKTtcbiAgICBzdXBlci5uZXh0KHZhbHVlKTtcbiAgfVxuXG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgcHJvdGVjdGVkIF9zdWJzY3JpYmUoc3Vic2NyaWJlcjogU3Vic2NyaWJlcjxUPik6IFN1YnNjcmlwdGlvbiB7XG4gICAgdGhpcy5fdGhyb3dJZkNsb3NlZCgpO1xuICAgIHRoaXMuX3RyaW1CdWZmZXIoKTtcblxuICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IHRoaXMuX2lubmVyU3Vic2NyaWJlKHN1YnNjcmliZXIpO1xuXG4gICAgY29uc3QgeyBfaW5maW5pdGVUaW1lV2luZG93LCBfYnVmZmVyIH0gPSB0aGlzO1xuICAgIC8vIFdlIHVzZSBhIGNvcHkgaGVyZSwgc28gcmVlbnRyYW50IGNvZGUgZG9lcyBub3QgbXV0YXRlIG91ciBhcnJheSB3aGlsZSB3ZSdyZVxuICAgIC8vIGVtaXR0aW5nIGl0IHRvIGEgbmV3IHN1YnNjcmliZXIuXG4gICAgY29uc3QgY29weSA9IF9idWZmZXIuc2xpY2UoKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvcHkubGVuZ3RoICYmICFzdWJzY3JpYmVyLmNsb3NlZDsgaSArPSBfaW5maW5pdGVUaW1lV2luZG93ID8gMSA6IDIpIHtcbiAgICAgIHN1YnNjcmliZXIubmV4dChjb3B5W2ldIGFzIFQpO1xuICAgIH1cblxuICAgIHRoaXMuX2NoZWNrRmluYWxpemVkU3RhdHVzZXMoc3Vic2NyaWJlcik7XG5cbiAgICByZXR1cm4gc3Vic2NyaXB0aW9uO1xuICB9XG5cbiAgcHJpdmF0ZSBfdHJpbUJ1ZmZlcigpIHtcbiAgICBjb25zdCB7IF9idWZmZXJTaXplLCBfdGltZXN0YW1wUHJvdmlkZXIsIF9idWZmZXIsIF9pbmZpbml0ZVRpbWVXaW5kb3cgfSA9IHRoaXM7XG4gICAgLy8gSWYgd2UgZG9uJ3QgaGF2ZSBhbiBpbmZpbml0ZSBidWZmZXIgc2l6ZSwgYW5kIHdlJ3JlIG92ZXIgdGhlIGxlbmd0aCxcbiAgICAvLyB1c2Ugc3BsaWNlIHRvIHRydW5jYXRlIHRoZSBvbGQgYnVmZmVyIHZhbHVlcyBvZmYuIE5vdGUgdGhhdCB3ZSBoYXZlIHRvXG4gICAgLy8gZG91YmxlIHRoZSBzaXplIGZvciBpbnN0YW5jZXMgd2hlcmUgd2UncmUgbm90IHVzaW5nIGFuIGluZmluaXRlIHRpbWUgd2luZG93XG4gICAgLy8gYmVjYXVzZSB3ZSdyZSBzdG9yaW5nIHRoZSB2YWx1ZXMgYW5kIHRoZSB0aW1lc3RhbXBzIGluIHRoZSBzYW1lIGFycmF5LlxuICAgIGNvbnN0IGFkanVzdGVkQnVmZmVyU2l6ZSA9IChfaW5maW5pdGVUaW1lV2luZG93ID8gMSA6IDIpICogX2J1ZmZlclNpemU7XG4gICAgX2J1ZmZlclNpemUgPCBJbmZpbml0eSAmJiBhZGp1c3RlZEJ1ZmZlclNpemUgPCBfYnVmZmVyLmxlbmd0aCAmJiBfYnVmZmVyLnNwbGljZSgwLCBfYnVmZmVyLmxlbmd0aCAtIGFkanVzdGVkQnVmZmVyU2l6ZSk7XG5cbiAgICAvLyBOb3csIGlmIHdlJ3JlIG5vdCBpbiBhbiBpbmZpbml0ZSB0aW1lIHdpbmRvdywgcmVtb3ZlIGFsbCB2YWx1ZXMgd2hlcmUgdGhlIHRpbWUgaXNcbiAgICAvLyBvbGRlciB0aGFuIHdoYXQgaXMgYWxsb3dlZC5cbiAgICBpZiAoIV9pbmZpbml0ZVRpbWVXaW5kb3cpIHtcbiAgICAgIGNvbnN0IG5vdyA9IF90aW1lc3RhbXBQcm92aWRlci5ub3coKTtcbiAgICAgIGxldCBsYXN0ID0gMDtcbiAgICAgIC8vIFNlYXJjaCB0aGUgYXJyYXkgZm9yIHRoZSBmaXJzdCB0aW1lc3RhbXAgdGhhdCBpc24ndCBleHBpcmVkIGFuZFxuICAgICAgLy8gdHJ1bmNhdGUgdGhlIGJ1ZmZlciB1cCB0byB0aGF0IHBvaW50LlxuICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBfYnVmZmVyLmxlbmd0aCAmJiAoX2J1ZmZlcltpXSBhcyBudW1iZXIpIDw9IG5vdzsgaSArPSAyKSB7XG4gICAgICAgIGxhc3QgPSBpO1xuICAgICAgfVxuICAgICAgbGFzdCAmJiBfYnVmZmVyLnNwbGljZSgwLCBsYXN0ICsgMSk7XG4gICAgfVxuICB9XG59XG4iXX0=
