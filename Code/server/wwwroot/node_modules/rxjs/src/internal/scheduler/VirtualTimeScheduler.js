import{AsyncAction}from"./AsyncAction";import{Subscription}from"../Subscription";import{AsyncScheduler}from"./AsyncScheduler";class VirtualTimeScheduler extends AsyncScheduler{constructor(e=VirtualAction,t=1/0){super(e,()=>this.frame),this.maxFrames=t,this.frame=0,this.index=-1}flush(){var{actions:e,maxFrames:t}=this;let i,r;for(;(r=e[0])&&r.delay<=t&&(e.shift(),this.frame=r.delay,!(i=r.execute(r.state,r.delay))););if(i){for(;r=e.shift();)r.unsubscribe();throw i}}}VirtualTimeScheduler.frameTimeFactor=10;class VirtualAction extends AsyncAction{constructor(e,t,i=e.index+=1){super(e,t),this.scheduler=e,this.work=t,this.index=i,this.active=!0,this.index=e.index=i}schedule(e,t=0){if(Number.isFinite(t)){if(!this.id)return super.schedule(e,t);this.active=!1;var i=new VirtualAction(this.scheduler,this.work);return this.add(i),i.schedule(e,t)}return Subscription.EMPTY}requestAsyncId(e,t,i=0){this.delay=e.frame+i;i=e.actions;return i.push(this),i.sort(VirtualAction.sortActions),1}recycleAsyncId(e,t,i=0){}_execute(e,t){if(!0===this.active)return super._execute(e,t)}static sortActions(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1}}export{VirtualTimeScheduler,VirtualAction};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9yeGpzL3NyYy9pbnRlcm5hbC9zY2hlZHVsZXIvVmlydHVhbFRpbWVTY2hlZHVsZXIudHMiXSwibmFtZXMiOlsiQXN5bmNBY3Rpb24iLCJTdWJzY3JpcHRpb24iLCJBc3luY1NjaGVkdWxlciIsIlZpcnR1YWxUaW1lU2NoZWR1bGVyIiwiY29uc3RydWN0b3IiLCJzY2hlZHVsZXJBY3Rpb25DdG9yIiwiVmlydHVhbEFjdGlvbiIsIm1heEZyYW1lcyIsIkluZmluaXR5Iiwic3VwZXIiLCJ0aGlzIiwiZnJhbWUiLCJpbmRleCIsImZsdXNoIiwiYWN0aW9ucyIsImxldCIsImVycm9yIiwiYWN0aW9uIiwiZGVsYXkiLCJzaGlmdCIsImV4ZWN1dGUiLCJzdGF0ZSIsInVuc3Vic2NyaWJlIiwiZnJhbWVUaW1lRmFjdG9yIiwic2NoZWR1bGVyIiwid29yayIsImFjdGl2ZSIsInNjaGVkdWxlIiwiTnVtYmVyIiwiaXNGaW5pdGUiLCJpZCIsImFkZCIsIkVNUFRZIiwicmVxdWVzdEFzeW5jSWQiLCJwdXNoIiwic29ydCIsInNvcnRBY3Rpb25zIiwicmVjeWNsZUFzeW5jSWQiLCJfZXhlY3V0ZSIsImEiLCJiIl0sIm1hcHBpbmdzIjoiT0FBU0EsV0FBa0MsS0FBZix1QkFDbkJDLFlBQXFDLEtBQWpCLHlCQUNwQkMsY0FBd0MsS0FBbEIseUJBSWxCQyw2QkFBNkJELGVBeUJ4Q0UsWUFBWUMsRUFBMENDLGNBQTZCQyxFQUFvQkMsRUFBQUEsR0FDckdDLE1BQU1KLEVBQXFCLElBQU1LLEtBQUtDLEtBQUssRUFEc0NELEtBQUFILFVBQUFBLEVBZjVFRyxLQUFBQyxNQUFnQixFQU1oQkQsS0FBQUUsTUFBZ0IsQ0FBQyxDQVd4QixDQU1PQyxRQUNMLEdBQU0sQ0FBRUMsUUFBQUEsRUFBU1AsVUFBQUEsQ0FBUyxFQUFLRyxLQUMvQkssSUFBSUMsRUFDQUMsRUFFSixNQUFRQSxFQUFTSCxFQUFRLEtBQU9HLEVBQU9DLE9BQVNYLElBQzlDTyxFQUFRSyxNQUFLLEVBQ2JULEtBQUtDLE1BQVFNLEVBQU9DLE1BRWhCLEVBQUNGLEVBQVFDLEVBQU9HLFFBQVFILEVBQU9JLE1BQU9KLEVBQU9DLEtBQUssTUFLeEQsR0FBSUYsRUFBTyxDQUNULEtBQVFDLEVBQVNILEVBQVFLLE1BQUssR0FDNUJGLEVBQU9LLFlBQVcsRUFFcEIsTUFBTU4sQ0FDUixDQUNGLEMsQ0FuRE9iLHFCQUFBb0IsZ0JBQWtCLFNBc0RkakIsc0JBQXlCTixZQUdwQ0ksWUFDWW9CLEVBQ0FDLEVBQ0FiLEVBQWlCWSxFQUFVWixPQUFTLEdBRTlDSCxNQUFNZSxFQUFXQyxDQUFJLEVBSlhmLEtBQUFjLFVBQUFBLEVBQ0FkLEtBQUFlLEtBQUFBLEVBQ0FmLEtBQUFFLE1BQUFBLEVBTEZGLEtBQUFnQixPQUFrQixDQUFBLEVBUTFCaEIsS0FBS0UsTUFBUVksRUFBVVosTUFBUUEsQ0FDakMsQ0FFT2UsU0FBU04sRUFBV0gsRUFBZ0IsR0FDekMsR0FBSVUsT0FBT0MsU0FBU1gsQ0FBSyxFQUFHLENBQzFCLEdBQUksQ0FBQ1IsS0FBS29CLEdBQ1IsT0FBT3JCLE1BQU1rQixTQUFTTixFQUFPSCxDQUFLLEVBRXBDUixLQUFLZ0IsT0FBUyxDQUFBLEVBS2QsSUFBTVQsRUFBUyxJQUFJWCxjQUFjSSxLQUFLYyxVQUFXZCxLQUFLZSxJQUFJLEVBRTFELE9BREFmLEtBQUtxQixJQUFJZCxDQUFNLEVBQ1JBLEVBQU9VLFNBQVNOLEVBQU9ILENBQUssQ0FDckMsQ0FHRSxPQUFPakIsYUFBYStCLEtBRXhCLENBRVVDLGVBQWVULEVBQWlDTSxFQUFVWixFQUFnQixHQUNsRlIsS0FBS1EsTUFBUU0sRUFBVWIsTUFBUU8sRUFDdkJKLEVBQVlVLEVBQUwsUUFHZixPQUZBVixFQUFRb0IsS0FBS3hCLElBQUksRUFDaEJJLEVBQW9DcUIsS0FBSzdCLGNBQWM4QixXQUFXLEVBQzVELENBQ1QsQ0FFVUMsZUFBZWIsRUFBaUNNLEVBQVVaLEVBQUFBLElBSTFEb0IsU0FBU2pCLEVBQVVILEdBQzNCLEdBQW9CLENBQUEsSUFBaEJSLEtBQUtnQixPQUNQLE9BQU9qQixNQUFNNkIsU0FBU2pCLEVBQU9ILENBQUssQ0FFdEMsQ0FFUWtCLG1CQUFzQkcsRUFBcUJDLEdBQ2pELE9BQUlELEVBQUVyQixRQUFVc0IsRUFBRXRCLE1BQ1pxQixFQUFFM0IsUUFBVTRCLEVBQUU1QixNQUNULEVBQ0UyQixFQUFFM0IsTUFBUTRCLEVBQUU1QixNQUNkLEVBRUEsQ0FBQyxFQUVEMkIsRUFBRXJCLE1BQVFzQixFQUFFdEIsTUFDZCxFQUVBLENBQUMsQ0FFWixDLFFBeEhXZixxQkF3REFHLGEiLCJmaWxlIjoibm9kZV9tb2R1bGVzL3J4anMvc3JjL2ludGVybmFsL3NjaGVkdWxlci9WaXJ0dWFsVGltZVNjaGVkdWxlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFzeW5jQWN0aW9uIH0gZnJvbSAnLi9Bc3luY0FjdGlvbic7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICcuLi9TdWJzY3JpcHRpb24nO1xuaW1wb3J0IHsgQXN5bmNTY2hlZHVsZXIgfSBmcm9tICcuL0FzeW5jU2NoZWR1bGVyJztcbmltcG9ydCB7IFNjaGVkdWxlckFjdGlvbiB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7IFRpbWVySGFuZGxlIH0gZnJvbSAnLi90aW1lckhhbmRsZSc7XG5cbmV4cG9ydCBjbGFzcyBWaXJ0dWFsVGltZVNjaGVkdWxlciBleHRlbmRzIEFzeW5jU2NoZWR1bGVyIHtcbiAgLyoqIEBkZXByZWNhdGVkIE5vdCB1c2VkIGluIFZpcnR1YWxUaW1lU2NoZWR1bGVyIGRpcmVjdGx5LiBXaWxsIGJlIHJlbW92ZWQgaW4gdjguICovXG4gIHN0YXRpYyBmcmFtZVRpbWVGYWN0b3IgPSAxMDtcblxuICAvKipcbiAgICogVGhlIGN1cnJlbnQgZnJhbWUgZm9yIHRoZSBzdGF0ZSBvZiB0aGUgdmlydHVhbCBzY2hlZHVsZXIgaW5zdGFuY2UuIFRoZSBkaWZmZXJlbmNlXG4gICAqIGJldHdlZW4gdHdvIFwiZnJhbWVzXCIgaXMgc3lub255bW91cyB3aXRoIHRoZSBwYXNzYWdlIG9mIFwidmlydHVhbCB0aW1lIHVuaXRzXCIuIFNvIGlmXG4gICAqIHlvdSByZWNvcmQgYHNjaGVkdWxlci5mcmFtZWAgdG8gYmUgYDFgLCB0aGVuIGxhdGVyLCBvYnNlcnZlIGBzY2hlZHVsZXIuZnJhbWVgIHRvIGJlIGF0IGAxMWAsXG4gICAqIHRoYXQgbWVhbnMgYDEwYCB2aXJ0dWFsIHRpbWUgdW5pdHMgaGF2ZSBwYXNzZWQuXG4gICAqL1xuICBwdWJsaWMgZnJhbWU6IG51bWJlciA9IDA7XG5cbiAgLyoqXG4gICAqIFVzZWQgaW50ZXJuYWxseSB0byBleGFtaW5lIHRoZSBjdXJyZW50IHZpcnR1YWwgYWN0aW9uIGluZGV4IGJlaW5nIHByb2Nlc3NlZC5cbiAgICogQGRlcHJlY2F0ZWQgSW50ZXJuYWwgaW1wbGVtZW50YXRpb24gZGV0YWlsLCBkbyBub3QgdXNlIGRpcmVjdGx5LiBXaWxsIGJlIG1hZGUgaW50ZXJuYWwgaW4gdjguXG4gICAqL1xuICBwdWJsaWMgaW5kZXg6IG51bWJlciA9IC0xO1xuXG4gIC8qKlxuICAgKiBUaGlzIGNyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgYSBgVmlydHVhbFRpbWVTY2hlZHVsZXJgLiBFeHBlcnRzIG9ubHkuIFRoZSBzaWduYXR1cmUgb2ZcbiAgICogdGhpcyBjb25zdHJ1Y3RvciBpcyBsaWtlbHkgdG8gY2hhbmdlIGluIHRoZSBsb25nIHJ1bi5cbiAgICpcbiAgICogQHBhcmFtIHNjaGVkdWxlckFjdGlvbkN0b3IgVGhlIHR5cGUgb2YgQWN0aW9uIHRvIGluaXRpYWxpemUgd2hlbiBpbml0aWFsaXppbmcgYWN0aW9ucyBkdXJpbmcgc2NoZWR1bGluZy5cbiAgICogQHBhcmFtIG1heEZyYW1lcyBUaGUgbWF4aW11bSBudW1iZXIgb2YgZnJhbWVzIHRvIHByb2Nlc3MgYmVmb3JlIHN0b3BwaW5nLiBVc2VkIHRvIHByZXZlbnQgZW5kbGVzcyBmbHVzaCBjeWNsZXMuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihzY2hlZHVsZXJBY3Rpb25DdG9yOiB0eXBlb2YgQXN5bmNBY3Rpb24gPSBWaXJ0dWFsQWN0aW9uIGFzIGFueSwgcHVibGljIG1heEZyYW1lczogbnVtYmVyID0gSW5maW5pdHkpIHtcbiAgICBzdXBlcihzY2hlZHVsZXJBY3Rpb25DdG9yLCAoKSA9PiB0aGlzLmZyYW1lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcm9tcHQgdGhlIFNjaGVkdWxlciB0byBleGVjdXRlIGFsbCBvZiBpdHMgcXVldWVkIGFjdGlvbnMsIHRoZXJlZm9yZVxuICAgKiBjbGVhcmluZyBpdHMgcXVldWUuXG4gICAqL1xuICBwdWJsaWMgZmx1c2goKTogdm9pZCB7XG4gICAgY29uc3QgeyBhY3Rpb25zLCBtYXhGcmFtZXMgfSA9IHRoaXM7XG4gICAgbGV0IGVycm9yOiBhbnk7XG4gICAgbGV0IGFjdGlvbjogQXN5bmNBY3Rpb248YW55PiB8IHVuZGVmaW5lZDtcblxuICAgIHdoaWxlICgoYWN0aW9uID0gYWN0aW9uc1swXSkgJiYgYWN0aW9uLmRlbGF5IDw9IG1heEZyYW1lcykge1xuICAgICAgYWN0aW9ucy5zaGlmdCgpO1xuICAgICAgdGhpcy5mcmFtZSA9IGFjdGlvbi5kZWxheTtcblxuICAgICAgaWYgKChlcnJvciA9IGFjdGlvbi5leGVjdXRlKGFjdGlvbi5zdGF0ZSwgYWN0aW9uLmRlbGF5KSkpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICB3aGlsZSAoKGFjdGlvbiA9IGFjdGlvbnMuc2hpZnQoKSkpIHtcbiAgICAgICAgYWN0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFZpcnR1YWxBY3Rpb248VD4gZXh0ZW5kcyBBc3luY0FjdGlvbjxUPiB7XG4gIHByb3RlY3RlZCBhY3RpdmU6IGJvb2xlYW4gPSB0cnVlO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByb3RlY3RlZCBzY2hlZHVsZXI6IFZpcnR1YWxUaW1lU2NoZWR1bGVyLFxuICAgIHByb3RlY3RlZCB3b3JrOiAodGhpczogU2NoZWR1bGVyQWN0aW9uPFQ+LCBzdGF0ZT86IFQpID0+IHZvaWQsXG4gICAgcHJvdGVjdGVkIGluZGV4OiBudW1iZXIgPSAoc2NoZWR1bGVyLmluZGV4ICs9IDEpXG4gICkge1xuICAgIHN1cGVyKHNjaGVkdWxlciwgd29yayk7XG4gICAgdGhpcy5pbmRleCA9IHNjaGVkdWxlci5pbmRleCA9IGluZGV4O1xuICB9XG5cbiAgcHVibGljIHNjaGVkdWxlKHN0YXRlPzogVCwgZGVsYXk6IG51bWJlciA9IDApOiBTdWJzY3JpcHRpb24ge1xuICAgIGlmIChOdW1iZXIuaXNGaW5pdGUoZGVsYXkpKSB7XG4gICAgICBpZiAoIXRoaXMuaWQpIHtcbiAgICAgICAgcmV0dXJuIHN1cGVyLnNjaGVkdWxlKHN0YXRlLCBkZWxheSk7XG4gICAgICB9XG4gICAgICB0aGlzLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgLy8gSWYgYW4gYWN0aW9uIGlzIHJlc2NoZWR1bGVkLCB3ZSBzYXZlIGFsbG9jYXRpb25zIGJ5IG11dGF0aW5nIGl0cyBzdGF0ZSxcbiAgICAgIC8vIHB1c2hpbmcgaXQgdG8gdGhlIGVuZCBvZiB0aGUgc2NoZWR1bGVyIHF1ZXVlLCBhbmQgcmVjeWNsaW5nIHRoZSBhY3Rpb24uXG4gICAgICAvLyBCdXQgc2luY2UgdGhlIFZpcnR1YWxUaW1lU2NoZWR1bGVyIGlzIHVzZWQgZm9yIHRlc3RpbmcsIFZpcnR1YWxBY3Rpb25zXG4gICAgICAvLyBtdXN0IGJlIGltbXV0YWJsZSBzbyB0aGV5IGNhbiBiZSBpbnNwZWN0ZWQgbGF0ZXIuXG4gICAgICBjb25zdCBhY3Rpb24gPSBuZXcgVmlydHVhbEFjdGlvbih0aGlzLnNjaGVkdWxlciwgdGhpcy53b3JrKTtcbiAgICAgIHRoaXMuYWRkKGFjdGlvbik7XG4gICAgICByZXR1cm4gYWN0aW9uLnNjaGVkdWxlKHN0YXRlLCBkZWxheSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIElmIHNvbWVvbmUgc2NoZWR1bGVzIHNvbWV0aGluZyB3aXRoIEluZmluaXR5LCBpdCdsbCBuZXZlciBoYXBwZW4uIFNvIHdlXG4gICAgICAvLyBkb24ndCBldmVuIHNjaGVkdWxlIGl0LlxuICAgICAgcmV0dXJuIFN1YnNjcmlwdGlvbi5FTVBUWTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgcmVxdWVzdEFzeW5jSWQoc2NoZWR1bGVyOiBWaXJ0dWFsVGltZVNjaGVkdWxlciwgaWQ/OiBhbnksIGRlbGF5OiBudW1iZXIgPSAwKTogVGltZXJIYW5kbGUge1xuICAgIHRoaXMuZGVsYXkgPSBzY2hlZHVsZXIuZnJhbWUgKyBkZWxheTtcbiAgICBjb25zdCB7IGFjdGlvbnMgfSA9IHNjaGVkdWxlcjtcbiAgICBhY3Rpb25zLnB1c2godGhpcyk7XG4gICAgKGFjdGlvbnMgYXMgQXJyYXk8VmlydHVhbEFjdGlvbjxUPj4pLnNvcnQoVmlydHVhbEFjdGlvbi5zb3J0QWN0aW9ucyk7XG4gICAgcmV0dXJuIDE7XG4gIH1cblxuICBwcm90ZWN0ZWQgcmVjeWNsZUFzeW5jSWQoc2NoZWR1bGVyOiBWaXJ0dWFsVGltZVNjaGVkdWxlciwgaWQ/OiBhbnksIGRlbGF5OiBudW1iZXIgPSAwKTogVGltZXJIYW5kbGUgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBwcm90ZWN0ZWQgX2V4ZWN1dGUoc3RhdGU6IFQsIGRlbGF5OiBudW1iZXIpOiBhbnkge1xuICAgIGlmICh0aGlzLmFjdGl2ZSA9PT0gdHJ1ZSkge1xuICAgICAgcmV0dXJuIHN1cGVyLl9leGVjdXRlKHN0YXRlLCBkZWxheSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgc29ydEFjdGlvbnM8VD4oYTogVmlydHVhbEFjdGlvbjxUPiwgYjogVmlydHVhbEFjdGlvbjxUPikge1xuICAgIGlmIChhLmRlbGF5ID09PSBiLmRlbGF5KSB7XG4gICAgICBpZiAoYS5pbmRleCA9PT0gYi5pbmRleCkge1xuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH0gZWxzZSBpZiAoYS5pbmRleCA+IGIuaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIDE7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gLTE7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChhLmRlbGF5ID4gYi5kZWxheSkge1xuICAgICAgcmV0dXJuIDE7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==
