import{Action}from"./Action";import{intervalProvider}from"./intervalProvider";import{arrRemove}from"../util/arrRemove";class AsyncAction extends Action{constructor(e,i){super(e,i),this.scheduler=e,this.work=i,this.pending=!1}schedule(e,i=0){var t;return this.closed||(this.state=e,e=this.id,t=this.scheduler,null!=e&&(this.id=this.recycleAsyncId(t,e,i)),this.pending=!0,this.delay=i,this.id=this.id??this.requestAsyncId(t,this.id,i)),this}requestAsyncId(e,i,t=0){return intervalProvider.setInterval(e.flush.bind(e,this),t)}recycleAsyncId(e,i,t=0){if(null!=t&&this.delay===t&&!1===this.pending)return i;null!=i&&intervalProvider.clearInterval(i)}execute(e,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;e=this._execute(e,i);if(e)return e;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,i){let t=!1,s;try{this.work(e)}catch(e){t=!0,s=e||new Error("Scheduled action threw falsy error")}if(t)return this.unsubscribe(),s}unsubscribe(){var e,i,t;this.closed||({id:e,scheduler:i}=this,t=i.actions,this.work=this.state=this.scheduler=null,this.pending=!1,arrRemove(t,this),null!=e&&(this.id=this.recycleAsyncId(i,e,null)),this.delay=null,super.unsubscribe())}}export{AsyncAction};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9yeGpzL3NyYy9pbnRlcm5hbC9zY2hlZHVsZXIvQXN5bmNBY3Rpb24udHMiXSwibmFtZXMiOlsiQWN0aW9uIiwiaW50ZXJ2YWxQcm92aWRlciIsImFyclJlbW92ZSIsIkFzeW5jQWN0aW9uIiwiY29uc3RydWN0b3IiLCJzY2hlZHVsZXIiLCJ3b3JrIiwic3VwZXIiLCJ0aGlzIiwicGVuZGluZyIsInNjaGVkdWxlIiwic3RhdGUiLCJkZWxheSIsImNsb3NlZCIsImlkIiwicmVjeWNsZUFzeW5jSWQiLCJyZXF1ZXN0QXN5bmNJZCIsIl9pZCIsInNldEludGVydmFsIiwiZmx1c2giLCJiaW5kIiwiX3NjaGVkdWxlciIsImNsZWFySW50ZXJ2YWwiLCJleGVjdXRlIiwiRXJyb3IiLCJlcnJvciIsIl9leGVjdXRlIiwiX2RlbGF5IiwibGV0IiwiZXJyb3JlZCIsImVycm9yVmFsdWUiLCJlIiwidW5zdWJzY3JpYmUiLCJhY3Rpb25zIl0sIm1hcHBpbmdzIjoiT0FBU0EsTUFBd0IsS0FBVixrQkFJZEMsZ0JBQTRDLEtBQXBCLDRCQUN4QkMsU0FBb0MsS0FBbkIsMEJBR2JDLG9CQUF1QkgsT0FPbENJLFlBQXNCQyxFQUFxQ0MsR0FDekRDLE1BQU1GLEVBQVdDLENBQUksRUFEREUsS0FBQUgsVUFBQUEsRUFBcUNHLEtBQUFGLEtBQUFBLEVBRmpERSxLQUFBQyxRQUFtQixDQUFBLENBSTdCLENBRU9DLFNBQVNDLEVBQVdDLEVBQWdCLEdBQ3pDLElBUU1QLEVBbUNOLE9BM0NJRyxLQUFLSyxTQUtUTCxLQUFLRyxNQUFRQSxFQUVQRyxFQUFLTixLQUFLTSxHQUNWVCxFQUFZRyxLQUFLSCxVQXVCYixNQUFOUyxJQUNGTixLQUFLTSxHQUFLTixLQUFLTyxlQUFlVixFQUFXUyxFQUFJRixDQUFLLEdBS3BESixLQUFLQyxRQUFVLENBQUEsRUFFZkQsS0FBS0ksTUFBUUEsRUFFYkosS0FBS00sR0FBS04sS0FBS00sSUFBTU4sS0FBS1EsZUFBZVgsRUFBV0csS0FBS00sR0FBSUYsQ0FBSyxHQUUzREosSUFDVCxDQUVVUSxlQUFlWCxFQUEyQlksRUFBbUJMLEVBQWdCLEdBQ3JGLE9BQU9YLGlCQUFpQmlCLFlBQVliLEVBQVVjLE1BQU1DLEtBQUtmLEVBQVdHLElBQUksRUFBR0ksQ0FBSyxDQUNsRixDQUVVRyxlQUFlTSxFQUE0QlAsRUFBa0JGLEVBQXVCLEdBRTVGLEdBQWEsTUFBVEEsR0FBaUJKLEtBQUtJLFFBQVVBLEdBQTBCLENBQUEsSUFBakJKLEtBQUtDLFFBQ2hELE9BQU9LLEVBSUMsTUFBTkEsR0FDRmIsaUJBQWlCcUIsY0FBY1IsQ0FBRSxDQUlyQyxDQUtPUyxRQUFRWixFQUFVQyxHQUN2QixHQUFJSixLQUFLSyxPQUNQLE9BQU8sSUFBSVcsTUFBTSw4QkFBOEIsRUFHakRoQixLQUFLQyxRQUFVLENBQUEsRUFDVGdCLEVBQVFqQixLQUFLa0IsU0FBU2YsRUFBT0MsQ0FBSyxFQUN4QyxHQUFJYSxFQUNGLE9BQU9BLEVBQ21CLENBQUEsSUFBakJqQixLQUFLQyxTQUFnQyxNQUFYRCxLQUFLTSxLQWN4Q04sS0FBS00sR0FBS04sS0FBS08sZUFBZVAsS0FBS0gsVUFBV0csS0FBS00sR0FBSSxJQUFJLEVBRS9ELENBRVVZLFNBQVNmLEVBQVVnQixHQUMzQkMsSUFBSUMsRUFBbUIsQ0FBQSxFQUNuQkMsRUFDSixJQUNFdEIsS0FBS0YsS0FBS0ssQ0FBSyxDQU9qQixDQU5FLE1BQU9vQixHQUNQRixFQUFVLENBQUEsRUFJVkMsRUFBYUMsR0FBUSxJQUFJUCxNQUFNLG9DQUFvQyxDQUNyRSxDQUNBLEdBQUlLLEVBRUYsT0FEQXJCLEtBQUt3QixZQUFXLEVBQ1RGLENBRVgsQ0FFQUUsY0FDRSxJQUNVbEIsRUFBSVQsRUFDSjRCLEVBRkx6QixLQUFLSyxTQUNGLENBQUVDLEdBQUFBLEVBQUlULFVBQUFBLENBQVMsRUFBS0csS0FDbEJ5QixFQUFZNUIsRUFBTCxRQUVmRyxLQUFLRixLQUFPRSxLQUFLRyxNQUFRSCxLQUFLSCxVQUFZLEtBQzFDRyxLQUFLQyxRQUFVLENBQUEsRUFFZlAsVUFBVStCLEVBQVN6QixJQUFJLEVBQ2IsTUFBTk0sSUFDRk4sS0FBS00sR0FBS04sS0FBS08sZUFBZVYsRUFBV1MsRUFBSSxJQUFJLEdBR25ETixLQUFLSSxNQUFRLEtBQ2JMLE1BQU15QixZQUFXLEVBRXJCLEMsUUE1SVc3QixXIiwiZmlsZSI6Im5vZGVfbW9kdWxlcy9yeGpzL3NyYy9pbnRlcm5hbC9zY2hlZHVsZXIvQXN5bmNBY3Rpb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBY3Rpb24gfSBmcm9tICcuL0FjdGlvbic7XG5pbXBvcnQgeyBTY2hlZHVsZXJBY3Rpb24gfSBmcm9tICcuLi90eXBlcyc7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICcuLi9TdWJzY3JpcHRpb24nO1xuaW1wb3J0IHsgQXN5bmNTY2hlZHVsZXIgfSBmcm9tICcuL0FzeW5jU2NoZWR1bGVyJztcbmltcG9ydCB7IGludGVydmFsUHJvdmlkZXIgfSBmcm9tICcuL2ludGVydmFsUHJvdmlkZXInO1xuaW1wb3J0IHsgYXJyUmVtb3ZlIH0gZnJvbSAnLi4vdXRpbC9hcnJSZW1vdmUnO1xuaW1wb3J0IHsgVGltZXJIYW5kbGUgfSBmcm9tICcuL3RpbWVySGFuZGxlJztcblxuZXhwb3J0IGNsYXNzIEFzeW5jQWN0aW9uPFQ+IGV4dGVuZHMgQWN0aW9uPFQ+IHtcbiAgcHVibGljIGlkOiBUaW1lckhhbmRsZSB8IHVuZGVmaW5lZDtcbiAgcHVibGljIHN0YXRlPzogVDtcbiAgLy8gQHRzLWlnbm9yZTogUHJvcGVydHkgaGFzIG5vIGluaXRpYWxpemVyIGFuZCBpcyBub3QgZGVmaW5pdGVseSBhc3NpZ25lZFxuICBwdWJsaWMgZGVsYXk6IG51bWJlcjtcbiAgcHJvdGVjdGVkIHBlbmRpbmc6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgc2NoZWR1bGVyOiBBc3luY1NjaGVkdWxlciwgcHJvdGVjdGVkIHdvcms6ICh0aGlzOiBTY2hlZHVsZXJBY3Rpb248VD4sIHN0YXRlPzogVCkgPT4gdm9pZCkge1xuICAgIHN1cGVyKHNjaGVkdWxlciwgd29yayk7XG4gIH1cblxuICBwdWJsaWMgc2NoZWR1bGUoc3RhdGU/OiBULCBkZWxheTogbnVtYmVyID0gMCk6IFN1YnNjcmlwdGlvbiB7XG4gICAgaWYgKHRoaXMuY2xvc2VkKSB7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvLyBBbHdheXMgcmVwbGFjZSB0aGUgY3VycmVudCBzdGF0ZSB3aXRoIHRoZSBuZXcgc3RhdGUuXG4gICAgdGhpcy5zdGF0ZSA9IHN0YXRlO1xuXG4gICAgY29uc3QgaWQgPSB0aGlzLmlkO1xuICAgIGNvbnN0IHNjaGVkdWxlciA9IHRoaXMuc2NoZWR1bGVyO1xuXG4gICAgLy9cbiAgICAvLyBJbXBvcnRhbnQgaW1wbGVtZW50YXRpb24gbm90ZTpcbiAgICAvL1xuICAgIC8vIEFjdGlvbnMgb25seSBleGVjdXRlIG9uY2UgYnkgZGVmYXVsdCwgdW5sZXNzIHJlc2NoZWR1bGVkIGZyb20gd2l0aGluIHRoZVxuICAgIC8vIHNjaGVkdWxlZCBjYWxsYmFjay4gVGhpcyBhbGxvd3MgdXMgdG8gaW1wbGVtZW50IHNpbmdsZSBhbmQgcmVwZWF0XG4gICAgLy8gYWN0aW9ucyB2aWEgdGhlIHNhbWUgY29kZSBwYXRoLCB3aXRob3V0IGFkZGluZyBBUEkgc3VyZmFjZSBhcmVhLCBhcyB3ZWxsXG4gICAgLy8gYXMgbWltaWMgdHJhZGl0aW9uYWwgcmVjdXJzaW9uIGJ1dCBhY3Jvc3MgYXN5bmNocm9ub3VzIGJvdW5kYXJpZXMuXG4gICAgLy9cbiAgICAvLyBIb3dldmVyLCBKUyBydW50aW1lcyBhbmQgdGltZXJzIGRpc3Rpbmd1aXNoIGJldHdlZW4gaW50ZXJ2YWxzIGFjaGlldmVkIGJ5XG4gICAgLy8gc2VyaWFsIGBzZXRUaW1lb3V0YCBjYWxscyB2cy4gYSBzaW5nbGUgYHNldEludGVydmFsYCBjYWxsLiBBbiBpbnRlcnZhbCBvZlxuICAgIC8vIHNlcmlhbCBgc2V0VGltZW91dGAgY2FsbHMgY2FuIGJlIGluZGl2aWR1YWxseSBkZWxheWVkLCB3aGljaCBkZWxheXNcbiAgICAvLyBzY2hlZHVsaW5nIHRoZSBuZXh0IGBzZXRUaW1lb3V0YCwgYW5kIHNvIG9uLiBgc2V0SW50ZXJ2YWxgIGF0dGVtcHRzIHRvXG4gICAgLy8gZ3VhcmFudGVlIHRoZSBpbnRlcnZhbCBjYWxsYmFjayB3aWxsIGJlIGludm9rZWQgbW9yZSBwcmVjaXNlbHkgdG8gdGhlXG4gICAgLy8gaW50ZXJ2YWwgcGVyaW9kLCByZWdhcmRsZXNzIG9mIGxvYWQuXG4gICAgLy9cbiAgICAvLyBUaGVyZWZvcmUsIHdlIHVzZSBgc2V0SW50ZXJ2YWxgIHRvIHNjaGVkdWxlIHNpbmdsZSBhbmQgcmVwZWF0IGFjdGlvbnMuXG4gICAgLy8gSWYgdGhlIGFjdGlvbiByZXNjaGVkdWxlcyBpdHNlbGYgd2l0aCB0aGUgc2FtZSBkZWxheSwgdGhlIGludGVydmFsIGlzIG5vdFxuICAgIC8vIGNhbmNlbGVkLiBJZiB0aGUgYWN0aW9uIGRvZXNuJ3QgcmVzY2hlZHVsZSwgb3IgcmVzY2hlZHVsZXMgd2l0aCBhXG4gICAgLy8gZGlmZmVyZW50IGRlbGF5LCB0aGUgaW50ZXJ2YWwgd2lsbCBiZSBjYW5jZWxlZCBhZnRlciBzY2hlZHVsZWQgY2FsbGJhY2tcbiAgICAvLyBleGVjdXRpb24uXG4gICAgLy9cbiAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgdGhpcy5pZCA9IHRoaXMucmVjeWNsZUFzeW5jSWQoc2NoZWR1bGVyLCBpZCwgZGVsYXkpO1xuICAgIH1cblxuICAgIC8vIFNldCB0aGUgcGVuZGluZyBmbGFnIGluZGljYXRpbmcgdGhhdCB0aGlzIGFjdGlvbiBoYXMgYmVlbiBzY2hlZHVsZWQsIG9yXG4gICAgLy8gaGFzIHJlY3Vyc2l2ZWx5IHJlc2NoZWR1bGVkIGl0c2VsZi5cbiAgICB0aGlzLnBlbmRpbmcgPSB0cnVlO1xuXG4gICAgdGhpcy5kZWxheSA9IGRlbGF5O1xuICAgIC8vIElmIHRoaXMgYWN0aW9uIGhhcyBhbHJlYWR5IGFuIGFzeW5jIElkLCBkb24ndCByZXF1ZXN0IGEgbmV3IG9uZS5cbiAgICB0aGlzLmlkID0gdGhpcy5pZCA/PyB0aGlzLnJlcXVlc3RBc3luY0lkKHNjaGVkdWxlciwgdGhpcy5pZCwgZGVsYXkpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBwcm90ZWN0ZWQgcmVxdWVzdEFzeW5jSWQoc2NoZWR1bGVyOiBBc3luY1NjaGVkdWxlciwgX2lkPzogVGltZXJIYW5kbGUsIGRlbGF5OiBudW1iZXIgPSAwKTogVGltZXJIYW5kbGUge1xuICAgIHJldHVybiBpbnRlcnZhbFByb3ZpZGVyLnNldEludGVydmFsKHNjaGVkdWxlci5mbHVzaC5iaW5kKHNjaGVkdWxlciwgdGhpcyksIGRlbGF5KTtcbiAgfVxuXG4gIHByb3RlY3RlZCByZWN5Y2xlQXN5bmNJZChfc2NoZWR1bGVyOiBBc3luY1NjaGVkdWxlciwgaWQ/OiBUaW1lckhhbmRsZSwgZGVsYXk6IG51bWJlciB8IG51bGwgPSAwKTogVGltZXJIYW5kbGUgfCB1bmRlZmluZWQge1xuICAgIC8vIElmIHRoaXMgYWN0aW9uIGlzIHJlc2NoZWR1bGVkIHdpdGggdGhlIHNhbWUgZGVsYXkgdGltZSwgZG9uJ3QgY2xlYXIgdGhlIGludGVydmFsIGlkLlxuICAgIGlmIChkZWxheSAhPSBudWxsICYmIHRoaXMuZGVsYXkgPT09IGRlbGF5ICYmIHRoaXMucGVuZGluZyA9PT0gZmFsc2UpIHtcbiAgICAgIHJldHVybiBpZDtcbiAgICB9XG4gICAgLy8gT3RoZXJ3aXNlLCBpZiB0aGUgYWN0aW9uJ3MgZGVsYXkgdGltZSBpcyBkaWZmZXJlbnQgZnJvbSB0aGUgY3VycmVudCBkZWxheSxcbiAgICAvLyBvciB0aGUgYWN0aW9uIGhhcyBiZWVuIHJlc2NoZWR1bGVkIGJlZm9yZSBpdCdzIGV4ZWN1dGVkLCBjbGVhciB0aGUgaW50ZXJ2YWwgaWRcbiAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgaW50ZXJ2YWxQcm92aWRlci5jbGVhckludGVydmFsKGlkKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgLyoqXG4gICAqIEltbWVkaWF0ZWx5IGV4ZWN1dGVzIHRoaXMgYWN0aW9uIGFuZCB0aGUgYHdvcmtgIGl0IGNvbnRhaW5zLlxuICAgKi9cbiAgcHVibGljIGV4ZWN1dGUoc3RhdGU6IFQsIGRlbGF5OiBudW1iZXIpOiBhbnkge1xuICAgIGlmICh0aGlzLmNsb3NlZCkge1xuICAgICAgcmV0dXJuIG5ldyBFcnJvcignZXhlY3V0aW5nIGEgY2FuY2VsbGVkIGFjdGlvbicpO1xuICAgIH1cblxuICAgIHRoaXMucGVuZGluZyA9IGZhbHNlO1xuICAgIGNvbnN0IGVycm9yID0gdGhpcy5fZXhlY3V0ZShzdGF0ZSwgZGVsYXkpO1xuICAgIGlmIChlcnJvcikge1xuICAgICAgcmV0dXJuIGVycm9yO1xuICAgIH0gZWxzZSBpZiAodGhpcy5wZW5kaW5nID09PSBmYWxzZSAmJiB0aGlzLmlkICE9IG51bGwpIHtcbiAgICAgIC8vIERlcXVldWUgaWYgdGhlIGFjdGlvbiBkaWRuJ3QgcmVzY2hlZHVsZSBpdHNlbGYuIERvbid0IGNhbGxcbiAgICAgIC8vIHVuc3Vic2NyaWJlKCksIGJlY2F1c2UgdGhlIGFjdGlvbiBjb3VsZCByZXNjaGVkdWxlIGxhdGVyLlxuICAgICAgLy8gRm9yIGV4YW1wbGU6XG4gICAgICAvLyBgYGBcbiAgICAgIC8vIHNjaGVkdWxlci5zY2hlZHVsZShmdW5jdGlvbiBkb1dvcmsoY291bnRlcikge1xuICAgICAgLy8gICAvKiAuLi4gSSdtIGEgYnVzeSB3b3JrZXIgYmVlIC4uLiAqL1xuICAgICAgLy8gICB2YXIgb3JpZ2luYWxBY3Rpb24gPSB0aGlzO1xuICAgICAgLy8gICAvKiB3YWl0IDEwMG1zIGJlZm9yZSByZXNjaGVkdWxpbmcgdGhlIGFjdGlvbiAqL1xuICAgICAgLy8gICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vICAgICBvcmlnaW5hbEFjdGlvbi5zY2hlZHVsZShjb3VudGVyICsgMSk7XG4gICAgICAvLyAgIH0sIDEwMCk7XG4gICAgICAvLyB9LCAxMDAwKTtcbiAgICAgIC8vIGBgYFxuICAgICAgdGhpcy5pZCA9IHRoaXMucmVjeWNsZUFzeW5jSWQodGhpcy5zY2hlZHVsZXIsIHRoaXMuaWQsIG51bGwpO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBfZXhlY3V0ZShzdGF0ZTogVCwgX2RlbGF5OiBudW1iZXIpOiBhbnkge1xuICAgIGxldCBlcnJvcmVkOiBib29sZWFuID0gZmFsc2U7XG4gICAgbGV0IGVycm9yVmFsdWU6IGFueTtcbiAgICB0cnkge1xuICAgICAgdGhpcy53b3JrKHN0YXRlKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBlcnJvcmVkID0gdHJ1ZTtcbiAgICAgIC8vIEhBQ0s6IFNpbmNlIGNvZGUgZWxzZXdoZXJlIGlzIHJlbHlpbmcgb24gdGhlIFwidHJ1dGhpbmVzc1wiIG9mIHRoZVxuICAgICAgLy8gcmV0dXJuIGhlcmUsIHdlIGNhbid0IGhhdmUgaXQgcmV0dXJuIFwiXCIgb3IgMCBvciBmYWxzZS5cbiAgICAgIC8vIFRPRE86IENsZWFuIHRoaXMgdXAgd2hlbiB3ZSByZWZhY3RvciBzY2hlZHVsZXJzIG1pZC12ZXJzaW9uLTggb3Igc28uXG4gICAgICBlcnJvclZhbHVlID0gZSA/IGUgOiBuZXcgRXJyb3IoJ1NjaGVkdWxlZCBhY3Rpb24gdGhyZXcgZmFsc3kgZXJyb3InKTtcbiAgICB9XG4gICAgaWYgKGVycm9yZWQpIHtcbiAgICAgIHRoaXMudW5zdWJzY3JpYmUoKTtcbiAgICAgIHJldHVybiBlcnJvclZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIHVuc3Vic2NyaWJlKCkge1xuICAgIGlmICghdGhpcy5jbG9zZWQpIHtcbiAgICAgIGNvbnN0IHsgaWQsIHNjaGVkdWxlciB9ID0gdGhpcztcbiAgICAgIGNvbnN0IHsgYWN0aW9ucyB9ID0gc2NoZWR1bGVyO1xuXG4gICAgICB0aGlzLndvcmsgPSB0aGlzLnN0YXRlID0gdGhpcy5zY2hlZHVsZXIgPSBudWxsITtcbiAgICAgIHRoaXMucGVuZGluZyA9IGZhbHNlO1xuXG4gICAgICBhcnJSZW1vdmUoYWN0aW9ucywgdGhpcyk7XG4gICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICB0aGlzLmlkID0gdGhpcy5yZWN5Y2xlQXN5bmNJZChzY2hlZHVsZXIsIGlkLCBudWxsKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5kZWxheSA9IG51bGwhO1xuICAgICAgc3VwZXIudW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==
