import{asyncScheduler}from"../scheduler/async";import{isValidDate}from"../util/isDate";import{operate}from"../util/lift";import{innerFrom}from"../observable/innerFrom";import{createErrorClass}from"../util/createErrorClass";import{createOperatorSubscriber}from"./OperatorSubscriber";import{executeSchedule}from"../util/executeSchedule";let TimeoutError=createErrorClass(e=>function(r=null){e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=r});function timeout(r,e){let{first:c,each:l,with:n=timeoutErrorFactory,scheduler:a=e??asyncScheduler,meta:m=null}=isValidDate(r)?{first:r}:"number"==typeof r?{each:r}:r;if(null==c&&null==l)throw new TypeError("No timeout provided.");return operate((r,e)=>{let t,o,i=null,u=0,s=r=>{o=executeSchedule(e,a,()=>{try{t.unsubscribe(),innerFrom(n({meta:m,lastValue:i,seen:u})).subscribe(e)}catch(r){e.error(r)}},r)};t=r.subscribe(createOperatorSubscriber(e,r=>{o?.unsubscribe(),u++,e.next(i=r),0<l&&s(l)},void 0,void 0,()=>{o?.closed||o?.unsubscribe(),i=null})),u||s(null!=c?"number"==typeof c?c:+c-a.now():l)})}function timeoutErrorFactory(r){throw new TimeoutError(r)}export{TimeoutError,timeout};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9yeGpzL3NyYy9pbnRlcm5hbC9vcGVyYXRvcnMvdGltZW91dC50cyJdLCJuYW1lcyI6WyJhc3luY1NjaGVkdWxlciIsImlzVmFsaWREYXRlIiwib3BlcmF0ZSIsImlubmVyRnJvbSIsImNyZWF0ZUVycm9yQ2xhc3MiLCJjcmVhdGVPcGVyYXRvclN1YnNjcmliZXIiLCJleGVjdXRlU2NoZWR1bGUiLCJUaW1lb3V0RXJyb3IiLCJpbmZvIiwiX3N1cGVyIiwidGhpcyIsIm1lc3NhZ2UiLCJuYW1lIiwidGltZW91dCIsImNvbmZpZyIsInNjaGVkdWxlckFyZyIsImZpcnN0IiwiZWFjaCIsIndpdGgiLCJfd2l0aCIsInRpbWVvdXRFcnJvckZhY3RvcnkiLCJzY2hlZHVsZXIiLCJtZXRhIiwiVHlwZUVycm9yIiwic291cmNlIiwic3Vic2NyaWJlciIsImxldCIsIm9yaWdpbmFsU291cmNlU3Vic2NyaXB0aW9uIiwidGltZXJTdWJzY3JpcHRpb24iLCJsYXN0VmFsdWUiLCJzZWVuIiwic3RhcnRUaW1lciIsInVuc3Vic2NyaWJlIiwic3Vic2NyaWJlIiwiZXJyIiwiZXJyb3IiLCJkZWxheSIsIm5leHQiLCJ2YWx1ZSIsInVuZGVmaW5lZCIsImNsb3NlZCIsIm5vdyJdLCJtYXBwaW5ncyI6Ik9BQVNBLGNBQTBDLEtBQXBCLDRCQUV0QkMsV0FBbUMsS0FBaEIsd0JBRW5CQyxPQUE2QixLQUFkLHNCQUVmQyxTQUEwQyxLQUF6QixpQ0FDakJDLGdCQUFrRCxLQUExQixrQ0FDeEJDLHdCQUFzRCxLQUF0Qiw4QkFDaENDLGVBQWdELEtBQXpCLDBCQTRFekIsSUFBTUMsYUFBaUNILGlCQUM1QyxHQUNFLFNBQXFDSSxFQUFnQyxNQUNuRUMsRUFBT0MsSUFBSSxFQUNYQSxLQUFLQyxRQUFVLHVCQUNmRCxLQUFLRSxLQUFPLGVBQ1pGLEtBQUtGLEtBQU9BLENBQ2QsQ0FBQyxFQThNQyxTQUFVSyxRQUNkQyxFQUNBQyxHQVNBLEdBQU0sQ0FDSkMsTUFBQUEsRUFDQUMsS0FBQUEsRUFDQUMsS0FBTUMsRUFBUUMsb0JBQ2RDLFVBQUFBLEVBQVlOLEdBQWdCZixlQUM1QnNCLEtBQUFBLEVBQU8sSUFBSyxFQUNUckIsWUFBWWEsQ0FBTSxFQUFJLENBQUVFLE1BQU9GLENBQU0sRUFBdUIsVUFBbEIsT0FBT0EsRUFBc0IsQ0FBRUcsS0FBTUgsQ0FBTSxFQUFLQSxFQUUvRixHQUFhLE1BQVRFLEdBQXlCLE1BQVJDLEVBRW5CLE1BQU0sSUFBSU0sVUFBVSxzQkFBc0IsRUFHNUMsT0FBT3JCLFFBQVEsQ0FBQ3NCLEVBQVFDLEtBTXRCQyxJQUFJQyxFQUdBQyxFQUdBQyxFQUFzQixLQUd0QkMsRUFBTyxFQUNMQyxFQUFhLElBQ2pCSCxFQUFvQnRCLGdCQUNsQm1CLEVBQ0FKLEVBQ0EsS0FDRSxJQUNFTSxFQUEyQkssWUFBVyxFQUN0QzdCLFVBQ0VnQixFQUFPLENBQ0xHLEtBQUFBLEVBQ0FPLFVBQUFBLEVBQ0FDLEtBQUFBLEMsQ0FDRCxDQUFDLEVBQ0ZHLFVBQVVSLENBQVUsQ0FHeEIsQ0FGRSxNQUFPUyxHQUNQVCxFQUFXVSxNQUFNRCxDQUFHLENBQ3RCLENBQ0YsRUFDQUUsQ0FBSyxDQUVULEVBRUFULEVBQTZCSCxFQUFPUyxVQUNsQzVCLHlCQUNFb0IsRUFDQSxJQUVFRyxHQUFtQkksWUFBVyxFQUM5QkYsQ0FBSSxHQUVKTCxFQUFXWSxLQUFNUixFQUFZUyxDQUFNLEVBRTNCLEVBQVJyQixHQUFhYyxFQUFXZCxDQUFLLENBQy9CLEVBQ0FzQixLQUFBQSxFQUNBQSxLQUFBQSxFQUNBLEtBQ09YLEdBQW1CWSxRQUN0QlosR0FBbUJJLFlBQVcsRUFJaENILEVBQVksSUFDZCxDQUFDLENBQ0YsRUFTRkMsR0FBUUMsRUFBb0IsTUFBVGYsRUFBa0MsVUFBakIsT0FBT0EsRUFBcUJBLEVBQVEsQ0FBQ0EsRUFBUUssRUFBV29CLElBQUcsRUFBTXhCLENBQUssQ0FDN0csQ0FBQyxDQUNILENBT0EsU0FBU0csb0JBQW9CWixHQUMzQixNQUFNLElBQUlELGFBQWFDLENBQUksQ0FDN0IsUUE3VGFELGFBcU5HTSxPQXdHaEIiLCJmaWxlIjoibm9kZV9tb2R1bGVzL3J4anMvc3JjL2ludGVybmFsL29wZXJhdG9ycy90aW1lb3V0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYXN5bmNTY2hlZHVsZXIgfSBmcm9tICcuLi9zY2hlZHVsZXIvYXN5bmMnO1xuaW1wb3J0IHsgTW9ub1R5cGVPcGVyYXRvckZ1bmN0aW9uLCBTY2hlZHVsZXJMaWtlLCBPcGVyYXRvckZ1bmN0aW9uLCBPYnNlcnZhYmxlSW5wdXQsIE9ic2VydmVkVmFsdWVPZiB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7IGlzVmFsaWREYXRlIH0gZnJvbSAnLi4vdXRpbC9pc0RhdGUnO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAnLi4vU3Vic2NyaXB0aW9uJztcbmltcG9ydCB7IG9wZXJhdGUgfSBmcm9tICcuLi91dGlsL2xpZnQnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJy4uL09ic2VydmFibGUnO1xuaW1wb3J0IHsgaW5uZXJGcm9tIH0gZnJvbSAnLi4vb2JzZXJ2YWJsZS9pbm5lckZyb20nO1xuaW1wb3J0IHsgY3JlYXRlRXJyb3JDbGFzcyB9IGZyb20gJy4uL3V0aWwvY3JlYXRlRXJyb3JDbGFzcyc7XG5pbXBvcnQgeyBjcmVhdGVPcGVyYXRvclN1YnNjcmliZXIgfSBmcm9tICcuL09wZXJhdG9yU3Vic2NyaWJlcic7XG5pbXBvcnQgeyBleGVjdXRlU2NoZWR1bGUgfSBmcm9tICcuLi91dGlsL2V4ZWN1dGVTY2hlZHVsZSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGltZW91dENvbmZpZzxULCBPIGV4dGVuZHMgT2JzZXJ2YWJsZUlucHV0PHVua25vd24+ID0gT2JzZXJ2YWJsZUlucHV0PFQ+LCBNID0gdW5rbm93bj4ge1xuICAvKipcbiAgICogVGhlIHRpbWUgYWxsb3dlZCBiZXR3ZWVuIHZhbHVlcyBmcm9tIHRoZSBzb3VyY2UgYmVmb3JlIHRpbWVvdXQgaXMgdHJpZ2dlcmVkLlxuICAgKi9cbiAgZWFjaD86IG51bWJlcjtcblxuICAvKipcbiAgICogVGhlIHJlbGF0aXZlIHRpbWUgYXMgYSBgbnVtYmVyYCBpbiBtaWxsaXNlY29uZHMsIG9yIGEgc3BlY2lmaWMgdGltZSBhcyBhIGBEYXRlYCBvYmplY3QsXG4gICAqIGJ5IHdoaWNoIHRoZSBmaXJzdCB2YWx1ZSBtdXN0IGFycml2ZSBmcm9tIHRoZSBzb3VyY2UgYmVmb3JlIHRpbWVvdXQgaXMgdHJpZ2dlcmVkLlxuICAgKi9cbiAgZmlyc3Q/OiBudW1iZXIgfCBEYXRlO1xuXG4gIC8qKlxuICAgKiBUaGUgc2NoZWR1bGVyIHRvIHVzZSB3aXRoIHRpbWUtcmVsYXRlZCBvcGVyYXRpb25zIHdpdGhpbiB0aGlzIG9wZXJhdG9yLiBEZWZhdWx0cyB0byB7QGxpbmsgYXN5bmNTY2hlZHVsZXJ9XG4gICAqL1xuICBzY2hlZHVsZXI/OiBTY2hlZHVsZXJMaWtlO1xuXG4gIC8qKlxuICAgKiBBIGZhY3RvcnkgdXNlZCB0byBjcmVhdGUgb2JzZXJ2YWJsZSB0byBzd2l0Y2ggdG8gd2hlbiB0aW1lb3V0IG9jY3Vycy4gUHJvdmlkZXNcbiAgICogYSB7QGxpbmsgVGltZW91dEluZm99IGFib3V0IHRoZSBzb3VyY2Ugb2JzZXJ2YWJsZSdzIGVtaXNzaW9ucyBhbmQgd2hhdCBkZWxheSBvclxuICAgKiBleGFjdCB0aW1lIHRyaWdnZXJlZCB0aGUgdGltZW91dC5cbiAgICovXG4gIHdpdGg/OiAoaW5mbzogVGltZW91dEluZm88VCwgTT4pID0+IE87XG5cbiAgLyoqXG4gICAqIE9wdGlvbmFsIGFkZGl0aW9uYWwgbWV0YWRhdGEgeW91IGNhbiBwcm92aWRlIHRvIGNvZGUgdGhhdCBoYW5kbGVzXG4gICAqIHRoZSB0aW1lb3V0LCB3aWxsIGJlIHByb3ZpZGVkIHRocm91Z2ggdGhlIHtAbGluayBUaW1lb3V0RXJyb3J9LlxuICAgKiBUaGlzIGNhbiBiZSB1c2VkIHRvIGhlbHAgaWRlbnRpZnkgdGhlIHNvdXJjZSBvZiBhIHRpbWVvdXQgb3IgcGFzcyBhbG9uZ1xuICAgKiBvdGhlciBpbmZvcm1hdGlvbiByZWxhdGVkIHRvIHRoZSB0aW1lb3V0LlxuICAgKi9cbiAgbWV0YT86IE07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGltZW91dEluZm88VCwgTSA9IHVua25vd24+IHtcbiAgLyoqIE9wdGlvbmFsIG1ldGFkYXRhIHRoYXQgd2FzIHByb3ZpZGVkIHRvIHRoZSB0aW1lb3V0IGNvbmZpZ3VyYXRpb24uICovXG4gIHJlYWRvbmx5IG1ldGE6IE07XG4gIC8qKiBUaGUgbnVtYmVyIG9mIG1lc3NhZ2VzIHNlZW4gYmVmb3JlIHRoZSB0aW1lb3V0ICovXG4gIHJlYWRvbmx5IHNlZW46IG51bWJlcjtcbiAgLyoqIFRoZSBsYXN0IG1lc3NhZ2Ugc2VlbiAqL1xuICByZWFkb25seSBsYXN0VmFsdWU6IFQgfCBudWxsO1xufVxuXG4vKipcbiAqIEFuIGVycm9yIGVtaXR0ZWQgd2hlbiBhIHRpbWVvdXQgb2NjdXJzLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFRpbWVvdXRFcnJvcjxUID0gdW5rbm93biwgTSA9IHVua25vd24+IGV4dGVuZHMgRXJyb3Ige1xuICAvKipcbiAgICogVGhlIGluZm9ybWF0aW9uIHByb3ZpZGVkIHRvIHRoZSBlcnJvciBieSB0aGUgdGltZW91dFxuICAgKiBvcGVyYXRpb24gdGhhdCBjcmVhdGVkIHRoZSBlcnJvci4gV2lsbCBiZSBgbnVsbGAgaWZcbiAgICogdXNlZCBkaXJlY3RseSBpbiBub24tUnhKUyBjb2RlIHdpdGggYW4gZW1wdHkgY29uc3RydWN0b3IuXG4gICAqIChOb3RlIHRoYXQgdXNpbmcgdGhpcyBjb25zdHJ1Y3RvciBkaXJlY3RseSBpcyBub3QgcmVjb21tZW5kZWQsXG4gICAqIHlvdSBzaG91bGQgY3JlYXRlIHlvdXIgb3duIGVycm9ycylcbiAgICovXG4gIGluZm86IFRpbWVvdXRJbmZvPFQsIE0+IHwgbnVsbDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUaW1lb3V0RXJyb3JDdG9yIHtcbiAgLyoqXG4gICAqIEBkZXByZWNhdGVkIEludGVybmFsIGltcGxlbWVudGF0aW9uIGRldGFpbC4gRG8gbm90IGNvbnN0cnVjdCBlcnJvciBpbnN0YW5jZXMuXG4gICAqIENhbm5vdCBiZSB0YWdnZWQgYXMgaW50ZXJuYWw6IGh0dHBzOi8vZ2l0aHViLmNvbS9SZWFjdGl2ZVgvcnhqcy9pc3N1ZXMvNjI2OVxuICAgKi9cbiAgbmV3IDxUID0gdW5rbm93biwgTSA9IHVua25vd24+KGluZm8/OiBUaW1lb3V0SW5mbzxULCBNPik6IFRpbWVvdXRFcnJvcjxULCBNPjtcbn1cblxuLyoqXG4gKiBBbiBlcnJvciB0aHJvd24gYnkgdGhlIHtAbGluayB0aW1lb3V0fSBvcGVyYXRvci5cbiAqXG4gKiBQcm92aWRlZCBzbyB1c2VycyBjYW4gdXNlIGFzIGEgdHlwZSBhbmQgZG8gcXVhbGl0eSBjb21wYXJpc29ucy5cbiAqIFdlIHJlY29tbWVuZCB5b3UgZG8gbm90IHN1YmNsYXNzIHRoaXMgb3IgY3JlYXRlIGluc3RhbmNlcyBvZiB0aGlzIGNsYXNzIGRpcmVjdGx5LlxuICogSWYgeW91IGhhdmUgbmVlZCBvZiBhIGVycm9yIHJlcHJlc2VudGluZyBhIHRpbWVvdXQsIHlvdSBzaG91bGRcbiAqIGNyZWF0ZSB5b3VyIG93biBlcnJvciBjbGFzcyBhbmQgdXNlIHRoYXQuXG4gKlxuICogQHNlZSB7QGxpbmsgdGltZW91dH1cbiAqL1xuZXhwb3J0IGNvbnN0IFRpbWVvdXRFcnJvcjogVGltZW91dEVycm9yQ3RvciA9IGNyZWF0ZUVycm9yQ2xhc3MoXG4gIChfc3VwZXIpID0+XG4gICAgZnVuY3Rpb24gVGltZW91dEVycm9ySW1wbCh0aGlzOiBhbnksIGluZm86IFRpbWVvdXRJbmZvPGFueT4gfCBudWxsID0gbnVsbCkge1xuICAgICAgX3N1cGVyKHRoaXMpO1xuICAgICAgdGhpcy5tZXNzYWdlID0gJ1RpbWVvdXQgaGFzIG9jY3VycmVkJztcbiAgICAgIHRoaXMubmFtZSA9ICdUaW1lb3V0RXJyb3InO1xuICAgICAgdGhpcy5pbmZvID0gaW5mbztcbiAgICB9XG4pO1xuXG4vKipcbiAqIElmIGB3aXRoYCBpcyBwcm92aWRlZCwgdGhpcyB3aWxsIHJldHVybiBhbiBvYnNlcnZhYmxlIHRoYXQgd2lsbCBzd2l0Y2ggdG8gYSBkaWZmZXJlbnQgb2JzZXJ2YWJsZSBpZiB0aGUgc291cmNlXG4gKiBkb2VzIG5vdCBwdXNoIHZhbHVlcyB3aXRoaW4gdGhlIHNwZWNpZmllZCB0aW1lIHBhcmFtZXRlcnMuXG4gKlxuICogPHNwYW4gY2xhc3M9XCJpbmZvcm1hbFwiPlRoZSBtb3N0IGZsZXhpYmxlIG9wdGlvbiBmb3IgY3JlYXRpbmcgYSB0aW1lb3V0IGJlaGF2aW9yLjwvc3Bhbj5cbiAqXG4gKiBUaGUgZmlyc3QgdGhpbmcgdG8ga25vdyBhYm91dCB0aGUgY29uZmlndXJhdGlvbiBpcyBpZiB5b3UgZG8gbm90IHByb3ZpZGUgYSBgd2l0aGAgcHJvcGVydHkgdG8gdGhlIGNvbmZpZ3VyYXRpb24sXG4gKiB3aGVuIHRpbWVvdXQgY29uZGl0aW9ucyBhcmUgbWV0LCB0aGlzIG9wZXJhdG9yIHdpbGwgZW1pdCBhIHtAbGluayBUaW1lb3V0RXJyb3J9LiBPdGhlcndpc2UsIGl0IHdpbGwgdXNlIHRoZSBmYWN0b3J5XG4gKiBmdW5jdGlvbiBwcm92aWRlZCBieSBgd2l0aGAsIGFuZCBzd2l0Y2ggeW91ciBzdWJzY3JpcHRpb24gdG8gdGhlIHJlc3VsdCBvZiB0aGF0LiBUaW1lb3V0IGNvbmRpdGlvbnMgYXJlIHByb3ZpZGVkIGJ5XG4gKiB0aGUgc2V0dGluZ3MgaW4gYGZpcnN0YCBhbmQgYGVhY2hgLlxuICpcbiAqIFRoZSBgZmlyc3RgIHByb3BlcnR5IGNhbiBiZSBlaXRoZXIgYSBgRGF0ZWAgZm9yIGEgc3BlY2lmaWMgdGltZSwgYSBgbnVtYmVyYCBmb3IgYSB0aW1lIHBlcmlvZCByZWxhdGl2ZSB0byB0aGVcbiAqIHBvaW50IG9mIHN1YnNjcmlwdGlvbiwgb3IgaXQgY2FuIGJlIHNraXBwZWQuIFRoaXMgcHJvcGVydHkgaXMgdG8gY2hlY2sgdGltZW91dCBjb25kaXRpb25zIGZvciB0aGUgYXJyaXZhbCBvZlxuICogdGhlIGZpcnN0IHZhbHVlIGZyb20gdGhlIHNvdXJjZSBfb25seV8uIFRoZSB0aW1pbmdzIG9mIGFsbCBzdWJzZXF1ZW50IHZhbHVlcyAgZnJvbSB0aGUgc291cmNlIHdpbGwgYmUgY2hlY2tlZFxuICogYWdhaW5zdCB0aGUgdGltZSBwZXJpb2QgcHJvdmlkZWQgYnkgYGVhY2hgLCBpZiBpdCB3YXMgcHJvdmlkZWQuXG4gKlxuICogVGhlIGBlYWNoYCBwcm9wZXJ0eSBjYW4gYmUgZWl0aGVyIGEgYG51bWJlcmAgb3Igc2tpcHBlZC4gSWYgYSB2YWx1ZSBmb3IgYGVhY2hgIGlzIHByb3ZpZGVkLCBpdCByZXByZXNlbnRzIHRoZSBhbW91bnQgb2ZcbiAqIHRpbWUgdGhlIHJlc3VsdGluZyBvYnNlcnZhYmxlIHdpbGwgd2FpdCBiZXR3ZWVuIHRoZSBhcnJpdmFsIG9mIHZhbHVlcyBmcm9tIHRoZSBzb3VyY2UgYmVmb3JlIHRpbWluZyBvdXQuIE5vdGUgdGhhdCBpZlxuICogYGZpcnN0YCBpcyBfbm90XyBwcm92aWRlZCwgdGhlIHZhbHVlIGZyb20gYGVhY2hgIHdpbGwgYmUgdXNlZCB0byBjaGVjayB0aW1lb3V0IGNvbmRpdGlvbnMgZm9yIHRoZSBhcnJpdmFsIG9mIHRoZSBmaXJzdFxuICogdmFsdWUgYW5kIGFsbCBzdWJzZXF1ZW50IHZhbHVlcy4gSWYgYGZpcnN0YCBfaXNfIHByb3ZpZGVkLCBgZWFjaGAgd2lsbCBvbmx5IGJlIHVzZSB0byBjaGVjayBhbGwgdmFsdWVzIGFmdGVyIHRoZSBmaXJzdC5cbiAqXG4gKiAjIyBFeGFtcGxlc1xuICpcbiAqIEVtaXQgYSBjdXN0b20gZXJyb3IgaWYgdGhlcmUgaXMgdG9vIG11Y2ggdGltZSBiZXR3ZWVuIHZhbHVlc1xuICpcbiAqIGBgYHRzXG4gKiBpbXBvcnQgeyBpbnRlcnZhbCwgdGltZW91dCwgdGhyb3dFcnJvciB9IGZyb20gJ3J4anMnO1xuICpcbiAqIGNsYXNzIEN1c3RvbVRpbWVvdXRFcnJvciBleHRlbmRzIEVycm9yIHtcbiAqICAgY29uc3RydWN0b3IoKSB7XG4gKiAgICAgc3VwZXIoJ0l0IHdhcyB0b28gc2xvdycpO1xuICogICAgIHRoaXMubmFtZSA9ICdDdXN0b21UaW1lb3V0RXJyb3InO1xuICogICB9XG4gKiB9XG4gKlxuICogY29uc3Qgc2xvdyQgPSBpbnRlcnZhbCg5MDApO1xuICpcbiAqIHNsb3ckLnBpcGUoXG4gKiAgIHRpbWVvdXQoe1xuICogICAgIGVhY2g6IDEwMDAsXG4gKiAgICAgd2l0aDogKCkgPT4gdGhyb3dFcnJvcigoKSA9PiBuZXcgQ3VzdG9tVGltZW91dEVycm9yKCkpXG4gKiAgIH0pXG4gKiApXG4gKiAuc3Vic2NyaWJlKHtcbiAqICAgZXJyb3I6IGNvbnNvbGUuZXJyb3JcbiAqIH0pO1xuICogYGBgXG4gKlxuICogU3dpdGNoIHRvIGEgZmFzdGVyIG9ic2VydmFibGUgaWYgeW91ciBzb3VyY2UgaXMgc2xvdy5cbiAqXG4gKiBgYGB0c1xuICogaW1wb3J0IHsgaW50ZXJ2YWwsIHRpbWVvdXQgfSBmcm9tICdyeGpzJztcbiAqXG4gKiBjb25zdCBzbG93JCA9IGludGVydmFsKDkwMCk7XG4gKiBjb25zdCBmYXN0JCA9IGludGVydmFsKDUwMCk7XG4gKlxuICogc2xvdyQucGlwZShcbiAqICAgdGltZW91dCh7XG4gKiAgICAgZWFjaDogMTAwMCxcbiAqICAgICB3aXRoOiAoKSA9PiBmYXN0JCxcbiAqICAgfSlcbiAqIClcbiAqIC5zdWJzY3JpYmUoY29uc29sZS5sb2cpO1xuICogYGBgXG4gKiBAcGFyYW0gY29uZmlnIFRoZSBjb25maWd1cmF0aW9uIGZvciB0aGUgdGltZW91dC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRpbWVvdXQ8VCwgTyBleHRlbmRzIE9ic2VydmFibGVJbnB1dDx1bmtub3duPiwgTSA9IHVua25vd24+KFxuICBjb25maWc6IFRpbWVvdXRDb25maWc8VCwgTywgTT4gJiB7IHdpdGg6IChpbmZvOiBUaW1lb3V0SW5mbzxULCBNPikgPT4gTyB9XG4pOiBPcGVyYXRvckZ1bmN0aW9uPFQsIFQgfCBPYnNlcnZlZFZhbHVlT2Y8Tz4+O1xuXG4vKipcbiAqIFJldHVybnMgYW4gb2JzZXJ2YWJsZSB0aGF0IHdpbGwgZXJyb3Igb3Igc3dpdGNoIHRvIGEgZGlmZmVyZW50IG9ic2VydmFibGUgaWYgdGhlIHNvdXJjZSBkb2VzIG5vdCBwdXNoIHZhbHVlc1xuICogd2l0aGluIHRoZSBzcGVjaWZpZWQgdGltZSBwYXJhbWV0ZXJzLlxuICpcbiAqIDxzcGFuIGNsYXNzPVwiaW5mb3JtYWxcIj5UaGUgbW9zdCBmbGV4aWJsZSBvcHRpb24gZm9yIGNyZWF0aW5nIGEgdGltZW91dCBiZWhhdmlvci48L3NwYW4+XG4gKlxuICogVGhlIGZpcnN0IHRoaW5nIHRvIGtub3cgYWJvdXQgdGhlIGNvbmZpZ3VyYXRpb24gaXMgaWYgeW91IGRvIG5vdCBwcm92aWRlIGEgYHdpdGhgIHByb3BlcnR5IHRvIHRoZSBjb25maWd1cmF0aW9uLFxuICogd2hlbiB0aW1lb3V0IGNvbmRpdGlvbnMgYXJlIG1ldCwgdGhpcyBvcGVyYXRvciB3aWxsIGVtaXQgYSB7QGxpbmsgVGltZW91dEVycm9yfS4gT3RoZXJ3aXNlLCBpdCB3aWxsIHVzZSB0aGUgZmFjdG9yeVxuICogZnVuY3Rpb24gcHJvdmlkZWQgYnkgYHdpdGhgLCBhbmQgc3dpdGNoIHlvdXIgc3Vic2NyaXB0aW9uIHRvIHRoZSByZXN1bHQgb2YgdGhhdC4gVGltZW91dCBjb25kaXRpb25zIGFyZSBwcm92aWRlZCBieVxuICogdGhlIHNldHRpbmdzIGluIGBmaXJzdGAgYW5kIGBlYWNoYC5cbiAqXG4gKiBUaGUgYGZpcnN0YCBwcm9wZXJ0eSBjYW4gYmUgZWl0aGVyIGEgYERhdGVgIGZvciBhIHNwZWNpZmljIHRpbWUsIGEgYG51bWJlcmAgZm9yIGEgdGltZSBwZXJpb2QgcmVsYXRpdmUgdG8gdGhlXG4gKiBwb2ludCBvZiBzdWJzY3JpcHRpb24sIG9yIGl0IGNhbiBiZSBza2lwcGVkLiBUaGlzIHByb3BlcnR5IGlzIHRvIGNoZWNrIHRpbWVvdXQgY29uZGl0aW9ucyBmb3IgdGhlIGFycml2YWwgb2ZcbiAqIHRoZSBmaXJzdCB2YWx1ZSBmcm9tIHRoZSBzb3VyY2UgX29ubHlfLiBUaGUgdGltaW5ncyBvZiBhbGwgc3Vic2VxdWVudCB2YWx1ZXMgIGZyb20gdGhlIHNvdXJjZSB3aWxsIGJlIGNoZWNrZWRcbiAqIGFnYWluc3QgdGhlIHRpbWUgcGVyaW9kIHByb3ZpZGVkIGJ5IGBlYWNoYCwgaWYgaXQgd2FzIHByb3ZpZGVkLlxuICpcbiAqIFRoZSBgZWFjaGAgcHJvcGVydHkgY2FuIGJlIGVpdGhlciBhIGBudW1iZXJgIG9yIHNraXBwZWQuIElmIGEgdmFsdWUgZm9yIGBlYWNoYCBpcyBwcm92aWRlZCwgaXQgcmVwcmVzZW50cyB0aGUgYW1vdW50IG9mXG4gKiB0aW1lIHRoZSByZXN1bHRpbmcgb2JzZXJ2YWJsZSB3aWxsIHdhaXQgYmV0d2VlbiB0aGUgYXJyaXZhbCBvZiB2YWx1ZXMgZnJvbSB0aGUgc291cmNlIGJlZm9yZSB0aW1pbmcgb3V0LiBOb3RlIHRoYXQgaWZcbiAqIGBmaXJzdGAgaXMgX25vdF8gcHJvdmlkZWQsIHRoZSB2YWx1ZSBmcm9tIGBlYWNoYCB3aWxsIGJlIHVzZWQgdG8gY2hlY2sgdGltZW91dCBjb25kaXRpb25zIGZvciB0aGUgYXJyaXZhbCBvZiB0aGUgZmlyc3RcbiAqIHZhbHVlIGFuZCBhbGwgc3Vic2VxdWVudCB2YWx1ZXMuIElmIGBmaXJzdGAgX2lzXyBwcm92aWRlZCwgYGVhY2hgIHdpbGwgb25seSBiZSB1c2UgdG8gY2hlY2sgYWxsIHZhbHVlcyBhZnRlciB0aGUgZmlyc3QuXG4gKlxuICogIyMjIEhhbmRsaW5nIFRpbWVvdXRFcnJvcnNcbiAqXG4gKiBJZiBubyBgd2l0aGAgcHJvcGVydHkgd2FzIHByb3ZpZGVkLCBzdWJzY3JpcHRpb25zIHRvIHRoZSByZXN1bHRpbmcgb2JzZXJ2YWJsZSBtYXkgZW1pdCBhbiBlcnJvciBvZiB7QGxpbmsgVGltZW91dEVycm9yfS5cbiAqIFRoZSB0aW1lb3V0IGVycm9yIHByb3ZpZGVzIHVzZWZ1bCBpbmZvcm1hdGlvbiB5b3UgY2FuIGV4YW1pbmUgd2hlbiB5b3UncmUgaGFuZGxpbmcgdGhlIGVycm9yLiBUaGUgbW9zdCBjb21tb24gd2F5IHRvIGhhbmRsZVxuICogdGhlIGVycm9yIHdvdWxkIGJlIHdpdGgge0BsaW5rIGNhdGNoRXJyb3J9LCBhbHRob3VnaCB5b3UgY291bGQgdXNlIHtAbGluayB0YXB9IG9yIGp1c3QgdGhlIGVycm9yIGhhbmRsZXIgaW4geW91ciBgc3Vic2NyaWJlYCBjYWxsXG4gKiBkaXJlY3RseSwgaWYgeW91ciBlcnJvciBoYW5kbGluZyBpcyBvbmx5IGEgc2lkZSBlZmZlY3QgKHN1Y2ggYXMgbm90aWZ5aW5nIHRoZSB1c2VyLCBvciBsb2dnaW5nKS5cbiAqXG4gKiBJbiB0aGlzIGNhc2UsIHlvdSB3b3VsZCBjaGVjayB0aGUgZXJyb3IgZm9yIGBpbnN0YW5jZW9mIFRpbWVvdXRFcnJvcmAgdG8gdmFsaWRhdGUgdGhhdCB0aGUgZXJyb3Igd2FzIGluZGVlZCBmcm9tIGB0aW1lb3V0YCwgYW5kXG4gKiBub3QgZnJvbSBzb21lIG90aGVyIHNvdXJjZS4gSWYgaXQncyBub3QgZnJvbSBgdGltZW91dGAsIHlvdSBzaG91bGQgcHJvYmFibHkgcmV0aHJvdyBpdCBpZiB5b3UncmUgaW4gYSBgY2F0Y2hFcnJvcmAuXG4gKlxuICogIyMgRXhhbXBsZXNcbiAqXG4gKiBFbWl0IGEge0BsaW5rIFRpbWVvdXRFcnJvcn0gaWYgdGhlIGZpcnN0IHZhbHVlLCBhbmQgX29ubHlfIHRoZSBmaXJzdCB2YWx1ZSwgZG9lcyBub3QgYXJyaXZlIHdpdGhpbiA1IHNlY29uZHNcbiAqXG4gKiBgYGB0c1xuICogaW1wb3J0IHsgaW50ZXJ2YWwsIHRpbWVvdXQgfSBmcm9tICdyeGpzJztcbiAqXG4gKiAvLyBBIHJhbmRvbSBpbnRlcnZhbCB0aGF0IGxhc3RzIGJldHdlZW4gMCBhbmQgMTAgc2Vjb25kcyBwZXIgdGlja1xuICogY29uc3Qgc291cmNlJCA9IGludGVydmFsKE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSAqIDEwXzAwMCkpO1xuICpcbiAqIHNvdXJjZSQucGlwZShcbiAqICAgdGltZW91dCh7IGZpcnN0OiA1XzAwMCB9KVxuICogKVxuICogLnN1YnNjcmliZSh7XG4gKiAgIG5leHQ6IGNvbnNvbGUubG9nLFxuICogICBlcnJvcjogY29uc29sZS5lcnJvclxuICogfSk7XG4gKiBgYGBcbiAqXG4gKiBFbWl0IGEge0BsaW5rIFRpbWVvdXRFcnJvcn0gaWYgdGhlIHNvdXJjZSB3YWl0cyBsb25nZXIgdGhhbiA1IHNlY29uZHMgYmV0d2VlbiBhbnkgdHdvIHZhbHVlcyBvciB0aGUgZmlyc3QgdmFsdWVcbiAqIGFuZCBzdWJzY3JpcHRpb24uXG4gKlxuICogYGBgdHNcbiAqIGltcG9ydCB7IHRpbWVyLCB0aW1lb3V0LCBleHBhbmQgfSBmcm9tICdyeGpzJztcbiAqXG4gKiBjb25zdCBnZXRSYW5kb21UaW1lID0gKCkgPT4gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogMTBfMDAwKTtcbiAqXG4gKiAvLyBBbiBvYnNlcnZhYmxlIHRoYXQgd2FpdHMgYSByYW5kb20gYW1vdW50IG9mIHRpbWUgYmV0d2VlbiBlYWNoIGRlbGl2ZXJlZCB2YWx1ZVxuICogY29uc3Qgc291cmNlJCA9IHRpbWVyKGdldFJhbmRvbVRpbWUoKSlcbiAqICAgLnBpcGUoZXhwYW5kKCgpID0+IHRpbWVyKGdldFJhbmRvbVRpbWUoKSkpKTtcbiAqXG4gKiBzb3VyY2UkXG4gKiAgIC5waXBlKHRpbWVvdXQoeyBlYWNoOiA1XzAwMCB9KSlcbiAqICAgLnN1YnNjcmliZSh7XG4gKiAgICAgbmV4dDogY29uc29sZS5sb2csXG4gKiAgICAgZXJyb3I6IGNvbnNvbGUuZXJyb3JcbiAqICAgfSk7XG4gKiBgYGBcbiAqXG4gKiBFbWl0IGEge0BsaW5rIFRpbWVvdXRFcnJvcn0gaWYgdGhlIHNvdXJjZSBkb2VzIG5vdCBlbWl0IGJlZm9yZSA3IHNlY29uZHMsIF9vcl8gaWYgdGhlIHNvdXJjZSB3YWl0cyBsb25nZXIgdGhhblxuICogNSBzZWNvbmRzIGJldHdlZW4gYW55IHR3byB2YWx1ZXMgYWZ0ZXIgdGhlIGZpcnN0LlxuICpcbiAqIGBgYHRzXG4gKiBpbXBvcnQgeyB0aW1lciwgdGltZW91dCwgZXhwYW5kIH0gZnJvbSAncnhqcyc7XG4gKlxuICogY29uc3QgZ2V0UmFuZG9tVGltZSA9ICgpID0+IE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSAqIDEwXzAwMCk7XG4gKlxuICogLy8gQW4gb2JzZXJ2YWJsZSB0aGF0IHdhaXRzIGEgcmFuZG9tIGFtb3VudCBvZiB0aW1lIGJldHdlZW4gZWFjaCBkZWxpdmVyZWQgdmFsdWVcbiAqIGNvbnN0IHNvdXJjZSQgPSB0aW1lcihnZXRSYW5kb21UaW1lKCkpXG4gKiAgIC5waXBlKGV4cGFuZCgoKSA9PiB0aW1lcihnZXRSYW5kb21UaW1lKCkpKSk7XG4gKlxuICogc291cmNlJFxuICogICAucGlwZSh0aW1lb3V0KHsgZmlyc3Q6IDdfMDAwLCBlYWNoOiA1XzAwMCB9KSlcbiAqICAgLnN1YnNjcmliZSh7XG4gKiAgICAgbmV4dDogY29uc29sZS5sb2csXG4gKiAgICAgZXJyb3I6IGNvbnNvbGUuZXJyb3JcbiAqICAgfSk7XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRpbWVvdXQ8VCwgTSA9IHVua25vd24+KGNvbmZpZzogT21pdDxUaW1lb3V0Q29uZmlnPFQsIGFueSwgTT4sICd3aXRoJz4pOiBPcGVyYXRvckZ1bmN0aW9uPFQsIFQ+O1xuXG4vKipcbiAqIFJldHVybnMgYW4gb2JzZXJ2YWJsZSB0aGF0IHdpbGwgZXJyb3IgaWYgdGhlIHNvdXJjZSBkb2VzIG5vdCBwdXNoIGl0cyBmaXJzdCB2YWx1ZSBiZWZvcmUgdGhlIHNwZWNpZmllZCB0aW1lIHBhc3NlZCBhcyBhIGBEYXRlYC5cbiAqIFRoaXMgaXMgZnVuY3Rpb25hbGx5IHRoZSBzYW1lIGFzIGB0aW1lb3V0KHsgZmlyc3Q6IHNvbWVEYXRlIH0pYC5cbiAqXG4gKiA8c3BhbiBjbGFzcz1cImluZm9ybWFsXCI+RXJyb3JzIGlmIHRoZSBmaXJzdCB2YWx1ZSBkb2Vzbid0IHNob3cgdXAgYmVmb3JlIHRoZSBnaXZlbiBkYXRlIGFuZCB0aW1lPC9zcGFuPlxuICpcbiAqICFbXSh0aW1lb3V0LnBuZylcbiAqXG4gKiBAcGFyYW0gZmlyc3QgVGhlIGRhdGUgdG8gYXQgd2hpY2ggdGhlIHJlc3VsdGluZyBvYnNlcnZhYmxlIHdpbGwgdGltZW91dCBpZiB0aGUgc291cmNlIG9ic2VydmFibGVcbiAqIGRvZXMgbm90IGVtaXQgYXQgbGVhc3Qgb25lIHZhbHVlLlxuICogQHBhcmFtIHNjaGVkdWxlciBUaGUgc2NoZWR1bGVyIHRvIHVzZS4gRGVmYXVsdHMgdG8ge0BsaW5rIGFzeW5jU2NoZWR1bGVyfS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRpbWVvdXQ8VD4oZmlyc3Q6IERhdGUsIHNjaGVkdWxlcj86IFNjaGVkdWxlckxpa2UpOiBNb25vVHlwZU9wZXJhdG9yRnVuY3Rpb248VD47XG5cbi8qKlxuICogUmV0dXJucyBhbiBvYnNlcnZhYmxlIHRoYXQgd2lsbCBlcnJvciBpZiB0aGUgc291cmNlIGRvZXMgbm90IHB1c2ggYSB2YWx1ZSB3aXRoaW4gdGhlIHNwZWNpZmllZCB0aW1lIGluIG1pbGxpc2Vjb25kcy5cbiAqIFRoaXMgaXMgZnVuY3Rpb25hbGx5IHRoZSBzYW1lIGFzIGB0aW1lb3V0KHsgZWFjaDogbWlsbGlzZWNvbmRzIH0pYC5cbiAqXG4gKiA8c3BhbiBjbGFzcz1cImluZm9ybWFsXCI+RXJyb3JzIGlmIGl0IHdhaXRzIHRvbyBsb25nIGJldHdlZW4gYW55IHZhbHVlPC9zcGFuPlxuICpcbiAqICFbXSh0aW1lb3V0LnBuZylcbiAqXG4gKiBAcGFyYW0gZWFjaCBUaGUgdGltZSBhbGxvd2VkIGJldHdlZW4gZWFjaCBwdXNoZWQgdmFsdWUgZnJvbSB0aGUgc291cmNlIGJlZm9yZSB0aGUgcmVzdWx0aW5nIG9ic2VydmFibGVcbiAqIHdpbGwgdGltZW91dC5cbiAqIEBwYXJhbSBzY2hlZHVsZXIgVGhlIHNjaGVkdWxlciB0byB1c2UuIERlZmF1bHRzIHRvIHtAbGluayBhc3luY1NjaGVkdWxlcn0uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0aW1lb3V0PFQ+KGVhY2g6IG51bWJlciwgc2NoZWR1bGVyPzogU2NoZWR1bGVyTGlrZSk6IE1vbm9UeXBlT3BlcmF0b3JGdW5jdGlvbjxUPjtcblxuLyoqXG4gKlxuICogRXJyb3JzIGlmIE9ic2VydmFibGUgZG9lcyBub3QgZW1pdCBhIHZhbHVlIGluIGdpdmVuIHRpbWUgc3Bhbi5cbiAqXG4gKiA8c3BhbiBjbGFzcz1cImluZm9ybWFsXCI+VGltZW91dHMgb24gT2JzZXJ2YWJsZSB0aGF0IGRvZXNuJ3QgZW1pdCB2YWx1ZXMgZmFzdCBlbm91Z2guPC9zcGFuPlxuICpcbiAqICFbXSh0aW1lb3V0LnBuZylcbiAqXG4gKiBAc2VlIHtAbGluayB0aW1lb3V0V2l0aH1cbiAqXG4gKiBAcmV0dXJuIEEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIGFuIE9ic2VydmFibGUgdGhhdCBtaXJyb3JzIGJlaGF2aW91ciBvZiB0aGVcbiAqIHNvdXJjZSBPYnNlcnZhYmxlLCB1bmxlc3MgdGltZW91dCBoYXBwZW5zIHdoZW4gaXQgdGhyb3dzIGFuIGVycm9yLlxuICovXG5leHBvcnQgZnVuY3Rpb24gdGltZW91dDxULCBPIGV4dGVuZHMgT2JzZXJ2YWJsZUlucHV0PGFueT4sIE0+KFxuICBjb25maWc6IG51bWJlciB8IERhdGUgfCBUaW1lb3V0Q29uZmlnPFQsIE8sIE0+LFxuICBzY2hlZHVsZXJBcmc/OiBTY2hlZHVsZXJMaWtlXG4pOiBPcGVyYXRvckZ1bmN0aW9uPFQsIFQgfCBPYnNlcnZlZFZhbHVlT2Y8Tz4+IHtcbiAgLy8gSW50ZW50aW9uYWxseSB0ZXJzZSBjb2RlLlxuICAvLyBJZiB0aGUgZmlyc3QgYXJndW1lbnQgaXMgYSB2YWxpZCBgRGF0ZWAsIHRoZW4gd2UgdXNlIGl0IGFzIHRoZSBgZmlyc3RgIGNvbmZpZy5cbiAgLy8gT3RoZXJ3aXNlLCBpZiB0aGUgZmlyc3QgYXJndW1lbnQgaXMgYSBgbnVtYmVyYCwgdGhlbiB3ZSB1c2UgaXQgYXMgdGhlIGBlYWNoYCBjb25maWcuXG4gIC8vIE90aGVyd2lzZSwgaXQgY2FuIGJlIGFzc3VtZWQgdGhlIGZpcnN0IGFyZ3VtZW50IGlzIHRoZSBjb25maWd1cmF0aW9uIG9iamVjdCBpdHNlbGYsIGFuZFxuICAvLyB3ZSBkZXN0cnVjdHVyZSB0aGF0IGludG8gd2hhdCB3ZSdyZSBnb2luZyB0byB1c2UsIHNldHRpbmcgaW1wb3J0YW50IGRlZmF1bHRzIGFzIHdlIGRvLlxuICAvLyBOT1RFOiBUaGUgZGVmYXVsdCBmb3IgYHNjaGVkdWxlcmAgd2lsbCBiZSB0aGUgYHNjaGVkdWxlcmAgYXJndW1lbnQgaWYgaXQgZXhpc3RzLCBvclxuICAvLyBpdCB3aWxsIGRlZmF1bHQgdG8gdGhlIGBhc3luY1NjaGVkdWxlcmAuXG4gIGNvbnN0IHtcbiAgICBmaXJzdCxcbiAgICBlYWNoLFxuICAgIHdpdGg6IF93aXRoID0gdGltZW91dEVycm9yRmFjdG9yeSxcbiAgICBzY2hlZHVsZXIgPSBzY2hlZHVsZXJBcmcgPz8gYXN5bmNTY2hlZHVsZXIsXG4gICAgbWV0YSA9IG51bGwhLFxuICB9ID0gKGlzVmFsaWREYXRlKGNvbmZpZykgPyB7IGZpcnN0OiBjb25maWcgfSA6IHR5cGVvZiBjb25maWcgPT09ICdudW1iZXInID8geyBlYWNoOiBjb25maWcgfSA6IGNvbmZpZykgYXMgVGltZW91dENvbmZpZzxULCBPLCBNPjtcblxuICBpZiAoZmlyc3QgPT0gbnVsbCAmJiBlYWNoID09IG51bGwpIHtcbiAgICAvLyBFbnN1cmUgdGltZW91dCB3YXMgcHJvdmlkZWQgYXQgcnVudGltZS5cbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdObyB0aW1lb3V0IHByb3ZpZGVkLicpO1xuICB9XG5cbiAgcmV0dXJuIG9wZXJhdGUoKHNvdXJjZSwgc3Vic2NyaWJlcikgPT4ge1xuICAgIC8vIFRoaXMgc3Vic2NyaXB0aW9uIGVuY2Fwc3VsYXRlcyBvdXIgc3Vic2NyaXB0aW9uIHRvIHRoZVxuICAgIC8vIHNvdXJjZSBmb3IgdGhpcyBvcGVyYXRvci4gV2UncmUgY2FwdHVyaW5nIGl0IHNlcGFyYXRlbHksXG4gICAgLy8gYmVjYXVzZSBpZiB0aGVyZSBpcyBhIGB3aXRoYCBvYnNlcnZhYmxlIHRvIGZhaWwgb3ZlciB0byxcbiAgICAvLyB3ZSB3YW50IHRvIHVuc3Vic2NyaWJlIGZyb20gb3VyIG9yaWdpbmFsIHN1YnNjcmlwdGlvbiwgYW5kXG4gICAgLy8gaGFuZCBvZiB0aGUgc3Vic2NyaXB0aW9uIHRvIHRoYXQgb25lLlxuICAgIGxldCBvcmlnaW5hbFNvdXJjZVN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuICAgIC8vIFRoZSBzdWJzY3JpcHRpb24gZm9yIG91ciB0aW1lb3V0IHRpbWVyLiBUaGlzIGNoYW5nZXNcbiAgICAvLyBldmVyeSB0aW1lIHdlIGdldCBhIG5ldyB2YWx1ZS5cbiAgICBsZXQgdGltZXJTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcbiAgICAvLyBBIGJpdCBvZiBzdGF0ZSB3ZSBwYXNzIHRvIG91ciB3aXRoIGFuZCBlcnJvciBmYWN0b3JpZXMgdG9cbiAgICAvLyB0ZWxsIHdoYXQgdGhlIGxhc3QgdmFsdWUgd2Ugc2F3IHdhcy5cbiAgICBsZXQgbGFzdFZhbHVlOiBUIHwgbnVsbCA9IG51bGw7XG4gICAgLy8gQSBiaXQgb2Ygc3RhdGUgd2UgcGFzcyB0byB0aGUgd2l0aCBhbmQgZXJyb3IgZmFjdG9yaWVzIHRvXG4gICAgLy8gdGVsbCBob3cgbWFueSB2YWx1ZXMgd2UgaGF2ZSBzZWVuIHNvIGZhci5cbiAgICBsZXQgc2VlbiA9IDA7XG4gICAgY29uc3Qgc3RhcnRUaW1lciA9IChkZWxheTogbnVtYmVyKSA9PiB7XG4gICAgICB0aW1lclN1YnNjcmlwdGlvbiA9IGV4ZWN1dGVTY2hlZHVsZShcbiAgICAgICAgc3Vic2NyaWJlcixcbiAgICAgICAgc2NoZWR1bGVyLFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9yaWdpbmFsU291cmNlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICBpbm5lckZyb20oXG4gICAgICAgICAgICAgIF93aXRoISh7XG4gICAgICAgICAgICAgICAgbWV0YSxcbiAgICAgICAgICAgICAgICBsYXN0VmFsdWUsXG4gICAgICAgICAgICAgICAgc2VlbixcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICkuc3Vic2NyaWJlKHN1YnNjcmliZXIpO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgc3Vic2NyaWJlci5lcnJvcihlcnIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZGVsYXlcbiAgICAgICk7XG4gICAgfTtcblxuICAgIG9yaWdpbmFsU291cmNlU3Vic2NyaXB0aW9uID0gc291cmNlLnN1YnNjcmliZShcbiAgICAgIGNyZWF0ZU9wZXJhdG9yU3Vic2NyaWJlcihcbiAgICAgICAgc3Vic2NyaWJlcixcbiAgICAgICAgKHZhbHVlOiBUKSA9PiB7XG4gICAgICAgICAgLy8gY2xlYXIgdGhlIHRpbWVyIHNvIHdlIGNhbiBlbWl0IGFuZCBzdGFydCBhbm90aGVyIG9uZS5cbiAgICAgICAgICB0aW1lclN1YnNjcmlwdGlvbj8udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICBzZWVuKys7XG4gICAgICAgICAgLy8gRW1pdFxuICAgICAgICAgIHN1YnNjcmliZXIubmV4dCgobGFzdFZhbHVlID0gdmFsdWUpKTtcbiAgICAgICAgICAvLyBudWxsIHwgdW5kZWZpbmVkIGFyZSBib3RoIDwgMC4gVGhhbmtzLCBKYXZhU2NyaXB0LlxuICAgICAgICAgIGVhY2ghID4gMCAmJiBzdGFydFRpbWVyKGVhY2ghKTtcbiAgICAgICAgfSxcbiAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICBpZiAoIXRpbWVyU3Vic2NyaXB0aW9uPy5jbG9zZWQpIHtcbiAgICAgICAgICAgIHRpbWVyU3Vic2NyaXB0aW9uPy51bnN1YnNjcmliZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBCZSBzdXJlIG5vdCB0byBob2xkIHRoZSBsYXN0IHZhbHVlIGluIG1lbW9yeSBhZnRlciB1bnN1YnNjcmlwdGlvblxuICAgICAgICAgIC8vIGl0IGNvdWxkIGJlIHF1aXRlIGxhcmdlLlxuICAgICAgICAgIGxhc3RWYWx1ZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIClcbiAgICApO1xuXG4gICAgLy8gSW50ZW50aW9uYWxseSB0ZXJzZSBjb2RlLlxuICAgIC8vIElmIHdlJ3ZlIGBzZWVuYCBhIHZhbHVlLCB0aGF0IG1lYW5zIHRoZSBcImZpcnN0XCIgY2xhdXNlIHdhcyBtZXQgYWxyZWFkeSwgaWYgaXQgZXhpc3RlZC5cbiAgICAvLyAgIGl0IGFsc28gbWVhbnMgdGhhdCBhIHRpbWVyIHdhcyBhbHJlYWR5IHN0YXJ0ZWQgZm9yIFwiZWFjaFwiIChpbiB0aGUgbmV4dCBoYW5kbGVyIGFib3ZlKS5cbiAgICAvLyBJZiBgZmlyc3RgIHdhcyBwcm92aWRlZCwgYW5kIGl0J3MgYSBudW1iZXIsIHRoZW4gdXNlIGl0LlxuICAgIC8vIElmIGBmaXJzdGAgd2FzIHByb3ZpZGVkIGFuZCBpdCdzIG5vdCBhIG51bWJlciwgaXQncyBhIERhdGUsIGFuZCB3ZSBnZXQgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBpdCBhbmQgXCJub3dcIi5cbiAgICAvLyBJZiBgZmlyc3RgIHdhcyBub3QgcHJvdmlkZWQgYXQgYWxsLCB0aGVuIG91ciBmaXJzdCB0aW1lciB3aWxsIGJlIHRoZSB2YWx1ZSBmcm9tIGBlYWNoYC5cbiAgICAhc2VlbiAmJiBzdGFydFRpbWVyKGZpcnN0ICE9IG51bGwgPyAodHlwZW9mIGZpcnN0ID09PSAnbnVtYmVyJyA/IGZpcnN0IDogK2ZpcnN0IC0gc2NoZWR1bGVyIS5ub3coKSkgOiBlYWNoISk7XG4gIH0pO1xufVxuXG4vKipcbiAqIFRoZSBkZWZhdWx0IGZ1bmN0aW9uIHRvIHVzZSB0byBlbWl0IGFuIGVycm9yIHdoZW4gdGltZW91dCBvY2N1cnMgYW5kIGEgYHdpdGhgIGZ1bmN0aW9uXG4gKiBpcyBub3Qgc3BlY2lmaWVkLlxuICogQHBhcmFtIGluZm8gVGhlIGluZm9ybWF0aW9uIGFib3V0IHRoZSB0aW1lb3V0IHRvIHBhc3MgYWxvbmcgdG8gdGhlIGVycm9yXG4gKi9cbmZ1bmN0aW9uIHRpbWVvdXRFcnJvckZhY3RvcnkoaW5mbzogVGltZW91dEluZm88YW55Pik6IE9ic2VydmFibGU8bmV2ZXI+IHtcbiAgdGhyb3cgbmV3IFRpbWVvdXRFcnJvcihpbmZvKTtcbn1cbiJdfQ==
