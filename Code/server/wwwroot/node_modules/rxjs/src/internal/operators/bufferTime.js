import{Subscription}from"../Subscription";import{operate}from"../util/lift";import{createOperatorSubscriber}from"./OperatorSubscriber";import{arrRemove}from"../util/arrRemove";import{asyncScheduler}from"../scheduler/async";import{popScheduler}from"../util/args";import{executeSchedule}from"../util/executeSchedule";function bufferTime(s,...e){let f=popScheduler(e)??asyncScheduler,u=e[0]??null,b=e[1]||1/0;return operate((e,t)=>{let o=[],i=!1,c=e=>{var{buffer:r,subs:u}=e;u.unsubscribe(),arrRemove(o,e),t.next(r),i&&l()},l=()=>{if(o){var r=new Subscription,u=(t.add(r),[]);let e={buffer:u,subs:r};o.push(e),executeSchedule(r,f,()=>c(e),s)}},r=(null!==u&&0<=u?executeSchedule(t,f,l,u,!0):i=!0,l(),createOperatorSubscriber(t,e=>{var r;for(r of o.slice()){var u=r.buffer;u.push(e),b<=u.length&&c(r)}},()=>{for(;o?.length;)t.next(o.shift().buffer);r?.unsubscribe(),t.complete(),t.unsubscribe()},void 0,()=>o=null));e.subscribe(r)})}export{bufferTime};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9yeGpzL3NyYy9pbnRlcm5hbC9vcGVyYXRvcnMvYnVmZmVyVGltZS50cyJdLCJuYW1lcyI6WyJTdWJzY3JpcHRpb24iLCJvcGVyYXRlIiwiY3JlYXRlT3BlcmF0b3JTdWJzY3JpYmVyIiwiYXJyUmVtb3ZlIiwiYXN5bmNTY2hlZHVsZXIiLCJwb3BTY2hlZHVsZXIiLCJleGVjdXRlU2NoZWR1bGUiLCJidWZmZXJUaW1lIiwiYnVmZmVyVGltZVNwYW4iLCJvdGhlckFyZ3MiLCJzY2hlZHVsZXIiLCJidWZmZXJDcmVhdGlvbkludGVydmFsIiwibWF4QnVmZmVyU2l6ZSIsIkluZmluaXR5Iiwic291cmNlIiwic3Vic2NyaWJlciIsImxldCIsImJ1ZmZlclJlY29yZHMiLCJyZXN0YXJ0T25FbWl0IiwiZW1pdCIsImJ1ZmZlciIsInN1YnMiLCJyZWNvcmQiLCJ1bnN1YnNjcmliZSIsIm5leHQiLCJzdGFydEJ1ZmZlciIsImFkZCIsInB1c2giLCJidWZmZXJUaW1lU3Vic2NyaWJlciIsInNsaWNlIiwidmFsdWUiLCJsZW5ndGgiLCJzaGlmdCIsImNvbXBsZXRlIiwidW5kZWZpbmVkIiwic3Vic2NyaWJlIl0sIm1hcHBpbmdzIjoiT0FBU0EsWUFBcUMsS0FBakIseUJBRXBCQyxPQUE2QixLQUFkLHNCQUNmQyx3QkFBc0QsS0FBdEIsOEJBQ2hDQyxTQUFvQyxLQUFuQiwyQkFDakJDLGNBQTBDLEtBQXBCLDRCQUN0QkMsWUFBa0MsS0FBZCxzQkFDcEJDLGVBQWdELEtBQXpCLDBCQW1FMUIsU0FBVUMsV0FBY0MsS0FBMkJDLEdBQ3ZELElBQU1DLEVBQVlMLGFBQWFJLENBQVMsR0FBS0wsZUFDdkNPLEVBQTBCRixFQUFVLElBQWlCLEtBQ3JERyxFQUFpQkgsRUFBVSxJQUFpQkksRUFBQUEsRUFFbEQsT0FBT1osUUFBUSxDQUFDYSxFQUFRQyxLQUV0QkMsSUFBSUMsRUFBOEQsR0FHOURDLEVBQWdCLENBQUEsRUFRZEMsRUFBTyxJQUNYLEdBQU0sQ0FBRUMsT0FBQUEsRUFBUUMsS0FBQUEsQ0FBSSxFQUFLQyxFQUN6QkQsRUFBS0UsWUFBVyxFQUNoQnBCLFVBQVVjLEVBQWVLLENBQU0sRUFDL0JQLEVBQVdTLEtBQUtKLENBQU0sRUFDdEJGLEdBQWlCTyxFQUFXLENBQzlCLEVBT01BLEVBQWMsS0FDbEIsR0FBSVIsRUFBZSxDQUNqQixJQUFNSSxFQUFPLElBQUlyQixhQUVYb0IsR0FETkwsRUFBV1csSUFBSUwsQ0FBSSxFQUNDLElBQ3BCLElBQU1DLEVBQVMsQ0FDYkYsT0FBQUEsRUFDQUMsS0FBQUEsQyxFQUVGSixFQUFjVSxLQUFLTCxDQUFNLEVBQ3pCaEIsZ0JBQWdCZSxFQUFNWCxFQUFXLElBQU1TLEVBQUtHLENBQU0sRUFBR2QsQ0FBYyxDQUNyRSxDQUNGLEVBYU1vQixHQVh5QixPQUEzQmpCLEdBQTZELEdBQTFCQSxFQUlyQ0wsZ0JBQWdCUyxFQUFZTCxFQUFXZSxFQUFhZCxFQUF3QixDQUFBLENBQUksRUFFaEZPLEVBQWdCLENBQUEsRUFHbEJPLEVBQVcsRUFFa0J2Qix5QkFDM0JhLEVBQ0EsSUFLRSxJQUNXTyxFQUFYLElBQVdBLEtBRFNMLEVBQWVZLE1BQUssRUFDTixDQUVoQyxJQUFRVCxFQUFXRSxFQUFMLE9BQ2RGLEVBQU9PLEtBQUtHLENBQUssRUFFakJsQixHQUFpQlEsRUFBT1csUUFBVVosRUFBS0csQ0FBTSxDQUMvQyxDQUNGLEVBQ0EsS0FHRSxLQUFPTCxHQUFlYyxRQUNwQmhCLEVBQVdTLEtBQUtQLEVBQWNlLE1BQUssRUFBSVosTUFBTSxFQUUvQ1EsR0FBc0JMLFlBQVcsRUFDakNSLEVBQVdrQixTQUFRLEVBQ25CbEIsRUFBV1EsWUFBVyxDQUN4QixFQUVBVyxLQUFBQSxFQUVBLElBQU9qQixFQUFnQixJQUFLLEdBRzlCSCxFQUFPcUIsVUFBVVAsQ0FBb0IsQ0FDdkMsQ0FBQyxDQUNILFFBMUZnQnJCLFVBMEZoQiIsImZpbGUiOiJub2RlX21vZHVsZXMvcnhqcy9zcmMvaW50ZXJuYWwvb3BlcmF0b3JzL2J1ZmZlclRpbWUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICcuLi9TdWJzY3JpcHRpb24nO1xuaW1wb3J0IHsgT3BlcmF0b3JGdW5jdGlvbiwgU2NoZWR1bGVyTGlrZSB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7IG9wZXJhdGUgfSBmcm9tICcuLi91dGlsL2xpZnQnO1xuaW1wb3J0IHsgY3JlYXRlT3BlcmF0b3JTdWJzY3JpYmVyIH0gZnJvbSAnLi9PcGVyYXRvclN1YnNjcmliZXInO1xuaW1wb3J0IHsgYXJyUmVtb3ZlIH0gZnJvbSAnLi4vdXRpbC9hcnJSZW1vdmUnO1xuaW1wb3J0IHsgYXN5bmNTY2hlZHVsZXIgfSBmcm9tICcuLi9zY2hlZHVsZXIvYXN5bmMnO1xuaW1wb3J0IHsgcG9wU2NoZWR1bGVyIH0gZnJvbSAnLi4vdXRpbC9hcmdzJztcbmltcG9ydCB7IGV4ZWN1dGVTY2hlZHVsZSB9IGZyb20gJy4uL3V0aWwvZXhlY3V0ZVNjaGVkdWxlJztcblxuZXhwb3J0IGZ1bmN0aW9uIGJ1ZmZlclRpbWU8VD4oYnVmZmVyVGltZVNwYW46IG51bWJlciwgc2NoZWR1bGVyPzogU2NoZWR1bGVyTGlrZSk6IE9wZXJhdG9yRnVuY3Rpb248VCwgVFtdPjtcbmV4cG9ydCBmdW5jdGlvbiBidWZmZXJUaW1lPFQ+KFxuICBidWZmZXJUaW1lU3BhbjogbnVtYmVyLFxuICBidWZmZXJDcmVhdGlvbkludGVydmFsOiBudW1iZXIgfCBudWxsIHwgdW5kZWZpbmVkLFxuICBzY2hlZHVsZXI/OiBTY2hlZHVsZXJMaWtlXG4pOiBPcGVyYXRvckZ1bmN0aW9uPFQsIFRbXT47XG5leHBvcnQgZnVuY3Rpb24gYnVmZmVyVGltZTxUPihcbiAgYnVmZmVyVGltZVNwYW46IG51bWJlcixcbiAgYnVmZmVyQ3JlYXRpb25JbnRlcnZhbDogbnVtYmVyIHwgbnVsbCB8IHVuZGVmaW5lZCxcbiAgbWF4QnVmZmVyU2l6ZTogbnVtYmVyLFxuICBzY2hlZHVsZXI/OiBTY2hlZHVsZXJMaWtlXG4pOiBPcGVyYXRvckZ1bmN0aW9uPFQsIFRbXT47XG5cbi8qKlxuICogQnVmZmVycyB0aGUgc291cmNlIE9ic2VydmFibGUgdmFsdWVzIGZvciBhIHNwZWNpZmljIHRpbWUgcGVyaW9kLlxuICpcbiAqIDxzcGFuIGNsYXNzPVwiaW5mb3JtYWxcIj5Db2xsZWN0cyB2YWx1ZXMgZnJvbSB0aGUgcGFzdCBhcyBhbiBhcnJheSwgYW5kIGVtaXRzXG4gKiB0aG9zZSBhcnJheXMgcGVyaW9kaWNhbGx5IGluIHRpbWUuPC9zcGFuPlxuICpcbiAqICFbXShidWZmZXJUaW1lLnBuZylcbiAqXG4gKiBCdWZmZXJzIHZhbHVlcyBmcm9tIHRoZSBzb3VyY2UgZm9yIGEgc3BlY2lmaWMgdGltZSBkdXJhdGlvbiBgYnVmZmVyVGltZVNwYW5gLlxuICogVW5sZXNzIHRoZSBvcHRpb25hbCBhcmd1bWVudCBgYnVmZmVyQ3JlYXRpb25JbnRlcnZhbGAgaXMgZ2l2ZW4sIGl0IGVtaXRzIGFuZFxuICogcmVzZXRzIHRoZSBidWZmZXIgZXZlcnkgYGJ1ZmZlclRpbWVTcGFuYCBtaWxsaXNlY29uZHMuIElmXG4gKiBgYnVmZmVyQ3JlYXRpb25JbnRlcnZhbGAgaXMgZ2l2ZW4sIHRoaXMgb3BlcmF0b3Igb3BlbnMgdGhlIGJ1ZmZlciBldmVyeVxuICogYGJ1ZmZlckNyZWF0aW9uSW50ZXJ2YWxgIG1pbGxpc2Vjb25kcyBhbmQgY2xvc2VzIChlbWl0cyBhbmQgcmVzZXRzKSB0aGVcbiAqIGJ1ZmZlciBldmVyeSBgYnVmZmVyVGltZVNwYW5gIG1pbGxpc2Vjb25kcy4gV2hlbiB0aGUgb3B0aW9uYWwgYXJndW1lbnRcbiAqIGBtYXhCdWZmZXJTaXplYCBpcyBzcGVjaWZpZWQsIHRoZSBidWZmZXIgd2lsbCBiZSBjbG9zZWQgZWl0aGVyIGFmdGVyXG4gKiBgYnVmZmVyVGltZVNwYW5gIG1pbGxpc2Vjb25kcyBvciB3aGVuIGl0IGNvbnRhaW5zIGBtYXhCdWZmZXJTaXplYCBlbGVtZW50cy5cbiAqXG4gKiAjIyBFeGFtcGxlc1xuICpcbiAqIEV2ZXJ5IHNlY29uZCwgZW1pdCBhbiBhcnJheSBvZiB0aGUgcmVjZW50IGNsaWNrIGV2ZW50c1xuICpcbiAqIGBgYHRzXG4gKiBpbXBvcnQgeyBmcm9tRXZlbnQsIGJ1ZmZlclRpbWUgfSBmcm9tICdyeGpzJztcbiAqXG4gKiBjb25zdCBjbGlja3MgPSBmcm9tRXZlbnQoZG9jdW1lbnQsICdjbGljaycpO1xuICogY29uc3QgYnVmZmVyZWQgPSBjbGlja3MucGlwZShidWZmZXJUaW1lKDEwMDApKTtcbiAqIGJ1ZmZlcmVkLnN1YnNjcmliZSh4ID0+IGNvbnNvbGUubG9nKHgpKTtcbiAqIGBgYFxuICpcbiAqIEV2ZXJ5IDUgc2Vjb25kcywgZW1pdCB0aGUgY2xpY2sgZXZlbnRzIGZyb20gdGhlIG5leHQgMiBzZWNvbmRzXG4gKlxuICogYGBgdHNcbiAqIGltcG9ydCB7IGZyb21FdmVudCwgYnVmZmVyVGltZSB9IGZyb20gJ3J4anMnO1xuICpcbiAqIGNvbnN0IGNsaWNrcyA9IGZyb21FdmVudChkb2N1bWVudCwgJ2NsaWNrJyk7XG4gKiBjb25zdCBidWZmZXJlZCA9IGNsaWNrcy5waXBlKGJ1ZmZlclRpbWUoMjAwMCwgNTAwMCkpO1xuICogYnVmZmVyZWQuc3Vic2NyaWJlKHggPT4gY29uc29sZS5sb2coeCkpO1xuICogYGBgXG4gKlxuICogQHNlZSB7QGxpbmsgYnVmZmVyfVxuICogQHNlZSB7QGxpbmsgYnVmZmVyQ291bnR9XG4gKiBAc2VlIHtAbGluayBidWZmZXJUb2dnbGV9XG4gKiBAc2VlIHtAbGluayBidWZmZXJXaGVufVxuICogQHNlZSB7QGxpbmsgd2luZG93VGltZX1cbiAqXG4gKiBAcGFyYW0gYnVmZmVyVGltZVNwYW4gVGhlIGFtb3VudCBvZiB0aW1lIHRvIGZpbGwgZWFjaCBidWZmZXIgYXJyYXkuXG4gKiBAcGFyYW0gb3RoZXJBcmdzIE90aGVyIGNvbmZpZ3VyYXRpb24gYXJndW1lbnRzIHN1Y2ggYXM6XG4gKiAtIGBidWZmZXJDcmVhdGlvbkludGVydmFsYCAtIHRoZSBpbnRlcnZhbCBhdCB3aGljaCB0byBzdGFydCBuZXcgYnVmZmVycztcbiAqIC0gYG1heEJ1ZmZlclNpemVgIC0gdGhlIG1heGltdW0gYnVmZmVyIHNpemU7XG4gKiAtIGBzY2hlZHVsZXJgIC0gdGhlIHNjaGVkdWxlciBvbiB3aGljaCB0byBzY2hlZHVsZSB0aGUgaW50ZXJ2YWxzIHRoYXQgZGV0ZXJtaW5lIGJ1ZmZlciBib3VuZGFyaWVzLlxuICogQHJldHVybiBBIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyBhbiBPYnNlcnZhYmxlIG9mIGFycmF5cyBvZiBidWZmZXJlZCB2YWx1ZXMuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBidWZmZXJUaW1lPFQ+KGJ1ZmZlclRpbWVTcGFuOiBudW1iZXIsIC4uLm90aGVyQXJnczogYW55W10pOiBPcGVyYXRvckZ1bmN0aW9uPFQsIFRbXT4ge1xuICBjb25zdCBzY2hlZHVsZXIgPSBwb3BTY2hlZHVsZXIob3RoZXJBcmdzKSA/PyBhc3luY1NjaGVkdWxlcjtcbiAgY29uc3QgYnVmZmVyQ3JlYXRpb25JbnRlcnZhbCA9IChvdGhlckFyZ3NbMF0gYXMgbnVtYmVyKSA/PyBudWxsO1xuICBjb25zdCBtYXhCdWZmZXJTaXplID0gKG90aGVyQXJnc1sxXSBhcyBudW1iZXIpIHx8IEluZmluaXR5O1xuXG4gIHJldHVybiBvcGVyYXRlKChzb3VyY2UsIHN1YnNjcmliZXIpID0+IHtcbiAgICAvLyBUaGUgYWN0aXZlIGJ1ZmZlcnMsIHRoZWlyIHJlbGF0ZWQgc3Vic2NyaXB0aW9ucywgYW5kIHJlbW92YWwgZnVuY3Rpb25zLlxuICAgIGxldCBidWZmZXJSZWNvcmRzOiB7IGJ1ZmZlcjogVFtdOyBzdWJzOiBTdWJzY3JpcHRpb24gfVtdIHwgbnVsbCA9IFtdO1xuICAgIC8vIElmIHRydWUsIGl0IG1lYW5zIHRoYXQgZXZlcnkgdGltZSB3ZSBlbWl0IGEgYnVmZmVyLCB3ZSB3YW50IHRvIHN0YXJ0IGEgbmV3IGJ1ZmZlclxuICAgIC8vIHRoaXMgaXMgb25seSByZWFsbHkgdXNlZCBmb3Igd2hlbiAqanVzdCogdGhlIGJ1ZmZlciB0aW1lIHNwYW4gaXMgcGFzc2VkLlxuICAgIGxldCByZXN0YXJ0T25FbWl0ID0gZmFsc2U7XG5cbiAgICAvKipcbiAgICAgKiBEb2VzIHRoZSB3b3JrIG9mIGVtaXR0aW5nIHRoZSBidWZmZXIgZnJvbSB0aGUgcmVjb3JkLCBlbnN1cmluZyB0aGF0IHRoZVxuICAgICAqIHJlY29yZCBpcyByZW1vdmVkIGJlZm9yZSB0aGUgZW1pc3Npb24gc28gcmVlbnRyYW50IGNvZGUgKGZyb20gc29tZSBjdXN0b20gc2NoZWR1bGluZywgcGVyaGFwcylcbiAgICAgKiBkb2VzIG5vdCBhbHRlciB0aGUgYnVmZmVyLiBBbHNvIGNoZWNrcyB0byBzZWUgaWYgYSBuZXcgYnVmZmVyIG5lZWRzIHRvIGJlIHN0YXJ0ZWRcbiAgICAgKiBhZnRlciB0aGUgZW1pdC5cbiAgICAgKi9cbiAgICBjb25zdCBlbWl0ID0gKHJlY29yZDogeyBidWZmZXI6IFRbXTsgc3ViczogU3Vic2NyaXB0aW9uIH0pID0+IHtcbiAgICAgIGNvbnN0IHsgYnVmZmVyLCBzdWJzIH0gPSByZWNvcmQ7XG4gICAgICBzdWJzLnVuc3Vic2NyaWJlKCk7XG4gICAgICBhcnJSZW1vdmUoYnVmZmVyUmVjb3JkcywgcmVjb3JkKTtcbiAgICAgIHN1YnNjcmliZXIubmV4dChidWZmZXIpO1xuICAgICAgcmVzdGFydE9uRW1pdCAmJiBzdGFydEJ1ZmZlcigpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDYWxsZWQgZXZlcnkgdGltZSB3ZSBzdGFydCBhIG5ldyBidWZmZXIuIFRoaXMgZG9lc1xuICAgICAqIHRoZSB3b3JrIG9mIHNjaGVkdWxpbmcgYSBqb2IgYXQgdGhlIHJlcXVlc3RlZCBidWZmZXJUaW1lU3BhblxuICAgICAqIHRoYXQgd2lsbCBlbWl0IHRoZSBidWZmZXIgKGlmIGl0J3Mgbm90IHVuc3Vic2NyaWJlZCBiZWZvcmUgdGhlbikuXG4gICAgICovXG4gICAgY29uc3Qgc3RhcnRCdWZmZXIgPSAoKSA9PiB7XG4gICAgICBpZiAoYnVmZmVyUmVjb3Jkcykge1xuICAgICAgICBjb25zdCBzdWJzID0gbmV3IFN1YnNjcmlwdGlvbigpO1xuICAgICAgICBzdWJzY3JpYmVyLmFkZChzdWJzKTtcbiAgICAgICAgY29uc3QgYnVmZmVyOiBUW10gPSBbXTtcbiAgICAgICAgY29uc3QgcmVjb3JkID0ge1xuICAgICAgICAgIGJ1ZmZlcixcbiAgICAgICAgICBzdWJzLFxuICAgICAgICB9O1xuICAgICAgICBidWZmZXJSZWNvcmRzLnB1c2gocmVjb3JkKTtcbiAgICAgICAgZXhlY3V0ZVNjaGVkdWxlKHN1YnMsIHNjaGVkdWxlciwgKCkgPT4gZW1pdChyZWNvcmQpLCBidWZmZXJUaW1lU3Bhbik7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGlmIChidWZmZXJDcmVhdGlvbkludGVydmFsICE9PSBudWxsICYmIGJ1ZmZlckNyZWF0aW9uSW50ZXJ2YWwgPj0gMCkge1xuICAgICAgLy8gVGhlIHVzZXIgcGFzc2VkIGJvdGggYSBidWZmZXJUaW1lU3BhbiAocmVxdWlyZWQpLCBhbmQgYSBjcmVhdGlvbiBpbnRlcnZhbFxuICAgICAgLy8gVGhhdCBtZWFucyB3ZSBuZWVkIHRvIHN0YXJ0IG5ldyBidWZmZXJzIG9uIHRoZSBpbnRlcnZhbCwgYW5kIHRob3NlIGJ1ZmZlcnMgbmVlZFxuICAgICAgLy8gdG8gd2FpdCB0aGUgcmVxdWlyZWQgdGltZSBzcGFuIGJlZm9yZSBlbWl0dGluZy5cbiAgICAgIGV4ZWN1dGVTY2hlZHVsZShzdWJzY3JpYmVyLCBzY2hlZHVsZXIsIHN0YXJ0QnVmZmVyLCBidWZmZXJDcmVhdGlvbkludGVydmFsLCB0cnVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzdGFydE9uRW1pdCA9IHRydWU7XG4gICAgfVxuXG4gICAgc3RhcnRCdWZmZXIoKTtcblxuICAgIGNvbnN0IGJ1ZmZlclRpbWVTdWJzY3JpYmVyID0gY3JlYXRlT3BlcmF0b3JTdWJzY3JpYmVyKFxuICAgICAgc3Vic2NyaWJlcixcbiAgICAgICh2YWx1ZTogVCkgPT4ge1xuICAgICAgICAvLyBDb3B5IHRoZSByZWNvcmRzLCBzbyBpZiB3ZSBuZWVkIHRvIHJlbW92ZSBvbmUgd2VcbiAgICAgICAgLy8gZG9uJ3QgbXV0YXRlIHRoZSBhcnJheS4gSXQncyBoYXJkLCBidXQgbm90IGltcG9zc2libGUgdG9cbiAgICAgICAgLy8gc2V0IHVwIGEgYnVmZmVyIHRpbWUgdGhhdCBjb3VsZCBtdXRhdGUgdGhlIGFycmF5IGFuZFxuICAgICAgICAvLyBjYXVzZSBpc3N1ZXMgaGVyZS5cbiAgICAgICAgY29uc3QgcmVjb3Jkc0NvcHkgPSBidWZmZXJSZWNvcmRzIS5zbGljZSgpO1xuICAgICAgICBmb3IgKGNvbnN0IHJlY29yZCBvZiByZWNvcmRzQ29weSkge1xuICAgICAgICAgIC8vIExvb3Agb3ZlciBhbGwgYnVmZmVycyBhbmRcbiAgICAgICAgICBjb25zdCB7IGJ1ZmZlciB9ID0gcmVjb3JkO1xuICAgICAgICAgIGJ1ZmZlci5wdXNoKHZhbHVlKTtcbiAgICAgICAgICAvLyBJZiB0aGUgYnVmZmVyIGlzIG92ZXIgdGhlIG1heCBzaXplLCB3ZSBuZWVkIHRvIGVtaXQgaXQuXG4gICAgICAgICAgbWF4QnVmZmVyU2l6ZSA8PSBidWZmZXIubGVuZ3RoICYmIGVtaXQocmVjb3JkKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgICgpID0+IHtcbiAgICAgICAgLy8gVGhlIHNvdXJjZSBjb21wbGV0ZWQsIGVtaXQgYWxsIG9mIHRoZSBhY3RpdmVcbiAgICAgICAgLy8gYnVmZmVycyB3ZSBoYXZlIGJlZm9yZSB3ZSBjb21wbGV0ZS5cbiAgICAgICAgd2hpbGUgKGJ1ZmZlclJlY29yZHM/Lmxlbmd0aCkge1xuICAgICAgICAgIHN1YnNjcmliZXIubmV4dChidWZmZXJSZWNvcmRzLnNoaWZ0KCkhLmJ1ZmZlcik7XG4gICAgICAgIH1cbiAgICAgICAgYnVmZmVyVGltZVN1YnNjcmliZXI/LnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIHN1YnNjcmliZXIuY29tcGxldGUoKTtcbiAgICAgICAgc3Vic2NyaWJlci51bnN1YnNjcmliZSgpO1xuICAgICAgfSxcbiAgICAgIC8vIFBhc3MgYWxsIGVycm9ycyB0aHJvdWdoIHRvIGNvbnN1bWVyLlxuICAgICAgdW5kZWZpbmVkLFxuICAgICAgLy8gQ2xlYW4gdXBcbiAgICAgICgpID0+IChidWZmZXJSZWNvcmRzID0gbnVsbClcbiAgICApO1xuXG4gICAgc291cmNlLnN1YnNjcmliZShidWZmZXJUaW1lU3Vic2NyaWJlcik7XG4gIH0pO1xufVxuIl19
