import{Subject}from"../Subject";import{asyncScheduler}from"../scheduler/async";import{Subscription}from"../Subscription";import{operate}from"../util/lift";import{createOperatorSubscriber}from"./OperatorSubscriber";import{arrRemove}from"../util/arrRemove";import{popScheduler}from"../util/args";import{executeSchedule}from"../util/executeSchedule";function windowTime(s,...e){let p=popScheduler(e)??asyncScheduler,r=e[0]??null,m=e[1]||1/0;return operate((e,t)=>{let u=[],i=!1,c=e=>{var{window:r,subs:o}=e;r.complete(),o.unsubscribe(),arrRemove(u,e),i&&l()},l=()=>{if(u){var r=new Subscription,o=(t.add(r),new Subject);let e={window:o,subs:r,seen:0};u.push(e),t.next(o.asObservable()),executeSchedule(r,p,()=>c(e),s)}},o=(null!==r&&0<=r?executeSchedule(t,p,l,r,!0):i=!0,l(),e=>u.slice().forEach(e)),n=r=>{o(({window:e})=>r(e)),r(t),t.unsubscribe()};return e.subscribe(createOperatorSubscriber(t,r=>{o(e=>{e.window.next(r),m<=++e.seen&&c(e)})},()=>n(e=>e.complete()),r=>n(e=>e.error(r)))),()=>{u=null}})}export{windowTime};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9yeGpzL3NyYy9pbnRlcm5hbC9vcGVyYXRvcnMvd2luZG93VGltZS50cyJdLCJuYW1lcyI6WyJTdWJqZWN0IiwiYXN5bmNTY2hlZHVsZXIiLCJTdWJzY3JpcHRpb24iLCJvcGVyYXRlIiwiY3JlYXRlT3BlcmF0b3JTdWJzY3JpYmVyIiwiYXJyUmVtb3ZlIiwicG9wU2NoZWR1bGVyIiwiZXhlY3V0ZVNjaGVkdWxlIiwid2luZG93VGltZSIsIndpbmRvd1RpbWVTcGFuIiwib3RoZXJBcmdzIiwic2NoZWR1bGVyIiwid2luZG93Q3JlYXRpb25JbnRlcnZhbCIsIm1heFdpbmRvd1NpemUiLCJJbmZpbml0eSIsInNvdXJjZSIsInN1YnNjcmliZXIiLCJsZXQiLCJ3aW5kb3dSZWNvcmRzIiwicmVzdGFydE9uQ2xvc2UiLCJjbG9zZVdpbmRvdyIsIndpbmRvdyIsInN1YnMiLCJyZWNvcmQiLCJjb21wbGV0ZSIsInVuc3Vic2NyaWJlIiwic3RhcnRXaW5kb3ciLCJhZGQiLCJzZWVuIiwicHVzaCIsIm5leHQiLCJhc09ic2VydmFibGUiLCJsb29wIiwic2xpY2UiLCJmb3JFYWNoIiwiY2IiLCJ0ZXJtaW5hdGUiLCJzdWJzY3JpYmUiLCJ2YWx1ZSIsImNvbnN1bWVyIiwiZXJyb3IiLCJlcnIiXSwibWFwcGluZ3MiOiJPQUFTQSxPQUEyQixLQUFaLG9CQUNmQyxjQUEwQyxLQUFwQiw0QkFFdEJDLFlBQXFDLEtBQWpCLHlCQUVwQkMsT0FBNkIsS0FBZCxzQkFDZkMsd0JBQXNELEtBQXRCLDhCQUNoQ0MsU0FBb0MsS0FBbkIsMkJBQ2pCQyxZQUFrQyxLQUFkLHNCQUNwQkMsZUFBZ0QsS0FBekIsMEJBZ0cxQixTQUFVQyxXQUFjQyxLQUEyQkMsR0FDdkQsSUFBTUMsRUFBWUwsYUFBYUksQ0FBUyxHQUFLVCxlQUN2Q1csRUFBMEJGLEVBQVUsSUFBaUIsS0FDckRHLEVBQWlCSCxFQUFVLElBQWlCSSxFQUFBQSxFQUVsRCxPQUFPWCxRQUFRLENBQUNZLEVBQVFDLEtBRXRCQyxJQUFJQyxFQUEwQyxHQUcxQ0MsRUFBaUIsQ0FBQSxFQUVmQyxFQUFjLElBQ2xCLEdBQU0sQ0FBRUMsT0FBQUEsRUFBUUMsS0FBQUEsQ0FBSSxFQUFLQyxFQUN6QkYsRUFBT0csU0FBUSxFQUNmRixFQUFLRyxZQUFXLEVBQ2hCcEIsVUFBVWEsRUFBZUssQ0FBTSxFQUMvQkosR0FBa0JPLEVBQVcsQ0FDL0IsRUFNTUEsRUFBYyxLQUNsQixHQUFJUixFQUFlLENBQ2pCLElBQU1JLEVBQU8sSUFBSXBCLGFBRVhtQixHQUROTCxFQUFXVyxJQUFJTCxDQUFJLEVBQ0osSUFBSXRCLFNBQ25CLElBQU11QixFQUFTLENBQ2JGLE9BQUFBLEVBQ0FDLEtBQUFBLEVBQ0FNLEtBQU0sQyxFQUVSVixFQUFjVyxLQUFLTixDQUFNLEVBQ3pCUCxFQUFXYyxLQUFLVCxFQUFPVSxhQUFZLENBQUUsRUFDckN4QixnQkFBZ0JlLEVBQU1YLEVBQVcsSUFBTVMsRUFBWUcsQ0FBTSxFQUFHZCxDQUFjLENBQzVFLENBQ0YsRUFtQk11QixHQWpCeUIsT0FBM0JwQixHQUE2RCxHQUExQkEsRUFJckNMLGdCQUFnQlMsRUFBWUwsRUFBV2UsRUFBYWQsRUFBd0IsQ0FBQSxDQUFJLEVBRWhGTyxFQUFpQixDQUFBLEVBR25CTyxFQUFXLEVBUUUsR0FBMkNSLEVBQWVlLE1BQUssRUFBR0MsUUFBUUMsQ0FBRSxHQU1uRkMsRUFBWSxJQUNoQkosRUFBSyxDQUFBLENBQUdYLE9BQUFBLENBQVEsSUFBS2MsRUFBR2QsQ0FBTSxDQUFDLEVBQy9CYyxFQUFHbkIsQ0FBVSxFQUNiQSxFQUFXUyxZQUFXLENBQ3hCLEVBdUJBLE9BckJBVixFQUFPc0IsVUFDTGpDLHlCQUNFWSxFQUNBLElBRUVnQixFQUFLLElBQ0hULEVBQU9GLE9BQU9TLEtBQUtRLENBQUssRUFFeEJ6QixHQUFpQixFQUFFVSxFQUFPSyxNQUFRUixFQUFZRyxDQUFNLENBQ3RELENBQUMsQ0FDSCxFQUVBLElBQU1hLEVBQVUsR0FBY0csRUFBU2YsU0FBUSxDQUFFLEVBRWpELEdBQVNZLEVBQVUsR0FBY0csRUFBU0MsTUFBTUMsQ0FBRyxDQUFDLENBQUMsQ0FDdEQsRUFNSSxLQUVMdkIsRUFBZ0IsSUFDbEIsQ0FDRixDQUFDLENBQ0gsUUEvRmdCVixVQStGaEIiLCJmaWxlIjoibm9kZV9tb2R1bGVzL3J4anMvc3JjL2ludGVybmFsL29wZXJhdG9ycy93aW5kb3dUaW1lLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJy4uL1N1YmplY3QnO1xuaW1wb3J0IHsgYXN5bmNTY2hlZHVsZXIgfSBmcm9tICcuLi9zY2hlZHVsZXIvYXN5bmMnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJy4uL09ic2VydmFibGUnO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAnLi4vU3Vic2NyaXB0aW9uJztcbmltcG9ydCB7IE9ic2VydmVyLCBPcGVyYXRvckZ1bmN0aW9uLCBTY2hlZHVsZXJMaWtlIH0gZnJvbSAnLi4vdHlwZXMnO1xuaW1wb3J0IHsgb3BlcmF0ZSB9IGZyb20gJy4uL3V0aWwvbGlmdCc7XG5pbXBvcnQgeyBjcmVhdGVPcGVyYXRvclN1YnNjcmliZXIgfSBmcm9tICcuL09wZXJhdG9yU3Vic2NyaWJlcic7XG5pbXBvcnQgeyBhcnJSZW1vdmUgfSBmcm9tICcuLi91dGlsL2FyclJlbW92ZSc7XG5pbXBvcnQgeyBwb3BTY2hlZHVsZXIgfSBmcm9tICcuLi91dGlsL2FyZ3MnO1xuaW1wb3J0IHsgZXhlY3V0ZVNjaGVkdWxlIH0gZnJvbSAnLi4vdXRpbC9leGVjdXRlU2NoZWR1bGUnO1xuXG5leHBvcnQgZnVuY3Rpb24gd2luZG93VGltZTxUPih3aW5kb3dUaW1lU3BhbjogbnVtYmVyLCBzY2hlZHVsZXI/OiBTY2hlZHVsZXJMaWtlKTogT3BlcmF0b3JGdW5jdGlvbjxULCBPYnNlcnZhYmxlPFQ+PjtcbmV4cG9ydCBmdW5jdGlvbiB3aW5kb3dUaW1lPFQ+KFxuICB3aW5kb3dUaW1lU3BhbjogbnVtYmVyLFxuICB3aW5kb3dDcmVhdGlvbkludGVydmFsOiBudW1iZXIsXG4gIHNjaGVkdWxlcj86IFNjaGVkdWxlckxpa2Vcbik6IE9wZXJhdG9yRnVuY3Rpb248VCwgT2JzZXJ2YWJsZTxUPj47XG5leHBvcnQgZnVuY3Rpb24gd2luZG93VGltZTxUPihcbiAgd2luZG93VGltZVNwYW46IG51bWJlcixcbiAgd2luZG93Q3JlYXRpb25JbnRlcnZhbDogbnVtYmVyIHwgbnVsbCB8IHZvaWQsXG4gIG1heFdpbmRvd1NpemU6IG51bWJlcixcbiAgc2NoZWR1bGVyPzogU2NoZWR1bGVyTGlrZVxuKTogT3BlcmF0b3JGdW5jdGlvbjxULCBPYnNlcnZhYmxlPFQ+PjtcblxuLyoqXG4gKiBCcmFuY2ggb3V0IHRoZSBzb3VyY2UgT2JzZXJ2YWJsZSB2YWx1ZXMgYXMgYSBuZXN0ZWQgT2JzZXJ2YWJsZSBwZXJpb2RpY2FsbHlcbiAqIGluIHRpbWUuXG4gKlxuICogPHNwYW4gY2xhc3M9XCJpbmZvcm1hbFwiPkl0J3MgbGlrZSB7QGxpbmsgYnVmZmVyVGltZX0sIGJ1dCBlbWl0cyBhIG5lc3RlZFxuICogT2JzZXJ2YWJsZSBpbnN0ZWFkIG9mIGFuIGFycmF5Ljwvc3Bhbj5cbiAqXG4gKiAhW10od2luZG93VGltZS5wbmcpXG4gKlxuICogUmV0dXJucyBhbiBPYnNlcnZhYmxlIHRoYXQgZW1pdHMgd2luZG93cyBvZiBpdGVtcyBpdCBjb2xsZWN0cyBmcm9tIHRoZSBzb3VyY2VcbiAqIE9ic2VydmFibGUuIFRoZSBvdXRwdXQgT2JzZXJ2YWJsZSBzdGFydHMgYSBuZXcgd2luZG93IHBlcmlvZGljYWxseSwgYXNcbiAqIGRldGVybWluZWQgYnkgdGhlIGB3aW5kb3dDcmVhdGlvbkludGVydmFsYCBhcmd1bWVudC4gSXQgZW1pdHMgZWFjaCB3aW5kb3dcbiAqIGFmdGVyIGEgZml4ZWQgdGltZXNwYW4sIHNwZWNpZmllZCBieSB0aGUgYHdpbmRvd1RpbWVTcGFuYCBhcmd1bWVudC4gV2hlbiB0aGVcbiAqIHNvdXJjZSBPYnNlcnZhYmxlIGNvbXBsZXRlcyBvciBlbmNvdW50ZXJzIGFuIGVycm9yLCB0aGUgb3V0cHV0IE9ic2VydmFibGVcbiAqIGVtaXRzIHRoZSBjdXJyZW50IHdpbmRvdyBhbmQgcHJvcGFnYXRlcyB0aGUgbm90aWZpY2F0aW9uIGZyb20gdGhlIHNvdXJjZVxuICogT2JzZXJ2YWJsZS4gSWYgYHdpbmRvd0NyZWF0aW9uSW50ZXJ2YWxgIGlzIG5vdCBwcm92aWRlZCwgdGhlIG91dHB1dFxuICogT2JzZXJ2YWJsZSBzdGFydHMgYSBuZXcgd2luZG93IHdoZW4gdGhlIHByZXZpb3VzIHdpbmRvdyBvZiBkdXJhdGlvblxuICogYHdpbmRvd1RpbWVTcGFuYCBjb21wbGV0ZXMuIElmIGBtYXhXaW5kb3dDb3VudGAgaXMgcHJvdmlkZWQsIGVhY2ggd2luZG93XG4gKiB3aWxsIGVtaXQgYXQgbW9zdCBmaXhlZCBudW1iZXIgb2YgdmFsdWVzLiBXaW5kb3cgd2lsbCBjb21wbGV0ZSBpbW1lZGlhdGVseVxuICogYWZ0ZXIgZW1pdHRpbmcgbGFzdCB2YWx1ZSBhbmQgbmV4dCBvbmUgc3RpbGwgd2lsbCBvcGVuIGFzIHNwZWNpZmllZCBieVxuICogYHdpbmRvd1RpbWVTcGFuYCBhbmQgYHdpbmRvd0NyZWF0aW9uSW50ZXJ2YWxgIGFyZ3VtZW50cy5cbiAqXG4gKiAjIyBFeGFtcGxlc1xuICpcbiAqIEluIGV2ZXJ5IHdpbmRvdyBvZiAxIHNlY29uZCBlYWNoLCBlbWl0IGF0IG1vc3QgMiBjbGljayBldmVudHNcbiAqXG4gKiBgYGB0c1xuICogaW1wb3J0IHsgZnJvbUV2ZW50LCB3aW5kb3dUaW1lLCBtYXAsIHRha2UsIG1lcmdlQWxsIH0gZnJvbSAncnhqcyc7XG4gKlxuICogY29uc3QgY2xpY2tzID0gZnJvbUV2ZW50KGRvY3VtZW50LCAnY2xpY2snKTtcbiAqIGNvbnN0IHJlc3VsdCA9IGNsaWNrcy5waXBlKFxuICogICB3aW5kb3dUaW1lKDEwMDApLFxuICogICBtYXAod2luID0+IHdpbi5waXBlKHRha2UoMikpKSwgLy8gdGFrZSBhdCBtb3N0IDIgZW1pc3Npb25zIGZyb20gZWFjaCB3aW5kb3dcbiAqICAgbWVyZ2VBbGwoKSAgICAgICAgICAgICAgICAgICAgIC8vIGZsYXR0ZW4gdGhlIE9ic2VydmFibGUtb2YtT2JzZXJ2YWJsZXNcbiAqICk7XG4gKiByZXN1bHQuc3Vic2NyaWJlKHggPT4gY29uc29sZS5sb2coeCkpO1xuICogYGBgXG4gKlxuICogRXZlcnkgNSBzZWNvbmRzIHN0YXJ0IGEgd2luZG93IDEgc2Vjb25kIGxvbmcsIGFuZCBlbWl0IGF0IG1vc3QgMiBjbGljayBldmVudHMgcGVyIHdpbmRvd1xuICpcbiAqIGBgYHRzXG4gKiBpbXBvcnQgeyBmcm9tRXZlbnQsIHdpbmRvd1RpbWUsIG1hcCwgdGFrZSwgbWVyZ2VBbGwgfSBmcm9tICdyeGpzJztcbiAqXG4gKiBjb25zdCBjbGlja3MgPSBmcm9tRXZlbnQoZG9jdW1lbnQsICdjbGljaycpO1xuICogY29uc3QgcmVzdWx0ID0gY2xpY2tzLnBpcGUoXG4gKiAgIHdpbmRvd1RpbWUoMTAwMCwgNTAwMCksXG4gKiAgIG1hcCh3aW4gPT4gd2luLnBpcGUodGFrZSgyKSkpLCAvLyB0YWtlIGF0IG1vc3QgMiBlbWlzc2lvbnMgZnJvbSBlYWNoIHdpbmRvd1xuICogICBtZXJnZUFsbCgpICAgICAgICAgICAgICAgICAgICAgLy8gZmxhdHRlbiB0aGUgT2JzZXJ2YWJsZS1vZi1PYnNlcnZhYmxlc1xuICogKTtcbiAqIHJlc3VsdC5zdWJzY3JpYmUoeCA9PiBjb25zb2xlLmxvZyh4KSk7XG4gKiBgYGBcbiAqXG4gKiBTYW1lIGFzIGV4YW1wbGUgYWJvdmUgYnV0IHdpdGggYG1heFdpbmRvd0NvdW50YCBpbnN0ZWFkIG9mIGB0YWtlYFxuICpcbiAqIGBgYHRzXG4gKiBpbXBvcnQgeyBmcm9tRXZlbnQsIHdpbmRvd1RpbWUsIG1lcmdlQWxsIH0gZnJvbSAncnhqcyc7XG4gKlxuICogY29uc3QgY2xpY2tzID0gZnJvbUV2ZW50KGRvY3VtZW50LCAnY2xpY2snKTtcbiAqIGNvbnN0IHJlc3VsdCA9IGNsaWNrcy5waXBlKFxuICogICB3aW5kb3dUaW1lKDEwMDAsIDUwMDAsIDIpLCAvLyB0YWtlIGF0IG1vc3QgMiBlbWlzc2lvbnMgZnJvbSBlYWNoIHdpbmRvd1xuICogICBtZXJnZUFsbCgpICAgICAgICAgICAgICAgICAvLyBmbGF0dGVuIHRoZSBPYnNlcnZhYmxlLW9mLU9ic2VydmFibGVzXG4gKiApO1xuICogcmVzdWx0LnN1YnNjcmliZSh4ID0+IGNvbnNvbGUubG9nKHgpKTtcbiAqIGBgYFxuICpcbiAqIEBzZWUge0BsaW5rIHdpbmRvd31cbiAqIEBzZWUge0BsaW5rIHdpbmRvd0NvdW50fVxuICogQHNlZSB7QGxpbmsgd2luZG93VG9nZ2xlfVxuICogQHNlZSB7QGxpbmsgd2luZG93V2hlbn1cbiAqIEBzZWUge0BsaW5rIGJ1ZmZlclRpbWV9XG4gKlxuICogQHBhcmFtIHdpbmRvd1RpbWVTcGFuIFRoZSBhbW91bnQgb2YgdGltZSwgaW4gbWlsbGlzZWNvbmRzLCB0byBmaWxsIGVhY2ggd2luZG93LlxuICogQHBhcmFtIHdpbmRvd0NyZWF0aW9uSW50ZXJ2YWwgVGhlIGludGVydmFsIGF0IHdoaWNoIHRvIHN0YXJ0IG5ld1xuICogd2luZG93cy5cbiAqIEBwYXJhbSBtYXhXaW5kb3dTaXplIE1heCBudW1iZXIgb2ZcbiAqIHZhbHVlcyBlYWNoIHdpbmRvdyBjYW4gZW1pdCBiZWZvcmUgY29tcGxldGlvbi5cbiAqIEBwYXJhbSBzY2hlZHVsZXIgVGhlIHNjaGVkdWxlciBvbiB3aGljaCB0byBzY2hlZHVsZSB0aGVcbiAqIGludGVydmFscyB0aGF0IGRldGVybWluZSB3aW5kb3cgYm91bmRhcmllcy5cbiAqIEByZXR1cm4gQSBmdW5jdGlvbiB0aGF0IHJldHVybnMgYW4gT2JzZXJ2YWJsZSBvZiB3aW5kb3dzLCB3aGljaCBpbiB0dXJuIGFyZVxuICogT2JzZXJ2YWJsZXMuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB3aW5kb3dUaW1lPFQ+KHdpbmRvd1RpbWVTcGFuOiBudW1iZXIsIC4uLm90aGVyQXJnczogYW55W10pOiBPcGVyYXRvckZ1bmN0aW9uPFQsIE9ic2VydmFibGU8VD4+IHtcbiAgY29uc3Qgc2NoZWR1bGVyID0gcG9wU2NoZWR1bGVyKG90aGVyQXJncykgPz8gYXN5bmNTY2hlZHVsZXI7XG4gIGNvbnN0IHdpbmRvd0NyZWF0aW9uSW50ZXJ2YWwgPSAob3RoZXJBcmdzWzBdIGFzIG51bWJlcikgPz8gbnVsbDtcbiAgY29uc3QgbWF4V2luZG93U2l6ZSA9IChvdGhlckFyZ3NbMV0gYXMgbnVtYmVyKSB8fCBJbmZpbml0eTtcblxuICByZXR1cm4gb3BlcmF0ZSgoc291cmNlLCBzdWJzY3JpYmVyKSA9PiB7XG4gICAgLy8gVGhlIGFjdGl2ZSB3aW5kb3dzLCB0aGVpciByZWxhdGVkIHN1YnNjcmlwdGlvbnMsIGFuZCByZW1vdmFsIGZ1bmN0aW9ucy5cbiAgICBsZXQgd2luZG93UmVjb3JkczogV2luZG93UmVjb3JkPFQ+W10gfCBudWxsID0gW107XG4gICAgLy8gSWYgdHJ1ZSwgaXQgbWVhbnMgdGhhdCBldmVyeSB0aW1lIHdlIGNsb3NlIGEgd2luZG93LCB3ZSB3YW50IHRvIHN0YXJ0IGEgbmV3IHdpbmRvdy5cbiAgICAvLyBUaGlzIGlzIG9ubHkgcmVhbGx5IHVzZWQgZm9yIHdoZW4gKmp1c3QqIHRoZSB0aW1lIHNwYW4gaXMgcGFzc2VkLlxuICAgIGxldCByZXN0YXJ0T25DbG9zZSA9IGZhbHNlO1xuXG4gICAgY29uc3QgY2xvc2VXaW5kb3cgPSAocmVjb3JkOiB7IHdpbmRvdzogU3ViamVjdDxUPjsgc3ViczogU3Vic2NyaXB0aW9uIH0pID0+IHtcbiAgICAgIGNvbnN0IHsgd2luZG93LCBzdWJzIH0gPSByZWNvcmQ7XG4gICAgICB3aW5kb3cuY29tcGxldGUoKTtcbiAgICAgIHN1YnMudW5zdWJzY3JpYmUoKTtcbiAgICAgIGFyclJlbW92ZSh3aW5kb3dSZWNvcmRzLCByZWNvcmQpO1xuICAgICAgcmVzdGFydE9uQ2xvc2UgJiYgc3RhcnRXaW5kb3coKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ2FsbGVkIGV2ZXJ5IHRpbWUgd2Ugc3RhcnQgYSBuZXcgd2luZG93LiBUaGlzIGFsc28gZG9lc1xuICAgICAqIHRoZSB3b3JrIG9mIHNjaGVkdWxpbmcgdGhlIGpvYiB0byBjbG9zZSB0aGUgd2luZG93LlxuICAgICAqL1xuICAgIGNvbnN0IHN0YXJ0V2luZG93ID0gKCkgPT4ge1xuICAgICAgaWYgKHdpbmRvd1JlY29yZHMpIHtcbiAgICAgICAgY29uc3Qgc3VicyA9IG5ldyBTdWJzY3JpcHRpb24oKTtcbiAgICAgICAgc3Vic2NyaWJlci5hZGQoc3Vicyk7XG4gICAgICAgIGNvbnN0IHdpbmRvdyA9IG5ldyBTdWJqZWN0PFQ+KCk7XG4gICAgICAgIGNvbnN0IHJlY29yZCA9IHtcbiAgICAgICAgICB3aW5kb3csXG4gICAgICAgICAgc3VicyxcbiAgICAgICAgICBzZWVuOiAwLFxuICAgICAgICB9O1xuICAgICAgICB3aW5kb3dSZWNvcmRzLnB1c2gocmVjb3JkKTtcbiAgICAgICAgc3Vic2NyaWJlci5uZXh0KHdpbmRvdy5hc09ic2VydmFibGUoKSk7XG4gICAgICAgIGV4ZWN1dGVTY2hlZHVsZShzdWJzLCBzY2hlZHVsZXIsICgpID0+IGNsb3NlV2luZG93KHJlY29yZCksIHdpbmRvd1RpbWVTcGFuKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgaWYgKHdpbmRvd0NyZWF0aW9uSW50ZXJ2YWwgIT09IG51bGwgJiYgd2luZG93Q3JlYXRpb25JbnRlcnZhbCA+PSAwKSB7XG4gICAgICAvLyBUaGUgdXNlciBwYXNzZWQgYm90aCBhIHdpbmRvd1RpbWVTcGFuIChyZXF1aXJlZCksIGFuZCBhIGNyZWF0aW9uIGludGVydmFsXG4gICAgICAvLyBUaGF0IG1lYW5zIHdlIG5lZWQgdG8gc3RhcnQgbmV3IHdpbmRvdyBvbiB0aGUgaW50ZXJ2YWwsIGFuZCB0aG9zZSB3aW5kb3dzIG5lZWRcbiAgICAgIC8vIHRvIHdhaXQgdGhlIHJlcXVpcmVkIHRpbWUgc3BhbiBiZWZvcmUgY29tcGxldGluZy5cbiAgICAgIGV4ZWN1dGVTY2hlZHVsZShzdWJzY3JpYmVyLCBzY2hlZHVsZXIsIHN0YXJ0V2luZG93LCB3aW5kb3dDcmVhdGlvbkludGVydmFsLCB0cnVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzdGFydE9uQ2xvc2UgPSB0cnVlO1xuICAgIH1cblxuICAgIHN0YXJ0V2luZG93KCk7XG5cbiAgICAvKipcbiAgICAgKiBXZSBuZWVkIHRvIGxvb3Agb3ZlciBhIGNvcHkgb2YgdGhlIHdpbmRvdyByZWNvcmRzIHNldmVyYWwgdGltZXMgaW4gdGhpcyBvcGVyYXRvci5cbiAgICAgKiBUaGlzIGlzIHRvIHNhdmUgYnl0ZXMgb3ZlciB0aGUgd2lyZSBtb3JlIHRoYW4gYW55dGhpbmcuXG4gICAgICogVGhlIHJlYXNvbiB3ZSBjb3B5IHRoZSBhcnJheSBpcyB0aGF0IHJlZW50cmFudCBjb2RlIGNvdWxkIG11dGF0ZSB0aGUgYXJyYXkgd2hpbGVcbiAgICAgKiB3ZSBhcmUgaXRlcmF0aW5nIG92ZXIgaXQuXG4gICAgICovXG4gICAgY29uc3QgbG9vcCA9IChjYjogKHJlY29yZDogV2luZG93UmVjb3JkPFQ+KSA9PiB2b2lkKSA9PiB3aW5kb3dSZWNvcmRzIS5zbGljZSgpLmZvckVhY2goY2IpO1xuXG4gICAgLyoqXG4gICAgICogVXNlZCB0byBub3RpZnkgYWxsIG9mIHRoZSB3aW5kb3dzIGFuZCB0aGUgc3Vic2NyaWJlciBpbiB0aGUgc2FtZSB3YXlcbiAgICAgKiBpbiB0aGUgZXJyb3IgYW5kIGNvbXBsZXRlIGhhbmRsZXJzLlxuICAgICAqL1xuICAgIGNvbnN0IHRlcm1pbmF0ZSA9IChjYjogKGNvbnN1bWVyOiBPYnNlcnZlcjxhbnk+KSA9PiB2b2lkKSA9PiB7XG4gICAgICBsb29wKCh7IHdpbmRvdyB9KSA9PiBjYih3aW5kb3cpKTtcbiAgICAgIGNiKHN1YnNjcmliZXIpO1xuICAgICAgc3Vic2NyaWJlci51bnN1YnNjcmliZSgpO1xuICAgIH07XG5cbiAgICBzb3VyY2Uuc3Vic2NyaWJlKFxuICAgICAgY3JlYXRlT3BlcmF0b3JTdWJzY3JpYmVyKFxuICAgICAgICBzdWJzY3JpYmVyLFxuICAgICAgICAodmFsdWU6IFQpID0+IHtcbiAgICAgICAgICAvLyBOb3RpZnkgYWxsIHdpbmRvd3Mgb2YgdGhlIHZhbHVlLlxuICAgICAgICAgIGxvb3AoKHJlY29yZCkgPT4ge1xuICAgICAgICAgICAgcmVjb3JkLndpbmRvdy5uZXh0KHZhbHVlKTtcbiAgICAgICAgICAgIC8vIElmIHRoZSB3aW5kb3cgaXMgb3ZlciB0aGUgbWF4IHNpemUsIHdlIG5lZWQgdG8gY2xvc2UgaXQuXG4gICAgICAgICAgICBtYXhXaW5kb3dTaXplIDw9ICsrcmVjb3JkLnNlZW4gJiYgY2xvc2VXaW5kb3cocmVjb3JkKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLy8gQ29tcGxldGUgdGhlIHdpbmRvd3MgYW5kIHRoZSBkb3duc3RyZWFtIHN1YnNjcmliZXIgYW5kIGNsZWFuIHVwLlxuICAgICAgICAoKSA9PiB0ZXJtaW5hdGUoKGNvbnN1bWVyKSA9PiBjb25zdW1lci5jb21wbGV0ZSgpKSxcbiAgICAgICAgLy8gTm90aWZ5IHRoZSB3aW5kb3dzIGFuZCB0aGUgZG93bnN0cmVhbSBzdWJzY3JpYmVyIG9mIHRoZSBlcnJvciBhbmQgY2xlYW4gdXAuXG4gICAgICAgIChlcnIpID0+IHRlcm1pbmF0ZSgoY29uc3VtZXIpID0+IGNvbnN1bWVyLmVycm9yKGVycikpXG4gICAgICApXG4gICAgKTtcblxuICAgIC8vIEFkZGl0aW9uYWwgZmluYWxpemF0aW9uLiBUaGlzIHdpbGwgYmUgY2FsbGVkIHdoZW4gdGhlXG4gICAgLy8gZGVzdGluYXRpb24gdGVhcnMgZG93bi4gT3RoZXIgZmluYWxpemF0aW9ucyBhcmUgcmVnaXN0ZXJlZCBpbXBsaWNpdGx5XG4gICAgLy8gYWJvdmUgdmlhIHN1YnNjcmlwdGlvbi5cbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgLy8gRW5zdXJlIHRoYXQgdGhlIGJ1ZmZlciBpcyByZWxlYXNlZC5cbiAgICAgIHdpbmRvd1JlY29yZHMgPSBudWxsITtcbiAgICB9O1xuICB9KTtcbn1cblxuaW50ZXJmYWNlIFdpbmRvd1JlY29yZDxUPiB7XG4gIHNlZW46IG51bWJlcjtcbiAgd2luZG93OiBTdWJqZWN0PFQ+O1xuICBzdWJzOiBTdWJzY3JpcHRpb247XG59XG4iXX0=
