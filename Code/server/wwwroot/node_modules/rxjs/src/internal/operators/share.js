import{innerFrom}from"../observable/innerFrom";import{Subject}from"../Subject";import{SafeSubscriber}from"../Subscriber";import{operate}from"../util/lift";function share(e={}){let{connector:a=()=>new Subject,resetOnError:f=!0,resetOnComplete:p=!0,resetOnRefCountZero:S=!0}=e;return e=>{let n,o,s,i=0,b=!1,u=!1,c=()=>{o?.unsubscribe(),o=void 0},l=()=>{c(),n=s=void 0,b=u=!1},m=()=>{var e=n;l(),e?.unsubscribe()};return operate((e,r)=>{i++,u||b||c();let t=s=s??a();r.add(()=>{0!==--i||u||b||(o=handleReset(m,S))}),t.subscribe(r),!n&&0<i&&(n=new SafeSubscriber({next:e=>t.next(e),error:e=>{u=!0,c(),o=handleReset(l,f,e),t.error(e)},complete:()=>{b=!0,c(),o=handleReset(l,p),t.complete()}}),innerFrom(e).subscribe(n))})(e)}}function handleReset(r,t,...n){if(!0===t)r();else if(!1!==t){let e=new SafeSubscriber({next:()=>{e.unsubscribe(),r()}});return innerFrom(t(...n)).subscribe(e)}}export{share};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9yeGpzL3NyYy9pbnRlcm5hbC9vcGVyYXRvcnMvc2hhcmUudHMiXSwibmFtZXMiOlsiaW5uZXJGcm9tIiwiU3ViamVjdCIsIlNhZmVTdWJzY3JpYmVyIiwib3BlcmF0ZSIsInNoYXJlIiwib3B0aW9ucyIsImNvbm5lY3RvciIsInJlc2V0T25FcnJvciIsInJlc2V0T25Db21wbGV0ZSIsInJlc2V0T25SZWZDb3VudFplcm8iLCJsZXQiLCJjb25uZWN0aW9uIiwicmVzZXRDb25uZWN0aW9uIiwic3ViamVjdCIsInJlZkNvdW50IiwiaGFzQ29tcGxldGVkIiwiaGFzRXJyb3JlZCIsImNhbmNlbFJlc2V0IiwidW5zdWJzY3JpYmUiLCJ1bmRlZmluZWQiLCJyZXNldCIsInJlc2V0QW5kVW5zdWJzY3JpYmUiLCJjb25uIiwic291cmNlIiwic3Vic2NyaWJlciIsImRlc3QiLCJhZGQiLCJoYW5kbGVSZXNldCIsInN1YnNjcmliZSIsIm5leHQiLCJ2YWx1ZSIsImVycm9yIiwiZXJyIiwiY29tcGxldGUiLCJ3cmFwcGVyU291cmNlIiwib24iLCJhcmdzIiwib25TdWJzY3JpYmVyIl0sIm1hcHBpbmdzIjoiT0FBU0EsU0FBMEMsS0FBekIsaUNBQ2pCQyxPQUEyQixLQUFaLG9CQUNmQyxjQUFxQyxLQUFmLHVCQUd0QkMsT0FBNkIsS0FBZCxlQXdJbEIsU0FBVUMsTUFBU0MsRUFBMEIsSUFDakQsR0FBTSxDQUFFQyxVQUFBQSxFQUFZLElBQU0sSUFBSUwsUUFBY00sYUFBQUEsRUFBZSxDQUFBLEVBQU1DLGdCQUFBQSxFQUFrQixDQUFBLEVBQU1DLG9CQUFBQSxFQUFzQixDQUFBLENBQUksRUFBS0osRUFVeEgsT0FBTyxJQUNMSyxJQUFJQyxFQUNBQyxFQUNBQyxFQUNBQyxFQUFXLEVBQ1hDLEVBQWUsQ0FBQSxFQUNmQyxFQUFhLENBQUEsRUFFWEMsRUFBYyxLQUNsQkwsR0FBaUJNLFlBQVcsRUFDNUJOLEVBQWtCTyxLQUFBQSxDQUNwQixFQUdNQyxFQUFRLEtBQ1pILEVBQVcsRUFDWE4sRUFBYUUsRUFBVU0sS0FBQUEsRUFDdkJKLEVBQWVDLEVBQWEsQ0FBQSxDQUM5QixFQUNNSyxFQUFzQixLQUcxQixJQUFNQyxFQUFPWCxFQUNiUyxFQUFLLEVBQ0xFLEdBQU1KLFlBQVcsQ0FDbkIsRUFFQSxPQUFPZixRQUFjLENBQUNvQixFQUFRQyxLQUM1QlYsQ0FBUSxHQUNIRSxHQUFlRCxHQUNsQkUsRUFBVyxFQU9iLElBQU1RLEVBQVFaLEVBQVVBLEdBQVdQLEVBQVMsRUFPNUNrQixFQUFXRSxJQUFJLEtBTUksSUFMakJaLEVBQUFBLEdBS3VCRSxHQUFlRCxJQUNwQ0gsRUFBa0JlLFlBQVlOLEVBQXFCWixDQUFtQixFQUUxRSxDQUFDLEVBSURnQixFQUFLRyxVQUFVSixDQUFVLEVBR3ZCLENBQUNiLEdBSVUsRUFBWEcsSUFPQUgsRUFBYSxJQUFJVCxlQUFlLENBQzlCMkIsS0FBTSxHQUFXSixFQUFLSSxLQUFLQyxDQUFLLEVBQ2hDQyxNQUFPLElBQ0xmLEVBQWEsQ0FBQSxFQUNiQyxFQUFXLEVBQ1hMLEVBQWtCZSxZQUFZUCxFQUFPYixFQUFjeUIsQ0FBRyxFQUN0RFAsRUFBS00sTUFBTUMsQ0FBRyxDQUNoQixFQUNBQyxTQUFVLEtBQ1JsQixFQUFlLENBQUEsRUFDZkUsRUFBVyxFQUNYTCxFQUFrQmUsWUFBWVAsRUFBT1osQ0FBZSxFQUNwRGlCLEVBQUtRLFNBQVEsQ0FDZixDLENBQ0QsRUFDRGpDLFVBQVV1QixDQUFNLEVBQUVLLFVBQVVqQixDQUFVLEVBRTFDLENBQUMsRUFBRXVCLENBQWEsQ0FDbEIsQ0FDRixDQUVBLFNBQVNQLFlBQ1BQLEVBQ0FlLEtBQ0dDLEdBRUgsR0FBVyxDQUFBLElBQVBELEVBQ0ZmLEVBQUssT0FJUCxHQUFXLENBQUEsSUFBUGUsRUFBSixDQUlBLElBQU1FLEVBQWUsSUFBSW5DLGVBQWUsQ0FDdEMyQixLQUFNLEtBQ0pRLEVBQWFuQixZQUFXLEVBQ3hCRSxFQUFLLENBQ1AsQyxDQUNELEVBRUQsT0FBT3BCLFVBQVVtQyxFQUFHLEdBQUdDLENBQUksQ0FBQyxFQUFFUixVQUFVUyxDQUFZLENBVHBELENBVUYsUUE3SGdCakMsS0E2SGhCIiwiZmlsZSI6Im5vZGVfbW9kdWxlcy9yeGpzL3NyYy9pbnRlcm5hbC9vcGVyYXRvcnMvc2hhcmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbm5lckZyb20gfSBmcm9tICcuLi9vYnNlcnZhYmxlL2lubmVyRnJvbSc7XG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAnLi4vU3ViamVjdCc7XG5pbXBvcnQgeyBTYWZlU3Vic2NyaWJlciB9IGZyb20gJy4uL1N1YnNjcmliZXInO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAnLi4vU3Vic2NyaXB0aW9uJztcbmltcG9ydCB7IE1vbm9UeXBlT3BlcmF0b3JGdW5jdGlvbiwgU3ViamVjdExpa2UsIE9ic2VydmFibGVJbnB1dCB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7IG9wZXJhdGUgfSBmcm9tICcuLi91dGlsL2xpZnQnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFNoYXJlQ29uZmlnPFQ+IHtcbiAgLyoqXG4gICAqIFRoZSBmYWN0b3J5IHVzZWQgdG8gY3JlYXRlIHRoZSBzdWJqZWN0IHRoYXQgd2lsbCBjb25uZWN0IHRoZSBzb3VyY2Ugb2JzZXJ2YWJsZSB0b1xuICAgKiBtdWx0aWNhc3QgY29uc3VtZXJzLlxuICAgKi9cbiAgY29ubmVjdG9yPzogKCkgPT4gU3ViamVjdExpa2U8VD47XG4gIC8qKlxuICAgKiBJZiBgdHJ1ZWAsIHRoZSByZXN1bHRpbmcgb2JzZXJ2YWJsZSB3aWxsIHJlc2V0IGludGVybmFsIHN0YXRlIG9uIGVycm9yIGZyb20gc291cmNlIGFuZCByZXR1cm4gdG8gYSBcImNvbGRcIiBzdGF0ZS4gVGhpc1xuICAgKiBhbGxvd3MgdGhlIHJlc3VsdGluZyBvYnNlcnZhYmxlIHRvIGJlIFwicmV0cmllZFwiIGluIHRoZSBldmVudCBvZiBhbiBlcnJvci5cbiAgICogSWYgYGZhbHNlYCwgd2hlbiBhbiBlcnJvciBjb21lcyBmcm9tIHRoZSBzb3VyY2UgaXQgd2lsbCBwdXNoIHRoZSBlcnJvciBpbnRvIHRoZSBjb25uZWN0aW5nIHN1YmplY3QsIGFuZCB0aGUgc3ViamVjdFxuICAgKiB3aWxsIHJlbWFpbiB0aGUgY29ubmVjdGluZyBzdWJqZWN0LCBtZWFuaW5nIHRoZSByZXN1bHRpbmcgb2JzZXJ2YWJsZSB3aWxsIG5vdCBnbyBcImNvbGRcIiBhZ2FpbiwgYW5kIHN1YnNlcXVlbnQgcmV0cmllc1xuICAgKiBvciByZXN1YnNjcmlwdGlvbnMgd2lsbCByZXN1YnNjcmliZSB0byB0aGF0IHNhbWUgc3ViamVjdC4gSW4gYWxsIGNhc2VzLCBSeEpTIHN1YmplY3RzIHdpbGwgZW1pdCB0aGUgc2FtZSBlcnJvciBhZ2FpbiwgaG93ZXZlclxuICAgKiB7QGxpbmsgUmVwbGF5U3ViamVjdH0gd2lsbCBhbHNvIHB1c2ggaXRzIGJ1ZmZlcmVkIHZhbHVlcyBiZWZvcmUgcHVzaGluZyB0aGUgZXJyb3IuXG4gICAqIEl0IGlzIGFsc28gcG9zc2libGUgdG8gcGFzcyBhIG5vdGlmaWVyIGZhY3RvcnkgcmV0dXJuaW5nIGFuIGBPYnNlcnZhYmxlSW5wdXRgIGluc3RlYWQgd2hpY2ggZ3JhbnRzIG1vcmUgZmluZS1ncmFpbmVkXG4gICAqIGNvbnRyb2wgb3ZlciBob3cgYW5kIHdoZW4gdGhlIHJlc2V0IHNob3VsZCBoYXBwZW4uIFRoaXMgYWxsb3dzIGJlaGF2aW9ycyBsaWtlIGNvbmRpdGlvbmFsIG9yIGRlbGF5ZWQgcmVzZXRzLlxuICAgKi9cbiAgcmVzZXRPbkVycm9yPzogYm9vbGVhbiB8ICgoZXJyb3I6IGFueSkgPT4gT2JzZXJ2YWJsZUlucHV0PGFueT4pO1xuICAvKipcbiAgICogSWYgYHRydWVgLCB0aGUgcmVzdWx0aW5nIG9ic2VydmFibGUgd2lsbCByZXNldCBpbnRlcm5hbCBzdGF0ZSBvbiBjb21wbGV0aW9uIGZyb20gc291cmNlIGFuZCByZXR1cm4gdG8gYSBcImNvbGRcIiBzdGF0ZS4gVGhpc1xuICAgKiBhbGxvd3MgdGhlIHJlc3VsdGluZyBvYnNlcnZhYmxlIHRvIGJlIFwicmVwZWF0ZWRcIiBhZnRlciBpdCBpcyBkb25lLlxuICAgKiBJZiBgZmFsc2VgLCB3aGVuIHRoZSBzb3VyY2UgY29tcGxldGVzLCBpdCB3aWxsIHB1c2ggdGhlIGNvbXBsZXRpb24gdGhyb3VnaCB0aGUgY29ubmVjdGluZyBzdWJqZWN0LCBhbmQgdGhlIHN1YmplY3RcbiAgICogd2lsbCByZW1haW4gdGhlIGNvbm5lY3Rpbmcgc3ViamVjdCwgbWVhbmluZyB0aGUgcmVzdWx0aW5nIG9ic2VydmFibGUgd2lsbCBub3QgZ28gXCJjb2xkXCIgYWdhaW4sIGFuZCBzdWJzZXF1ZW50IHJlcGVhdHNcbiAgICogb3IgcmVzdWJzY3JpcHRpb25zIHdpbGwgcmVzdWJzY3JpYmUgdG8gdGhhdCBzYW1lIHN1YmplY3QuXG4gICAqIEl0IGlzIGFsc28gcG9zc2libGUgdG8gcGFzcyBhIG5vdGlmaWVyIGZhY3RvcnkgcmV0dXJuaW5nIGFuIGBPYnNlcnZhYmxlSW5wdXRgIGluc3RlYWQgd2hpY2ggZ3JhbnRzIG1vcmUgZmluZS1ncmFpbmVkXG4gICAqIGNvbnRyb2wgb3ZlciBob3cgYW5kIHdoZW4gdGhlIHJlc2V0IHNob3VsZCBoYXBwZW4uIFRoaXMgYWxsb3dzIGJlaGF2aW9ycyBsaWtlIGNvbmRpdGlvbmFsIG9yIGRlbGF5ZWQgcmVzZXRzLlxuICAgKi9cbiAgcmVzZXRPbkNvbXBsZXRlPzogYm9vbGVhbiB8ICgoKSA9PiBPYnNlcnZhYmxlSW5wdXQ8YW55Pik7XG4gIC8qKlxuICAgKiBJZiBgdHJ1ZWAsIHdoZW4gdGhlIG51bWJlciBvZiBzdWJzY3JpYmVycyB0byB0aGUgcmVzdWx0aW5nIG9ic2VydmFibGUgcmVhY2hlcyB6ZXJvIGR1ZSB0byB0aG9zZSBzdWJzY3JpYmVycyB1bnN1YnNjcmliaW5nLCB0aGVcbiAgICogaW50ZXJuYWwgc3RhdGUgd2lsbCBiZSByZXNldCBhbmQgdGhlIHJlc3VsdGluZyBvYnNlcnZhYmxlIHdpbGwgcmV0dXJuIHRvIGEgXCJjb2xkXCIgc3RhdGUuIFRoaXMgbWVhbnMgdGhhdCB0aGUgbmV4dFxuICAgKiB0aW1lIHRoZSByZXN1bHRpbmcgb2JzZXJ2YWJsZSBpcyBzdWJzY3JpYmVkIHRvLCBhIG5ldyBzdWJqZWN0IHdpbGwgYmUgY3JlYXRlZCBhbmQgdGhlIHNvdXJjZSB3aWxsIGJlIHN1YnNjcmliZWQgdG9cbiAgICogYWdhaW4uXG4gICAqIElmIGBmYWxzZWAsIHdoZW4gdGhlIG51bWJlciBvZiBzdWJzY3JpYmVycyB0byB0aGUgcmVzdWx0aW5nIG9ic2VydmFibGUgcmVhY2hlcyB6ZXJvIGR1ZSB0byB1bnN1YnNjcmlwdGlvbiwgdGhlIHN1YmplY3RcbiAgICogd2lsbCByZW1haW4gY29ubmVjdGVkIHRvIHRoZSBzb3VyY2UsIGFuZCBuZXcgc3Vic2NyaXB0aW9ucyB0byB0aGUgcmVzdWx0IHdpbGwgYmUgY29ubmVjdGVkIHRocm91Z2ggdGhhdCBzYW1lIHN1YmplY3QuXG4gICAqIEl0IGlzIGFsc28gcG9zc2libGUgdG8gcGFzcyBhIG5vdGlmaWVyIGZhY3RvcnkgcmV0dXJuaW5nIGFuIGBPYnNlcnZhYmxlSW5wdXRgIGluc3RlYWQgd2hpY2ggZ3JhbnRzIG1vcmUgZmluZS1ncmFpbmVkXG4gICAqIGNvbnRyb2wgb3ZlciBob3cgYW5kIHdoZW4gdGhlIHJlc2V0IHNob3VsZCBoYXBwZW4uIFRoaXMgYWxsb3dzIGJlaGF2aW9ycyBsaWtlIGNvbmRpdGlvbmFsIG9yIGRlbGF5ZWQgcmVzZXRzLlxuICAgKi9cbiAgcmVzZXRPblJlZkNvdW50WmVybz86IGJvb2xlYW4gfCAoKCkgPT4gT2JzZXJ2YWJsZUlucHV0PGFueT4pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2hhcmU8VD4oKTogTW9ub1R5cGVPcGVyYXRvckZ1bmN0aW9uPFQ+O1xuXG5leHBvcnQgZnVuY3Rpb24gc2hhcmU8VD4ob3B0aW9uczogU2hhcmVDb25maWc8VD4pOiBNb25vVHlwZU9wZXJhdG9yRnVuY3Rpb248VD47XG5cbi8qKlxuICogUmV0dXJucyBhIG5ldyBPYnNlcnZhYmxlIHRoYXQgbXVsdGljYXN0cyAoc2hhcmVzKSB0aGUgb3JpZ2luYWwgT2JzZXJ2YWJsZS4gQXMgbG9uZyBhcyB0aGVyZSBpcyBhdCBsZWFzdCBvbmVcbiAqIFN1YnNjcmliZXIgdGhpcyBPYnNlcnZhYmxlIHdpbGwgYmUgc3Vic2NyaWJlZCBhbmQgZW1pdHRpbmcgZGF0YS4gV2hlbiBhbGwgc3Vic2NyaWJlcnMgaGF2ZSB1bnN1YnNjcmliZWQgaXQgd2lsbFxuICogdW5zdWJzY3JpYmUgZnJvbSB0aGUgc291cmNlIE9ic2VydmFibGUuIEJlY2F1c2UgdGhlIE9ic2VydmFibGUgaXMgbXVsdGljYXN0aW5nIGl0IG1ha2VzIHRoZSBzdHJlYW0gYGhvdGAuXG4gKiBUaGlzIGlzIGFuIGFsaWFzIGZvciBgbXVsdGljYXN0KCgpID0+IG5ldyBTdWJqZWN0KCkpLCByZWZDb3VudCgpYC5cbiAqXG4gKiBUaGUgc3Vic2NyaXB0aW9uIHRvIHRoZSB1bmRlcmx5aW5nIHNvdXJjZSBPYnNlcnZhYmxlIGNhbiBiZSByZXNldCAodW5zdWJzY3JpYmUgYW5kIHJlc3Vic2NyaWJlIGZvciBuZXcgc3Vic2NyaWJlcnMpLFxuICogaWYgdGhlIHN1YnNjcmliZXIgY291bnQgdG8gdGhlIHNoYXJlZCBvYnNlcnZhYmxlIGRyb3BzIHRvIDAsIG9yIGlmIHRoZSBzb3VyY2UgT2JzZXJ2YWJsZSBlcnJvcnMgb3IgY29tcGxldGVzLiBJdCBpc1xuICogcG9zc2libGUgdG8gdXNlIG5vdGlmaWVyIGZhY3RvcmllcyBmb3IgdGhlIHJlc2V0cyB0byBhbGxvdyBmb3IgYmVoYXZpb3JzIGxpa2UgY29uZGl0aW9uYWwgb3IgZGVsYXllZCByZXNldHMuIFBsZWFzZVxuICogbm90ZSB0aGF0IHJlc2V0dGluZyBvbiBlcnJvciBvciBjb21wbGV0ZSBvZiB0aGUgc291cmNlIE9ic2VydmFibGUgZG9lcyBub3QgYmVoYXZlIGxpa2UgYSB0cmFuc3BhcmVudCByZXRyeSBvciByZXN0YXJ0XG4gKiBvZiB0aGUgc291cmNlIGJlY2F1c2UgdGhlIGVycm9yIG9yIGNvbXBsZXRlIHdpbGwgYmUgZm9yd2FyZGVkIHRvIGFsbCBzdWJzY3JpYmVycyBhbmQgdGhlaXIgc3Vic2NyaXB0aW9uIHdpbGwgYmVcbiAqIGNsb3NlZC4gT25seSBuZXcgc3Vic2NyaWJlcnMgYWZ0ZXIgYSByZXNldCBvbiBlcnJvciBvciBjb21wbGV0ZSBoYXBwZW5lZCB3aWxsIGNhdXNlIGEgZnJlc2ggc3Vic2NyaXB0aW9uIHRvIHRoZVxuICogc291cmNlLiBUbyBhY2hpZXZlIHRyYW5zcGFyZW50IHJldHJpZXMgb3IgcmVzdGFydHMgcGlwZSB0aGUgc291cmNlIHRocm91Z2ggYXBwcm9wcmlhdGUgb3BlcmF0b3JzIGJlZm9yZSBzaGFyaW5nLlxuICpcbiAqICFbXShzaGFyZS5wbmcpXG4gKlxuICogIyMgRXhhbXBsZVxuICpcbiAqIEdlbmVyYXRlIG5ldyBtdWx0aWNhc3QgT2JzZXJ2YWJsZSBmcm9tIHRoZSBgc291cmNlYCBPYnNlcnZhYmxlIHZhbHVlXG4gKlxuICogYGBgdHNcbiAqIGltcG9ydCB7IGludGVydmFsLCB0YXAsIG1hcCwgdGFrZSwgc2hhcmUgfSBmcm9tICdyeGpzJztcbiAqXG4gKiBjb25zdCBzb3VyY2UgPSBpbnRlcnZhbCgxMDAwKS5waXBlKFxuICogICB0YXAoeCA9PiBjb25zb2xlLmxvZygnUHJvY2Vzc2luZzogJywgeCkpLFxuICogICBtYXAoeCA9PiB4ICogeCksXG4gKiAgIHRha2UoNiksXG4gKiAgIHNoYXJlKClcbiAqICk7XG4gKlxuICogc291cmNlLnN1YnNjcmliZSh4ID0+IGNvbnNvbGUubG9nKCdzdWJzY3JpcHRpb24gMTogJywgeCkpO1xuICogc291cmNlLnN1YnNjcmliZSh4ID0+IGNvbnNvbGUubG9nKCdzdWJzY3JpcHRpb24gMjogJywgeCkpO1xuICpcbiAqIC8vIExvZ3M6XG4gKiAvLyBQcm9jZXNzaW5nOiAwXG4gKiAvLyBzdWJzY3JpcHRpb24gMTogMFxuICogLy8gc3Vic2NyaXB0aW9uIDI6IDBcbiAqIC8vIFByb2Nlc3Npbmc6IDFcbiAqIC8vIHN1YnNjcmlwdGlvbiAxOiAxXG4gKiAvLyBzdWJzY3JpcHRpb24gMjogMVxuICogLy8gUHJvY2Vzc2luZzogMlxuICogLy8gc3Vic2NyaXB0aW9uIDE6IDRcbiAqIC8vIHN1YnNjcmlwdGlvbiAyOiA0XG4gKiAvLyBQcm9jZXNzaW5nOiAzXG4gKiAvLyBzdWJzY3JpcHRpb24gMTogOVxuICogLy8gc3Vic2NyaXB0aW9uIDI6IDlcbiAqIC8vIFByb2Nlc3Npbmc6IDRcbiAqIC8vIHN1YnNjcmlwdGlvbiAxOiAxNlxuICogLy8gc3Vic2NyaXB0aW9uIDI6IDE2XG4gKiAvLyBQcm9jZXNzaW5nOiA1XG4gKiAvLyBzdWJzY3JpcHRpb24gMTogMjVcbiAqIC8vIHN1YnNjcmlwdGlvbiAyOiAyNVxuICogYGBgXG4gKlxuICogIyMgRXhhbXBsZSB3aXRoIG5vdGlmaWVyIGZhY3Rvcnk6IERlbGF5ZWQgcmVzZXRcbiAqXG4gKiBgYGB0c1xuICogaW1wb3J0IHsgaW50ZXJ2YWwsIHRha2UsIHNoYXJlLCB0aW1lciB9IGZyb20gJ3J4anMnO1xuICpcbiAqIGNvbnN0IHNvdXJjZSA9IGludGVydmFsKDEwMDApLnBpcGUoXG4gKiAgIHRha2UoMyksXG4gKiAgIHNoYXJlKHtcbiAqICAgICByZXNldE9uUmVmQ291bnRaZXJvOiAoKSA9PiB0aW1lcigxMDAwKVxuICogICB9KVxuICogKTtcbiAqXG4gKiBjb25zdCBzdWJzY3JpcHRpb25PbmUgPSBzb3VyY2Uuc3Vic2NyaWJlKHggPT4gY29uc29sZS5sb2coJ3N1YnNjcmlwdGlvbiAxOiAnLCB4KSk7XG4gKiBzZXRUaW1lb3V0KCgpID0+IHN1YnNjcmlwdGlvbk9uZS51bnN1YnNjcmliZSgpLCAxMzAwKTtcbiAqXG4gKiBzZXRUaW1lb3V0KCgpID0+IHNvdXJjZS5zdWJzY3JpYmUoeCA9PiBjb25zb2xlLmxvZygnc3Vic2NyaXB0aW9uIDI6ICcsIHgpKSwgMTcwMCk7XG4gKlxuICogc2V0VGltZW91dCgoKSA9PiBzb3VyY2Uuc3Vic2NyaWJlKHggPT4gY29uc29sZS5sb2coJ3N1YnNjcmlwdGlvbiAzOiAnLCB4KSksIDUwMDApO1xuICpcbiAqIC8vIExvZ3M6XG4gKiAvLyBzdWJzY3JpcHRpb24gMTogIDBcbiAqIC8vIChzdWJzY3JpcHRpb24gMSB1bnN1YnNjcmliZXMgaGVyZSlcbiAqIC8vIChzdWJzY3JpcHRpb24gMiBzdWJzY3JpYmVzIGhlcmUgfjQwMG1zIGxhdGVyLCBzb3VyY2Ugd2FzIG5vdCByZXNldClcbiAqIC8vIHN1YnNjcmlwdGlvbiAyOiAgMVxuICogLy8gc3Vic2NyaXB0aW9uIDI6ICAyXG4gKiAvLyAoc3Vic2NyaXB0aW9uIDIgdW5zdWJzY3JpYmVzIGhlcmUpXG4gKiAvLyAoc3Vic2NyaXB0aW9uIDMgc3Vic2NyaWJlcyBoZXJlIH4yMDAwbXMgbGF0ZXIsIHNvdXJjZSBkaWQgcmVzZXQgYmVmb3JlKVxuICogLy8gc3Vic2NyaXB0aW9uIDM6ICAwXG4gKiAvLyBzdWJzY3JpcHRpb24gMzogIDFcbiAqIC8vIHN1YnNjcmlwdGlvbiAzOiAgMlxuICogYGBgXG4gKlxuICogQHNlZSB7QGxpbmsgc2hhcmVSZXBsYXl9XG4gKlxuICogQHJldHVybiBBIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyBhbiBPYnNlcnZhYmxlIHRoYXQgbWlycm9ycyB0aGUgc291cmNlLlxuICovXG5leHBvcnQgZnVuY3Rpb24gc2hhcmU8VD4ob3B0aW9uczogU2hhcmVDb25maWc8VD4gPSB7fSk6IE1vbm9UeXBlT3BlcmF0b3JGdW5jdGlvbjxUPiB7XG4gIGNvbnN0IHsgY29ubmVjdG9yID0gKCkgPT4gbmV3IFN1YmplY3Q8VD4oKSwgcmVzZXRPbkVycm9yID0gdHJ1ZSwgcmVzZXRPbkNvbXBsZXRlID0gdHJ1ZSwgcmVzZXRPblJlZkNvdW50WmVybyA9IHRydWUgfSA9IG9wdGlvbnM7XG4gIC8vIEl0J3MgbmVjZXNzYXJ5IHRvIHVzZSBhIHdyYXBwZXIgaGVyZSwgYXMgdGhlIF9vcGVyYXRvcl8gbXVzdCBiZVxuICAvLyByZWZlcmVudGlhbGx5IHRyYW5zcGFyZW50LiBPdGhlcndpc2UsIGl0IGNhbm5vdCBiZSB1c2VkIGluIGNhbGxzIHRvIHRoZVxuICAvLyBzdGF0aWMgYHBpcGVgIGZ1bmN0aW9uIC0gdG8gY3JlYXRlIGEgcGFydGlhbCBwaXBlbGluZS5cbiAgLy9cbiAgLy8gVGhlIF9vcGVyYXRvciBmdW5jdGlvbl8gLSB0aGUgZnVuY3Rpb24gcmV0dXJuZWQgYnkgdGhlIF9vcGVyYXRvcl8gLSB3aWxsXG4gIC8vIG5vdCBiZSByZWZlcmVudGlhbGx5IHRyYW5zcGFyZW50IC0gYXMgaXQgc2hhcmVzIGl0cyBzb3VyY2UgLSBidXQgdGhlXG4gIC8vIF9vcGVyYXRvciBmdW5jdGlvbl8gaXMgY2FsbGVkIHdoZW4gdGhlIGNvbXBsZXRlIHBpcGVsaW5lIGlzIGNvbXBvc2VkIHZpYSBhXG4gIC8vIGNhbGwgdG8gYSBzb3VyY2Ugb2JzZXJ2YWJsZSdzIGBwaXBlYCBtZXRob2QgLSBub3Qgd2hlbiB0aGUgc3RhdGljIGBwaXBlYFxuICAvLyBmdW5jdGlvbiBpcyBjYWxsZWQuXG4gIHJldHVybiAod3JhcHBlclNvdXJjZSkgPT4ge1xuICAgIGxldCBjb25uZWN0aW9uOiBTYWZlU3Vic2NyaWJlcjxUPiB8IHVuZGVmaW5lZDtcbiAgICBsZXQgcmVzZXRDb25uZWN0aW9uOiBTdWJzY3JpcHRpb24gfCB1bmRlZmluZWQ7XG4gICAgbGV0IHN1YmplY3Q6IFN1YmplY3RMaWtlPFQ+IHwgdW5kZWZpbmVkO1xuICAgIGxldCByZWZDb3VudCA9IDA7XG4gICAgbGV0IGhhc0NvbXBsZXRlZCA9IGZhbHNlO1xuICAgIGxldCBoYXNFcnJvcmVkID0gZmFsc2U7XG5cbiAgICBjb25zdCBjYW5jZWxSZXNldCA9ICgpID0+IHtcbiAgICAgIHJlc2V0Q29ubmVjdGlvbj8udW5zdWJzY3JpYmUoKTtcbiAgICAgIHJlc2V0Q29ubmVjdGlvbiA9IHVuZGVmaW5lZDtcbiAgICB9O1xuICAgIC8vIFVzZWQgdG8gcmVzZXQgdGhlIGludGVybmFsIHN0YXRlIHRvIGEgXCJjb2xkXCJcbiAgICAvLyBzdGF0ZSwgYXMgdGhvdWdoIGl0IGhhZCBuZXZlciBiZWVuIHN1YnNjcmliZWQgdG8uXG4gICAgY29uc3QgcmVzZXQgPSAoKSA9PiB7XG4gICAgICBjYW5jZWxSZXNldCgpO1xuICAgICAgY29ubmVjdGlvbiA9IHN1YmplY3QgPSB1bmRlZmluZWQ7XG4gICAgICBoYXNDb21wbGV0ZWQgPSBoYXNFcnJvcmVkID0gZmFsc2U7XG4gICAgfTtcbiAgICBjb25zdCByZXNldEFuZFVuc3Vic2NyaWJlID0gKCkgPT4ge1xuICAgICAgLy8gV2UgbmVlZCB0byBjYXB0dXJlIHRoZSBjb25uZWN0aW9uIGJlZm9yZVxuICAgICAgLy8gd2UgcmVzZXQgKGlmIHdlIG5lZWQgdG8gcmVzZXQpLlxuICAgICAgY29uc3QgY29ubiA9IGNvbm5lY3Rpb247XG4gICAgICByZXNldCgpO1xuICAgICAgY29ubj8udW5zdWJzY3JpYmUoKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIG9wZXJhdGU8VCwgVD4oKHNvdXJjZSwgc3Vic2NyaWJlcikgPT4ge1xuICAgICAgcmVmQ291bnQrKztcbiAgICAgIGlmICghaGFzRXJyb3JlZCAmJiAhaGFzQ29tcGxldGVkKSB7XG4gICAgICAgIGNhbmNlbFJlc2V0KCk7XG4gICAgICB9XG5cbiAgICAgIC8vIENyZWF0ZSB0aGUgc3ViamVjdCBpZiB3ZSBkb24ndCBoYXZlIG9uZSB5ZXQuIEdyYWIgYSBsb2NhbCByZWZlcmVuY2UgdG9cbiAgICAgIC8vIGl0IGFzIHdlbGwsIHdoaWNoIGF2b2lkcyBub24tbnVsbCBhc3NlcnRpb25zIHdoZW4gdXNpbmcgaXQgYW5kLCBpZiB3ZVxuICAgICAgLy8gY29ubmVjdCB0byBpdCBub3csIHRoZW4gZXJyb3IvY29tcGxldGUgbmVlZCBhIHJlZmVyZW5jZSBhZnRlciBpdCB3YXNcbiAgICAgIC8vIHJlc2V0LlxuICAgICAgY29uc3QgZGVzdCA9IChzdWJqZWN0ID0gc3ViamVjdCA/PyBjb25uZWN0b3IoKSk7XG5cbiAgICAgIC8vIEFkZCB0aGUgZmluYWxpemF0aW9uIGRpcmVjdGx5IHRvIHRoZSBzdWJzY3JpYmVyIC0gaW5zdGVhZCBvZiByZXR1cm5pbmcgaXQgLVxuICAgICAgLy8gc28gdGhhdCB0aGUgaGFuZGxpbmcgb2YgdGhlIHN1YnNjcmliZXIncyB1bnN1YnNjcmlwdGlvbiB3aWxsIGJlIHdpcmVkXG4gICAgICAvLyB1cCBfYmVmb3JlXyB0aGUgc3Vic2NyaXB0aW9uIHRvIHRoZSBzb3VyY2Ugb2NjdXJzLiBUaGlzIGlzIGRvbmUgc28gdGhhdFxuICAgICAgLy8gdGhlIGFzc2lnbm1lbnQgdG8gdGhlIHNvdXJjZSBjb25uZWN0aW9uJ3MgYGNsb3NlZGAgcHJvcGVydHkgd2lsbCBiZSBzZWVuXG4gICAgICAvLyBieSBzeW5jaHJvbm91cyBmaXJlaG9zZSBzb3VyY2VzLlxuICAgICAgc3Vic2NyaWJlci5hZGQoKCkgPT4ge1xuICAgICAgICByZWZDb3VudC0tO1xuXG4gICAgICAgIC8vIElmIHdlJ3JlIHJlc2V0dGluZyBvbiByZWZDb3VudCA9PT0gMCwgYW5kIGl0J3MgMCwgd2Ugb25seSB3YW50IHRvIGRvXG4gICAgICAgIC8vIHRoYXQgb24gXCJ1bnN1YnNjcmliZVwiLCByZWFsbHkuIFJlc2V0dGluZyBvbiBlcnJvciBvciBjb21wbGV0aW9uIGlzIGEgZGlmZmVyZW50XG4gICAgICAgIC8vIGNvbmZpZ3VyYXRpb24uXG4gICAgICAgIGlmIChyZWZDb3VudCA9PT0gMCAmJiAhaGFzRXJyb3JlZCAmJiAhaGFzQ29tcGxldGVkKSB7XG4gICAgICAgICAgcmVzZXRDb25uZWN0aW9uID0gaGFuZGxlUmVzZXQocmVzZXRBbmRVbnN1YnNjcmliZSwgcmVzZXRPblJlZkNvdW50WmVybyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAvLyBUaGUgZm9sbG93aW5nIGxpbmUgYWRkcyB0aGUgc3Vic2NyaXB0aW9uIHRvIHRoZSBzdWJzY3JpYmVyIHBhc3NlZC5cbiAgICAgIC8vIEJhc2ljYWxseSwgYHN1YnNjcmliZXIgPT09IGRlc3Quc3Vic2NyaWJlKHN1YnNjcmliZXIpYCBpcyBgdHJ1ZWAuXG4gICAgICBkZXN0LnN1YnNjcmliZShzdWJzY3JpYmVyKTtcblxuICAgICAgaWYgKFxuICAgICAgICAhY29ubmVjdGlvbiAmJlxuICAgICAgICAvLyBDaGVjayB0aGlzIHNoYXJlUmVwbGF5IGlzIHN0aWxsIGFjdGl2YXRlIC0gaXQgY2FuIGJlIHJlc2V0IHRvIDBcbiAgICAgICAgLy8gYW5kIGJlIFwidW5zdWJzY3JpYmVkXCIgX2JlZm9yZV8gaXQgYWN0dWFsbHkgc3Vic2NyaWJlcy5cbiAgICAgICAgLy8gSWYgd2Ugd2VyZSB0byBzdWJzY3JpYmUgdGhlbiwgaXQnZCBsZWFrIGFuZCBnZXQgc3R1Y2suXG4gICAgICAgIHJlZkNvdW50ID4gMFxuICAgICAgKSB7XG4gICAgICAgIC8vIFdlIG5lZWQgdG8gY3JlYXRlIGEgc3Vic2NyaWJlciBoZXJlIC0gcmF0aGVyIHRoYW4gcGFzcyBhbiBvYnNlcnZlciBhbmRcbiAgICAgICAgLy8gYXNzaWduIHRoZSByZXR1cm5lZCBzdWJzY3JpcHRpb24gdG8gY29ubmVjdGlvbiAtIGJlY2F1c2UgaXQncyBwb3NzaWJsZVxuICAgICAgICAvLyBmb3IgcmVlbnRyYW50IHN1YnNjcmlwdGlvbnMgdG8gdGhlIHNoYXJlZCBvYnNlcnZhYmxlIHRvIG9jY3VyIGFuZCBpblxuICAgICAgICAvLyB0aG9zZSBzaXR1YXRpb25zIHdlIHdhbnQgY29ubmVjdGlvbiB0byBiZSBhbHJlYWR5LWFzc2lnbmVkIHNvIHRoYXQgd2VcbiAgICAgICAgLy8gZG9uJ3QgY3JlYXRlIGFub3RoZXIgY29ubmVjdGlvbiB0byB0aGUgc291cmNlLlxuICAgICAgICBjb25uZWN0aW9uID0gbmV3IFNhZmVTdWJzY3JpYmVyKHtcbiAgICAgICAgICBuZXh0OiAodmFsdWUpID0+IGRlc3QubmV4dCh2YWx1ZSksXG4gICAgICAgICAgZXJyb3I6IChlcnIpID0+IHtcbiAgICAgICAgICAgIGhhc0Vycm9yZWQgPSB0cnVlO1xuICAgICAgICAgICAgY2FuY2VsUmVzZXQoKTtcbiAgICAgICAgICAgIHJlc2V0Q29ubmVjdGlvbiA9IGhhbmRsZVJlc2V0KHJlc2V0LCByZXNldE9uRXJyb3IsIGVycik7XG4gICAgICAgICAgICBkZXN0LmVycm9yKGVycik7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjb21wbGV0ZTogKCkgPT4ge1xuICAgICAgICAgICAgaGFzQ29tcGxldGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIGNhbmNlbFJlc2V0KCk7XG4gICAgICAgICAgICByZXNldENvbm5lY3Rpb24gPSBoYW5kbGVSZXNldChyZXNldCwgcmVzZXRPbkNvbXBsZXRlKTtcbiAgICAgICAgICAgIGRlc3QuY29tcGxldGUoKTtcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgaW5uZXJGcm9tKHNvdXJjZSkuc3Vic2NyaWJlKGNvbm5lY3Rpb24pO1xuICAgICAgfVxuICAgIH0pKHdyYXBwZXJTb3VyY2UpO1xuICB9O1xufVxuXG5mdW5jdGlvbiBoYW5kbGVSZXNldDxUIGV4dGVuZHMgdW5rbm93bltdID0gbmV2ZXJbXT4oXG4gIHJlc2V0OiAoKSA9PiB2b2lkLFxuICBvbjogYm9vbGVhbiB8ICgoLi4uYXJnczogVCkgPT4gT2JzZXJ2YWJsZUlucHV0PGFueT4pLFxuICAuLi5hcmdzOiBUXG4pOiBTdWJzY3JpcHRpb24gfCB1bmRlZmluZWQge1xuICBpZiAob24gPT09IHRydWUpIHtcbiAgICByZXNldCgpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChvbiA9PT0gZmFsc2UpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBvblN1YnNjcmliZXIgPSBuZXcgU2FmZVN1YnNjcmliZXIoe1xuICAgIG5leHQ6ICgpID0+IHtcbiAgICAgIG9uU3Vic2NyaWJlci51bnN1YnNjcmliZSgpO1xuICAgICAgcmVzZXQoKTtcbiAgICB9LFxuICB9KTtcblxuICByZXR1cm4gaW5uZXJGcm9tKG9uKC4uLmFyZ3MpKS5zdWJzY3JpYmUob25TdWJzY3JpYmVyKTtcbn1cbiJdfQ==
