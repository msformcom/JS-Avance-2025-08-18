import{Observable}from"../Observable";import{ColdObservable}from"./ColdObservable";import{HotObservable}from"./HotObservable";import{SubscriptionLog}from"./SubscriptionLog";import{VirtualTimeScheduler,VirtualAction}from"../scheduler/VirtualTimeScheduler";import{COMPLETE_NOTIFICATION,errorNotification,nextNotification}from"../NotificationFactories";import{dateTimestampProvider}from"../scheduler/dateTimestampProvider";import{performanceTimestampProvider}from"../scheduler/performanceTimestampProvider";import{animationFrameProvider}from"../scheduler/animationFrameProvider";import{immediateProvider}from"../scheduler/immediateProvider";import{intervalProvider}from"../scheduler/intervalProvider";import{timeoutProvider}from"../scheduler/timeoutProvider";let defaultMaxFrame=750;class TestScheduler extends VirtualTimeScheduler{constructor(e){super(VirtualAction,defaultMaxFrame),this.assertDeepEqual=e,this.hotObservables=[],this.coldObservables=[],this.flushTests=[],this.runMode=!1}createTime(e){e=(this.runMode?e.trim():e).indexOf("|");if(-1===e)throw new Error('marble diagram for time should have a completion marker "|"');return e*TestScheduler.frameTimeFactor}createColdObservable(e,r,t){if(-1!==e.indexOf("^"))throw new Error('cold observable cannot have subscription offset "^"');if(-1!==e.indexOf("!"))throw new Error('cold observable cannot have unsubscription marker "!"');e=TestScheduler.parseMarbles(e,r,t,void 0,this.runMode),r=new ColdObservable(e,this);return this.coldObservables.push(r),r}createHotObservable(e,r,t){if(-1!==e.indexOf("!"))throw new Error('hot observable cannot have unsubscription marker "!"');e=TestScheduler.parseMarbles(e,r,t,void 0,this.runMode),r=new HotObservable(e,this);return this.hotObservables.push(r),r}materializeInnerObservable(e,r){let t=[];return e.subscribe({next:e=>{t.push({frame:this.frame-r,notification:nextNotification(e)})},error:e=>{t.push({frame:this.frame-r,notification:errorNotification(e)})},complete:()=>{t.push({frame:this.frame-r,notification:COMPLETE_NOTIFICATION})}}),t}expectObservable(e,r=null){let t=[],i={actual:t,ready:!1};r=TestScheduler.parseMarblesAsSubscriptions(r,this.runMode);let a=r.subscribedFrame===1/0?0:r.subscribedFrame;r=r.unsubscribedFrame;let s,o=(this.schedule(()=>{s=e.subscribe({next:e=>{e=e instanceof Observable?this.materializeInnerObservable(e,this.frame):e;t.push({frame:this.frame,notification:nextNotification(e)})},error:e=>{t.push({frame:this.frame,notification:errorNotification(e)})},complete:()=>{t.push({frame:this.frame,notification:COMPLETE_NOTIFICATION})}})},a),r!==1/0&&this.schedule(()=>s.unsubscribe(),r),this.flushTests.push(i),this).runMode;return{toBe(e,r,t){i.ready=!0,i.expected=TestScheduler.parseMarbles(e,r,t,!0,o)},toEqual:e=>{i.ready=!0,i.expected=[],this.schedule(()=>{s=e.subscribe({next:e=>{e=e instanceof Observable?this.materializeInnerObservable(e,this.frame):e;i.expected.push({frame:this.frame,notification:nextNotification(e)})},error:e=>{i.expected.push({frame:this.frame,notification:errorNotification(e)})},complete:()=>{i.expected.push({frame:this.frame,notification:COMPLETE_NOTIFICATION})}})},a)}}}expectSubscriptions(e){let r={actual:e,ready:!1},t=(this.flushTests.push(r),this).runMode;return{toBe(e){e="string"==typeof e?[e]:e;r.ready=!0,r.expected=e.map(e=>TestScheduler.parseMarblesAsSubscriptions(e,t)).filter(e=>e.subscribedFrame!==1/0)}}}flush(){for(var e=this.hotObservables;0<e.length;)e.shift().setup();super.flush(),this.flushTests=this.flushTests.filter(e=>!e.ready||(this.assertDeepEqual(e.actual,e.expected),!1))}static parseMarblesAsSubscriptions(e,i=!1){if("string"!=typeof e)return new SubscriptionLog(1/0);var a=[...e],r=a.length;let s=-1,o=1/0,n=1/0,l=0;for(let t=0;t<r;t++){let r=l;var m=e=>{r+=e*this.frameTimeFactor},c=a[t];switch(c){case" ":i||m(1);break;case"-":m(1);break;case"(":s=l,m(1);break;case")":s=-1,m(1);break;case"^":if(o!==1/0)throw new Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");o=-1<s?s:l,m(1);break;case"!":if(n!==1/0)throw new Error("found a second unsubscription point '!' in a subscription marble diagram. There can only be one.");n=-1<s?s:l;break;default:if(i&&c.match(/^[0-9]$/)&&(0===t||" "===a[t-1])){var d=a.slice(t).join("").match(/^([0-9]+(?:\.[0-9]+)?)(ms|s|m) /);if(d){t+=d[0].length-1;var h=parseFloat(d[1]);let e;switch(d[2]){case"ms":e=h;break;case"s":e=1e3*h;break;case"m":e=1e3*h*60}m(e/this.frameTimeFactor);break}}throw new Error("there can only be '^' and '!' markers in a subscription marble diagram. Found instead '"+c+"'.")}l=r}return n<0?new SubscriptionLog(o):new SubscriptionLog(o,n)}static parseMarbles(e,r,i,t=!1,a=!1){if(-1!==e.indexOf("!"))throw new Error('conventional marble diagrams cannot have the unsubscription marker "!"');var s=[...e],o=s.length,n=[],e=(a?e.replace(/^[ ]+/,""):e).indexOf("^");let l=-1===e?0:e*-this.frameTimeFactor;var m="object"!=typeof r?e=>e:e=>t&&r[e]instanceof ColdObservable?r[e].messages:r[e];let c=-1;for(let t=0;t<o;t++){let r=l;var d=e=>{r+=e*this.frameTimeFactor};let e;var h=s[t];switch(h){case" ":a||d(1);break;case"-":d(1);break;case"(":c=l,d(1);break;case")":c=-1,d(1);break;case"|":e=COMPLETE_NOTIFICATION,d(1);break;case"^":d(1);break;case"#":e=errorNotification(i||"error"),d(1);break;default:if(a&&h.match(/^[0-9]$/)&&(0===t||" "===s[t-1])){var u=s.slice(t).join("").match(/^([0-9]+(?:\.[0-9]+)?)(ms|s|m) /);if(u){t+=u[0].length-1;var b=parseFloat(u[1]);let e;switch(u[2]){case"ms":e=b;break;case"s":e=1e3*b;break;case"m":e=1e3*b*60}d(e/this.frameTimeFactor);break}}e=nextNotification(m(h)),d(1)}e&&n.push({frame:-1<c?c:l,notification:e}),l=r}return n}createAnimator(){if(!this.runMode)throw new Error("animate() must only be used in run mode");let t=0,i;return{animate:e=>{if(i)throw new Error("animate() must not be called more than once within run()");if(/[|#]/.test(e))throw new Error("animate() must not complete or error");var r;i=new Map;for(r of TestScheduler.parseMarbles(e,void 0,void 0,void 0,!0))this.schedule(()=>{var e,r=this.now(),t=Array.from(i.values());i.clear();for(e of t)e(r)},r.frame)},delegate:{requestAnimationFrame(e){var r;if(i)return r=++t,i.set(r,e),r;throw new Error("animate() was not called within run()")},cancelAnimationFrame(e){if(!i)throw new Error("animate() was not called within run()");i.delete(e)}}}}createDelegates(){let i=0,s=new Map,o=()=>{let r=this.now();var e=Array.from(s.values()).filter(({due:e})=>e<=r),t=e.filter(({type:e})=>"immediate"===e);if(0<t.length)({handle:t,handler:a}=t[0]),s.delete(t),a();else{var t=e.filter(({type:e})=>"interval"===e);if(0<t.length)({duration:t,handler:i}=a=t[0]),a.due=r+t,a.subscription=this.schedule(o,t),i();else{var i,a=e.filter(({type:e})=>"timeout"===e);if(!(0<a.length))throw new Error("Expected a due immediate or interval");({handle:t,handler:i}=a[0]),s.delete(t),i()}}};return{immediate:{setImmediate:e=>{var r=++i;return s.set(r,{due:this.now(),duration:0,handle:r,handler:e,subscription:this.schedule(o,0),type:"immediate"}),r},clearImmediate:e=>{var r=s.get(e);r&&(r.subscription.unsubscribe(),s.delete(e))}},interval:{setInterval:(e,r=0)=>{var t=++i;return s.set(t,{due:this.now()+r,duration:r,handle:t,handler:e,subscription:this.schedule(o,r),type:"interval"}),t},clearInterval:e=>{var r=s.get(e);r&&(r.subscription.unsubscribe(),s.delete(e))}},timeout:{setTimeout:(e,r=0)=>{var t=++i;return s.set(t,{due:this.now()+r,duration:r,handle:t,handler:e,subscription:this.schedule(o,r),type:"timeout"}),t},clearTimeout:e=>{var r=s.get(e);r&&(r.subscription.unsubscribe(),s.delete(e))}}}}run(e){var r=TestScheduler.frameTimeFactor,t=this.maxFrames,i=(TestScheduler.frameTimeFactor=1,this.maxFrames=1/0,this.runMode=!0,this.createAnimator()),a=this.createDelegates(),a=(animationFrameProvider.delegate=i.delegate,dateTimestampProvider.delegate=this,immediateProvider.delegate=a.immediate,intervalProvider.delegate=a.interval,timeoutProvider.delegate=a.timeout,{cold:(performanceTimestampProvider.delegate=this).createColdObservable.bind(this),hot:this.createHotObservable.bind(this),flush:this.flush.bind(this),time:this.createTime.bind(this),expectObservable:this.expectObservable.bind(this),expectSubscriptions:this.expectSubscriptions.bind(this),animate:i.animate});try{var s=e(a);return this.flush(),s}finally{TestScheduler.frameTimeFactor=r,this.maxFrames=t,this.runMode=!1,animationFrameProvider.delegate=void 0,dateTimestampProvider.delegate=void 0,immediateProvider.delegate=void 0,intervalProvider.delegate=void 0,timeoutProvider.delegate=void 0,performanceTimestampProvider.delegate=void 0}}}TestScheduler.frameTimeFactor=10;export{TestScheduler};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9yeGpzL3NyYy9pbnRlcm5hbC90ZXN0aW5nL1Rlc3RTY2hlZHVsZXIudHMiXSwibmFtZXMiOlsiT2JzZXJ2YWJsZSIsIkNvbGRPYnNlcnZhYmxlIiwiSG90T2JzZXJ2YWJsZSIsIlN1YnNjcmlwdGlvbkxvZyIsIlZpcnR1YWxUaW1lU2NoZWR1bGVyIiwiVmlydHVhbEFjdGlvbiIsIkNPTVBMRVRFX05PVElGSUNBVElPTiIsImVycm9yTm90aWZpY2F0aW9uIiwibmV4dE5vdGlmaWNhdGlvbiIsImRhdGVUaW1lc3RhbXBQcm92aWRlciIsInBlcmZvcm1hbmNlVGltZXN0YW1wUHJvdmlkZXIiLCJhbmltYXRpb25GcmFtZVByb3ZpZGVyIiwiaW1tZWRpYXRlUHJvdmlkZXIiLCJpbnRlcnZhbFByb3ZpZGVyIiwidGltZW91dFByb3ZpZGVyIiwiZGVmYXVsdE1heEZyYW1lIiwiVGVzdFNjaGVkdWxlciIsImNvbnN0cnVjdG9yIiwiYXNzZXJ0RGVlcEVxdWFsIiwic3VwZXIiLCJ0aGlzIiwiaG90T2JzZXJ2YWJsZXMiLCJjb2xkT2JzZXJ2YWJsZXMiLCJmbHVzaFRlc3RzIiwicnVuTW9kZSIsImNyZWF0ZVRpbWUiLCJtYXJibGVzIiwiaW5kZXhPZiIsInRyaW0iLCJFcnJvciIsImZyYW1lVGltZUZhY3RvciIsImNyZWF0ZUNvbGRPYnNlcnZhYmxlIiwidmFsdWVzIiwiZXJyb3IiLCJtZXNzYWdlcyIsInBhcnNlTWFyYmxlcyIsInVuZGVmaW5lZCIsImNvbGQiLCJwdXNoIiwiY3JlYXRlSG90T2JzZXJ2YWJsZSIsInN1YmplY3QiLCJtYXRlcmlhbGl6ZUlubmVyT2JzZXJ2YWJsZSIsIm9ic2VydmFibGUiLCJvdXRlckZyYW1lIiwic3Vic2NyaWJlIiwibmV4dCIsImZyYW1lIiwibm90aWZpY2F0aW9uIiwidmFsdWUiLCJjb21wbGV0ZSIsImV4cGVjdE9ic2VydmFibGUiLCJzdWJzY3JpcHRpb25NYXJibGVzIiwiYWN0dWFsIiwiZmx1c2hUZXN0IiwicmVhZHkiLCJzdWJzY3JpcHRpb25QYXJzZWQiLCJwYXJzZU1hcmJsZXNBc1N1YnNjcmlwdGlvbnMiLCJzdWJzY3JpcHRpb25GcmFtZSIsInN1YnNjcmliZWRGcmFtZSIsIkluZmluaXR5IiwidW5zdWJzY3JpcHRpb25GcmFtZSIsInVuc3Vic2NyaWJlZEZyYW1lIiwibGV0Iiwic3Vic2NyaXB0aW9uIiwic2NoZWR1bGUiLCJ4IiwidW5zdWJzY3JpYmUiLCJ0b0JlIiwiZXJyb3JWYWx1ZSIsImV4cGVjdGVkIiwidG9FcXVhbCIsIm90aGVyIiwiZXhwZWN0U3Vic2NyaXB0aW9ucyIsImFjdHVhbFN1YnNjcmlwdGlvbkxvZ3MiLCJtYXJibGVzT3JNYXJibGVzQXJyYXkiLCJtYXJibGVzQXJyYXkiLCJtYXAiLCJmaWx0ZXIiLCJmbHVzaCIsImxlbmd0aCIsInNoaWZ0Iiwic2V0dXAiLCJ0ZXN0IiwiY2hhcmFjdGVycyIsImxlbiIsImdyb3VwU3RhcnQiLCJpIiwibmV4dEZyYW1lIiwiYWR2YW5jZUZyYW1lQnkiLCJjb3VudCIsImMiLCJtYXRjaCIsInNsaWNlIiwiam9pbiIsImR1cmF0aW9uIiwicGFyc2VGbG9hdCIsImR1cmF0aW9uSW5NcyIsIm1hdGVyaWFsaXplSW5uZXJPYnNlcnZhYmxlcyIsInRlc3RNZXNzYWdlcyIsInN1YkluZGV4IiwicmVwbGFjZSIsImdldFZhbHVlIiwiY3JlYXRlQW5pbWF0b3IiLCJsYXN0SGFuZGxlIiwiYW5pbWF0ZSIsIm1lc3NhZ2UiLCJNYXAiLCJjYWxsYmFjayIsIm5vdyIsImNhbGxiYWNrcyIsIkFycmF5IiwiZnJvbSIsImNsZWFyIiwiZGVsZWdhdGUiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJoYW5kbGUiLCJzZXQiLCJjYW5jZWxBbmltYXRpb25GcmFtZSIsImRlbGV0ZSIsImNyZWF0ZURlbGVnYXRlcyIsInNjaGVkdWxlTG9va3VwIiwicnVuIiwic2NoZWR1bGVkUmVjb3Jkc0R1ZSIsImR1ZSIsImR1ZUltbWVkaWF0ZXMiLCJ0eXBlIiwiaGFuZGxlciIsImR1ZUludGVydmFscyIsImZpcnN0RHVlSW50ZXJ2YWwiLCJkdWVUaW1lb3V0cyIsImltbWVkaWF0ZSIsInNldEltbWVkaWF0ZSIsImNsZWFySW1tZWRpYXRlIiwiZ2V0IiwiaW50ZXJ2YWwiLCJzZXRJbnRlcnZhbCIsImNsZWFySW50ZXJ2YWwiLCJ0aW1lb3V0Iiwic2V0VGltZW91dCIsImNsZWFyVGltZW91dCIsInByZXZGcmFtZVRpbWVGYWN0b3IiLCJwcmV2TWF4RnJhbWVzIiwibWF4RnJhbWVzIiwiYW5pbWF0b3IiLCJkZWxlZ2F0ZXMiLCJoZWxwZXJzIiwiYmluZCIsImhvdCIsInRpbWUiLCJyZXQiXSwibWFwcGluZ3MiOiJPQUFTQSxVQUFpQyxLQUFmLHVCQUNsQkMsY0FBd0MsS0FBbEIsMEJBQ3RCQyxhQUFzQyxLQUFqQix5QkFFckJDLGVBQTBDLEtBQW5CLDJCQUV2QkMscUJBQXNCQyxhQUF3RCxLQUFuQywyQ0FFM0NDLHNCQUF1QkMsa0JBQW1CQyxnQkFBa0QsS0FBMUIsa0NBQ2xFQyxxQkFBaUUsS0FBcEMsNENBQzdCQyw0QkFBK0UsS0FBM0MsbURBQ3BDQyxzQkFBbUUsS0FBckMsNkNBRTlCQyxpQkFBeUQsS0FBaEMsd0NBQ3pCQyxnQkFBdUQsS0FBL0IsdUNBQ3hCQyxlQUFxRCxLQUE5QiwrQkFFaEMsSUFBTUMsZ0JBQTBCLFVBcUJuQkMsc0JBQXNCWixxQkFpQ2pDYSxZQUFtQkMsR0FDakJDLE1BQU1kLGNBQWVVLGVBQWUsRUFEbkJLLEtBQUFGLGdCQUFBQSxFQXRCSEUsS0FBQUMsZUFBdUMsR0FLdkNELEtBQUFFLGdCQUF5QyxHQUtqREYsS0FBQUcsV0FBOEIsR0FNOUJILEtBQUFJLFFBQVUsQ0FBQSxDQVFsQixDQUVBQyxXQUFXQyxHQUNIQyxHQUFVUCxLQUFLSSxRQUFVRSxFQUFRRSxLQUFJLEVBQWtCRixHQUFmQyxRQUFRLEdBQUcsRUFDekQsR0FBZ0IsQ0FBQyxJQUFiQSxFQUNGLE1BQU0sSUFBSUUsTUFBTSw2REFBNkQsRUFFL0UsT0FBT0YsRUFBVVgsY0FBY2MsZUFDakMs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RyxLQUFLOUgsSUFBSSxFQUNqRG9ELG9CQUFxQnBELEtBQUtvRCxvQkFBb0IwRSxLQUFLOUgsSUFBSSxFQUN2RG9GLFFBQVN1QyxFQUFTdkMsTyxHQUVwQixJQUNFLElBQU02QyxFQUFNMUMsRUFBU3NDLENBQU8sRUFFNUIsT0FEQTdILEtBQUswRCxNQUFLLEVBQ0h1RSxDQVdULEMsUUFURXJJLGNBQWNjLGdCQUFrQjhHLEVBQ2hDeEgsS0FBSzBILFVBQVlELEVBQ2pCekgsS0FBS0ksUUFBVSxDQUFBLEVBQ2ZiLHVCQUF1QnNHLFNBQVc3RSxLQUFBQSxFQUNsQzNCLHNCQUFzQndHLFNBQVc3RSxLQUFBQSxFQUNqQ3hCLGtCQUFrQnFHLFNBQVc3RSxLQUFBQSxFQUM3QnZCLGlCQUFpQm9HLFNBQVc3RSxLQUFBQSxFQUM1QnRCLGdCQUFnQm1HLFNBQVc3RSxLQUFBQSxFQUMzQjFCLDZCQUE2QnVHLFNBQVc3RSxLQUFBQSxDQUMxQyxDQUNGLEMsQ0Fwb0JPcEIsY0FBQWMsZ0JBQWtCLFVBTmRkLGFBTVciLCJmaWxlIjoibm9kZV9tb2R1bGVzL3J4anMvc3JjL2ludGVybmFsL3Rlc3RpbmcvVGVzdFNjaGVkdWxlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICcuLi9PYnNlcnZhYmxlJztcbmltcG9ydCB7IENvbGRPYnNlcnZhYmxlIH0gZnJvbSAnLi9Db2xkT2JzZXJ2YWJsZSc7XG5pbXBvcnQgeyBIb3RPYnNlcnZhYmxlIH0gZnJvbSAnLi9Ib3RPYnNlcnZhYmxlJztcbmltcG9ydCB7IFRlc3RNZXNzYWdlIH0gZnJvbSAnLi9UZXN0TWVzc2FnZSc7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb25Mb2cgfSBmcm9tICcuL1N1YnNjcmlwdGlvbkxvZyc7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICcuLi9TdWJzY3JpcHRpb24nO1xuaW1wb3J0IHsgVmlydHVhbFRpbWVTY2hlZHVsZXIsIFZpcnR1YWxBY3Rpb24gfSBmcm9tICcuLi9zY2hlZHVsZXIvVmlydHVhbFRpbWVTY2hlZHVsZXInO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZU5vdGlmaWNhdGlvbiB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7IENPTVBMRVRFX05PVElGSUNBVElPTiwgZXJyb3JOb3RpZmljYXRpb24sIG5leHROb3RpZmljYXRpb24gfSBmcm9tICcuLi9Ob3RpZmljYXRpb25GYWN0b3JpZXMnO1xuaW1wb3J0IHsgZGF0ZVRpbWVzdGFtcFByb3ZpZGVyIH0gZnJvbSAnLi4vc2NoZWR1bGVyL2RhdGVUaW1lc3RhbXBQcm92aWRlcic7XG5pbXBvcnQgeyBwZXJmb3JtYW5jZVRpbWVzdGFtcFByb3ZpZGVyIH0gZnJvbSAnLi4vc2NoZWR1bGVyL3BlcmZvcm1hbmNlVGltZXN0YW1wUHJvdmlkZXInO1xuaW1wb3J0IHsgYW5pbWF0aW9uRnJhbWVQcm92aWRlciB9IGZyb20gJy4uL3NjaGVkdWxlci9hbmltYXRpb25GcmFtZVByb3ZpZGVyJztcbmltcG9ydCB0eXBlIHsgVGltZXJIYW5kbGUgfSBmcm9tICcuLi9zY2hlZHVsZXIvdGltZXJIYW5kbGUnO1xuaW1wb3J0IHsgaW1tZWRpYXRlUHJvdmlkZXIgfSBmcm9tICcuLi9zY2hlZHVsZXIvaW1tZWRpYXRlUHJvdmlkZXInO1xuaW1wb3J0IHsgaW50ZXJ2YWxQcm92aWRlciB9IGZyb20gJy4uL3NjaGVkdWxlci9pbnRlcnZhbFByb3ZpZGVyJztcbmltcG9ydCB7IHRpbWVvdXRQcm92aWRlciB9IGZyb20gJy4uL3NjaGVkdWxlci90aW1lb3V0UHJvdmlkZXInO1xuXG5jb25zdCBkZWZhdWx0TWF4RnJhbWU6IG51bWJlciA9IDc1MDtcblxuZXhwb3J0IGludGVyZmFjZSBSdW5IZWxwZXJzIHtcbiAgY29sZDogdHlwZW9mIFRlc3RTY2hlZHVsZXIucHJvdG90eXBlLmNyZWF0ZUNvbGRPYnNlcnZhYmxlO1xuICBob3Q6IHR5cGVvZiBUZXN0U2NoZWR1bGVyLnByb3RvdHlwZS5jcmVhdGVIb3RPYnNlcnZhYmxlO1xuICBmbHVzaDogdHlwZW9mIFRlc3RTY2hlZHVsZXIucHJvdG90eXBlLmZsdXNoO1xuICB0aW1lOiB0eXBlb2YgVGVzdFNjaGVkdWxlci5wcm90b3R5cGUuY3JlYXRlVGltZTtcbiAgZXhwZWN0T2JzZXJ2YWJsZTogdHlwZW9mIFRlc3RTY2hlZHVsZXIucHJvdG90eXBlLmV4cGVjdE9ic2VydmFibGU7XG4gIGV4cGVjdFN1YnNjcmlwdGlvbnM6IHR5cGVvZiBUZXN0U2NoZWR1bGVyLnByb3RvdHlwZS5leHBlY3RTdWJzY3JpcHRpb25zO1xuICBhbmltYXRlOiAobWFyYmxlczogc3RyaW5nKSA9PiB2b2lkO1xufVxuXG5pbnRlcmZhY2UgRmx1c2hhYmxlVGVzdCB7XG4gIHJlYWR5OiBib29sZWFuO1xuICBhY3R1YWw/OiBhbnlbXTtcbiAgZXhwZWN0ZWQ/OiBhbnlbXTtcbn1cblxuZXhwb3J0IHR5cGUgb2JzZXJ2YWJsZVRvQmVGbiA9IChtYXJibGVzOiBzdHJpbmcsIHZhbHVlcz86IGFueSwgZXJyb3JWYWx1ZT86IGFueSkgPT4gdm9pZDtcbmV4cG9ydCB0eXBlIHN1YnNjcmlwdGlvbkxvZ3NUb0JlRm4gPSAobWFyYmxlczogc3RyaW5nIHwgc3RyaW5nW10pID0+IHZvaWQ7XG5cbmV4cG9ydCBjbGFzcyBUZXN0U2NoZWR1bGVyIGV4dGVuZHMgVmlydHVhbFRpbWVTY2hlZHVsZXIge1xuICAvKipcbiAgICogVGhlIG51bWJlciBvZiB2aXJ0dWFsIHRpbWUgdW5pdHMgZWFjaCBjaGFyYWN0ZXIgaW4gYSBtYXJibGUgZGlhZ3JhbSByZXByZXNlbnRzLiBJZlxuICAgKiB0aGUgdGVzdCBzY2hlZHVsZXIgaXMgYmVpbmcgdXNlZCBpbiBcInJ1biBtb2RlXCIsIHZpYSB0aGUgYHJ1bmAgbWV0aG9kLCB0aGlzIGlzIHRlbXBvcmFyaWx5XG4gICAqIHNldCB0byBgMWAgZm9yIHRoZSBkdXJhdGlvbiBvZiB0aGUgYHJ1bmAgYmxvY2ssIHRoZW4gc2V0IGJhY2sgdG8gd2hhdGV2ZXIgdmFsdWUgaXQgd2FzLlxuICAgKi9cbiAgc3RhdGljIGZyYW1lVGltZUZhY3RvciA9IDEwO1xuXG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZCBJbnRlcm5hbCBpbXBsZW1lbnRhdGlvbiBkZXRhaWwsIGRvIG5vdCB1c2UgZGlyZWN0bHkuIFdpbGwgYmUgbWFkZSBpbnRlcm5hbCBpbiB2OC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBob3RPYnNlcnZhYmxlczogSG90T2JzZXJ2YWJsZTxhbnk+W10gPSBbXTtcblxuICAvKipcbiAgICogQGRlcHJlY2F0ZWQgSW50ZXJuYWwgaW1wbGVtZW50YXRpb24gZGV0YWlsLCBkbyBub3QgdXNlIGRpcmVjdGx5LiBXaWxsIGJlIG1hZGUgaW50ZXJuYWwgaW4gdjguXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgY29sZE9ic2VydmFibGVzOiBDb2xkT2JzZXJ2YWJsZTxhbnk+W10gPSBbXTtcblxuICAvKipcbiAgICogVGVzdCBtZXRhIGRhdGEgdG8gYmUgcHJvY2Vzc2VkIGR1cmluZyBgZmx1c2goKWBcbiAgICovXG4gIHByaXZhdGUgZmx1c2hUZXN0czogRmx1c2hhYmxlVGVzdFtdID0gW107XG5cbiAgLyoqXG4gICAqIEluZGljYXRlcyB3aGV0aGVyIHRoZSBUZXN0U2NoZWR1bGVyIGluc3RhbmNlIGlzIG9wZXJhdGluZyBpbiBcInJ1biBtb2RlXCIsXG4gICAqIG1lYW5pbmcgaXQncyBwcm9jZXNzaW5nIGEgY2FsbCB0byBgcnVuKClgXG4gICAqL1xuICBwcml2YXRlIHJ1bk1vZGUgPSBmYWxzZTtcblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIGFzc2VydERlZXBFcXVhbCBBIGZ1bmN0aW9uIHRvIHNldCB1cCB5b3VyIGFzc2VydGlvbiBmb3IgeW91ciB0ZXN0IGhhcm5lc3NcbiAgICovXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBhc3NlcnREZWVwRXF1YWw6IChhY3R1YWw6IGFueSwgZXhwZWN0ZWQ6IGFueSkgPT4gYm9vbGVhbiB8IHZvaWQpIHtcbiAgICBzdXBlcihWaXJ0dWFsQWN0aW9uLCBkZWZhdWx0TWF4RnJhbWUpO1xuICB9XG5cbiAgY3JlYXRlVGltZShtYXJibGVzOiBzdHJpbmcpOiBudW1iZXIge1xuICAgIGNvbnN0IGluZGV4T2YgPSB0aGlzLnJ1bk1vZGUgPyBtYXJibGVzLnRyaW0oKS5pbmRleE9mKCd8JykgOiBtYXJibGVzLmluZGV4T2YoJ3wnKTtcbiAgICBpZiAoaW5kZXhPZiA9PT0gLTEpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignbWFyYmxlIGRpYWdyYW0gZm9yIHRpbWUgc2hvdWxkIGhhdmUgYSBjb21wbGV0aW9uIG1hcmtlciBcInxcIicpO1xuICAgIH1cbiAgICByZXR1cm4gaW5kZXhPZiAqIFRlc3RTY2hlZHVsZXIuZnJhbWVUaW1lRmFjdG9yO1xuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBtYXJibGVzIEEgZGlhZ3JhbSBpbiB0aGUgbWFyYmxlIERTTC4gTGV0dGVycyBtYXAgdG8ga2V5cyBpbiBgdmFsdWVzYCBpZiBwcm92aWRlZC5cbiAgICogQHBhcmFtIHZhbHVlcyBWYWx1ZXMgdG8gdXNlIGZvciB0aGUgbGV0dGVycyBpbiBgbWFyYmxlc2AuIElmIG9taXR0ZWQsIHRoZSBsZXR0ZXJzIHRoZW1zZWx2ZXMgYXJlIHVzZWQuXG4gICAqIEBwYXJhbSBlcnJvciBUaGUgZXJyb3IgdG8gdXNlIGZvciB0aGUgYCNgIG1hcmJsZSAoaWYgcHJlc2VudCkuXG4gICAqL1xuICBjcmVhdGVDb2xkT2JzZXJ2YWJsZTxUID0gc3RyaW5nPihtYXJibGVzOiBzdHJpbmcsIHZhbHVlcz86IHsgW21hcmJsZTogc3RyaW5nXTogVCB9LCBlcnJvcj86IGFueSk6IENvbGRPYnNlcnZhYmxlPFQ+IHtcbiAgICBpZiAobWFyYmxlcy5pbmRleE9mKCdeJykgIT09IC0xKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbGQgb2JzZXJ2YWJsZSBjYW5ub3QgaGF2ZSBzdWJzY3JpcHRpb24gb2Zmc2V0IFwiXlwiJyk7XG4gICAgfVxuICAgIGlmIChtYXJibGVzLmluZGV4T2YoJyEnKSAhPT0gLTEpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignY29sZCBvYnNlcnZhYmxlIGNhbm5vdCBoYXZlIHVuc3Vic2NyaXB0aW9uIG1hcmtlciBcIiFcIicpO1xuICAgIH1cbiAgICBjb25zdCBtZXNzYWdlcyA9IFRlc3RTY2hlZHVsZXIucGFyc2VNYXJibGVzKG1hcmJsZXMsIHZhbHVlcywgZXJyb3IsIHVuZGVmaW5lZCwgdGhpcy5ydW5Nb2RlKTtcbiAgICBjb25zdCBjb2xkID0gbmV3IENvbGRPYnNlcnZhYmxlPFQ+KG1lc3NhZ2VzLCB0aGlzKTtcbiAgICB0aGlzLmNvbGRPYnNlcnZhYmxlcy5wdXNoKGNvbGQpO1xuICAgIHJldHVybiBjb2xkO1xuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBtYXJibGVzIEEgZGlhZ3JhbSBpbiB0aGUgbWFyYmxlIERTTC4gTGV0dGVycyBtYXAgdG8ga2V5cyBpbiBgdmFsdWVzYCBpZiBwcm92aWRlZC5cbiAgICogQHBhcmFtIHZhbHVlcyBWYWx1ZXMgdG8gdXNlIGZvciB0aGUgbGV0dGVycyBpbiBgbWFyYmxlc2AuIElmIG9taXR0ZWQsIHRoZSBsZXR0ZXJzIHRoZW1zZWx2ZXMgYXJlIHVzZWQuXG4gICAqIEBwYXJhbSBlcnJvciBUaGUgZXJyb3IgdG8gdXNlIGZvciB0aGUgYCNgIG1hcmJsZSAoaWYgcHJlc2VudCkuXG4gICAqL1xuICBjcmVhdGVIb3RPYnNlcnZhYmxlPFQgPSBzdHJpbmc+KG1hcmJsZXM6IHN0cmluZywgdmFsdWVzPzogeyBbbWFyYmxlOiBzdHJpbmddOiBUIH0sIGVycm9yPzogYW55KTogSG90T2JzZXJ2YWJsZTxUPiB7XG4gICAgaWYgKG1hcmJsZXMuaW5kZXhPZignIScpICE9PSAtMSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdob3Qgb2JzZXJ2YWJsZSBjYW5ub3QgaGF2ZSB1bnN1YnNjcmlwdGlvbiBtYXJrZXIgXCIhXCInKTtcbiAgICB9XG4gICAgY29uc3QgbWVzc2FnZXMgPSBUZXN0U2NoZWR1bGVyLnBhcnNlTWFyYmxlcyhtYXJibGVzLCB2YWx1ZXMsIGVycm9yLCB1bmRlZmluZWQsIHRoaXMucnVuTW9kZSk7XG4gICAgY29uc3Qgc3ViamVjdCA9IG5ldyBIb3RPYnNlcnZhYmxlPFQ+KG1lc3NhZ2VzLCB0aGlzKTtcbiAgICB0aGlzLmhvdE9ic2VydmFibGVzLnB1c2goc3ViamVjdCk7XG4gICAgcmV0dXJuIHN1YmplY3Q7XG4gIH1cblxuICBwcml2YXRlIG1hdGVyaWFsaXplSW5uZXJPYnNlcnZhYmxlKG9ic2VydmFibGU6IE9ic2VydmFibGU8YW55Piwgb3V0ZXJGcmFtZTogbnVtYmVyKTogVGVzdE1lc3NhZ2VbXSB7XG4gICAgY29uc3QgbWVzc2FnZXM6IFRlc3RNZXNzYWdlW10gPSBbXTtcbiAgICBvYnNlcnZhYmxlLnN1YnNjcmliZSh7XG4gICAgICBuZXh0OiAodmFsdWUpID0+IHtcbiAgICAgICAgbWVzc2FnZXMucHVzaCh7IGZyYW1lOiB0aGlzLmZyYW1lIC0gb3V0ZXJGcmFtZSwgbm90aWZpY2F0aW9uOiBuZXh0Tm90aWZpY2F0aW9uKHZhbHVlKSB9KTtcbiAgICAgIH0sXG4gICAgICBlcnJvcjogKGVycm9yKSA9PiB7XG4gICAgICAgIG1lc3NhZ2VzLnB1c2goeyBmcmFtZTogdGhpcy5mcmFtZSAtIG91dGVyRnJhbWUsIG5vdGlmaWNhdGlvbjogZXJyb3JOb3RpZmljYXRpb24oZXJyb3IpIH0pO1xuICAgICAgfSxcbiAgICAgIGNvbXBsZXRlOiAoKSA9PiB7XG4gICAgICAgIG1lc3NhZ2VzLnB1c2goeyBmcmFtZTogdGhpcy5mcmFtZSAtIG91dGVyRnJhbWUsIG5vdGlmaWNhdGlvbjogQ09NUExFVEVfTk9USUZJQ0FUSU9OIH0pO1xuICAgICAgfSxcbiAgICB9KTtcbiAgICByZXR1cm4gbWVzc2FnZXM7XG4gIH1cblxuICBleHBlY3RPYnNlcnZhYmxlPFQ+KG9ic2VydmFibGU6IE9ic2VydmFibGU8VD4sIHN1YnNjcmlwdGlvbk1hcmJsZXM6IHN0cmluZyB8IG51bGwgPSBudWxsKSB7XG4gICAgY29uc3QgYWN0dWFsOiBUZXN0TWVzc2FnZVtdID0gW107XG4gICAgY29uc3QgZmx1c2hUZXN0OiBGbHVzaGFibGVUZXN0ID0geyBhY3R1YWwsIHJlYWR5OiBmYWxzZSB9O1xuICAgIGNvbnN0IHN1YnNjcmlwdGlvblBhcnNlZCA9IFRlc3RTY2hlZHVsZXIucGFyc2VNYXJibGVzQXNTdWJzY3JpcHRpb25zKHN1YnNjcmlwdGlvbk1hcmJsZXMsIHRoaXMucnVuTW9kZSk7XG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uRnJhbWUgPSBzdWJzY3JpcHRpb25QYXJzZWQuc3Vic2NyaWJlZEZyYW1lID09PSBJbmZpbml0eSA/IDAgOiBzdWJzY3JpcHRpb25QYXJzZWQuc3Vic2NyaWJlZEZyYW1lO1xuICAgIGNvbnN0IHVuc3Vic2NyaXB0aW9uRnJhbWUgPSBzdWJzY3JpcHRpb25QYXJzZWQudW5zdWJzY3JpYmVkRnJhbWU7XG4gICAgbGV0IHN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuXG4gICAgdGhpcy5zY2hlZHVsZSgoKSA9PiB7XG4gICAgICBzdWJzY3JpcHRpb24gPSBvYnNlcnZhYmxlLnN1YnNjcmliZSh7XG4gICAgICAgIG5leHQ6ICh4KSA9PiB7XG4gICAgICAgICAgLy8gU3VwcG9ydCBPYnNlcnZhYmxlLW9mLU9ic2VydmFibGVzXG4gICAgICAgICAgY29uc3QgdmFsdWUgPSB4IGluc3RhbmNlb2YgT2JzZXJ2YWJsZSA/IHRoaXMubWF0ZXJpYWxpemVJbm5lck9ic2VydmFibGUoeCwgdGhpcy5mcmFtZSkgOiB4O1xuICAgICAgICAgIGFjdHVhbC5wdXNoKHsgZnJhbWU6IHRoaXMuZnJhbWUsIG5vdGlmaWNhdGlvbjogbmV4dE5vdGlmaWNhdGlvbih2YWx1ZSkgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiAoZXJyb3IpID0+IHtcbiAgICAgICAgICBhY3R1YWwucHVzaCh7IGZyYW1lOiB0aGlzLmZyYW1lLCBub3RpZmljYXRpb246IGVycm9yTm90aWZpY2F0aW9uKGVycm9yKSB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgY29tcGxldGU6ICgpID0+IHtcbiAgICAgICAgICBhY3R1YWwucHVzaCh7IGZyYW1lOiB0aGlzLmZyYW1lLCBub3RpZmljYXRpb246IENPTVBMRVRFX05PVElGSUNBVElPTiB9KTtcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0sIHN1YnNjcmlwdGlvbkZyYW1lKTtcblxuICAgIGlmICh1bnN1YnNjcmlwdGlvbkZyYW1lICE9PSBJbmZpbml0eSkge1xuICAgICAgdGhpcy5zY2hlZHVsZSgoKSA9PiBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKSwgdW5zdWJzY3JpcHRpb25GcmFtZSk7XG4gICAgfVxuXG4gICAgdGhpcy5mbHVzaFRlc3RzLnB1c2goZmx1c2hUZXN0KTtcbiAgICBjb25zdCB7IHJ1bk1vZGUgfSA9IHRoaXM7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdG9CZShtYXJibGVzOiBzdHJpbmcsIHZhbHVlcz86IGFueSwgZXJyb3JWYWx1ZT86IGFueSkge1xuICAgICAgICBmbHVzaFRlc3QucmVhZHkgPSB0cnVlO1xuICAgICAgICBmbHVzaFRlc3QuZXhwZWN0ZWQgPSBUZXN0U2NoZWR1bGVyLnBhcnNlTWFyYmxlcyhtYXJibGVzLCB2YWx1ZXMsIGVycm9yVmFsdWUsIHRydWUsIHJ1bk1vZGUpO1xuICAgICAgfSxcbiAgICAgIHRvRXF1YWw6IChvdGhlcjogT2JzZXJ2YWJsZTxUPikgPT4ge1xuICAgICAgICBmbHVzaFRlc3QucmVhZHkgPSB0cnVlO1xuICAgICAgICBmbHVzaFRlc3QuZXhwZWN0ZWQgPSBbXTtcbiAgICAgICAgdGhpcy5zY2hlZHVsZSgoKSA9PiB7XG4gICAgICAgICAgc3Vic2NyaXB0aW9uID0gb3RoZXIuc3Vic2NyaWJlKHtcbiAgICAgICAgICAgIG5leHQ6ICh4KSA9PiB7XG4gICAgICAgICAgICAgIC8vIFN1cHBvcnQgT2JzZXJ2YWJsZS1vZi1PYnNlcnZhYmxlc1xuICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHggaW5zdGFuY2VvZiBPYnNlcnZhYmxlID8gdGhpcy5tYXRlcmlhbGl6ZUlubmVyT2JzZXJ2YWJsZSh4LCB0aGlzLmZyYW1lKSA6IHg7XG4gICAgICAgICAgICAgIGZsdXNoVGVzdC5leHBlY3RlZCEucHVzaCh7IGZyYW1lOiB0aGlzLmZyYW1lLCBub3RpZmljYXRpb246IG5leHROb3RpZmljYXRpb24odmFsdWUpIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgZmx1c2hUZXN0LmV4cGVjdGVkIS5wdXNoKHsgZnJhbWU6IHRoaXMuZnJhbWUsIG5vdGlmaWNhdGlvbjogZXJyb3JOb3RpZmljYXRpb24oZXJyb3IpIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBsZXRlOiAoKSA9PiB7XG4gICAgICAgICAgICAgIGZsdXNoVGVzdC5leHBlY3RlZCEucHVzaCh7IGZyYW1lOiB0aGlzLmZyYW1lLCBub3RpZmljYXRpb246IENPTVBMRVRFX05PVElGSUNBVElPTiB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sIHN1YnNjcmlwdGlvbkZyYW1lKTtcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIGV4cGVjdFN1YnNjcmlwdGlvbnMoYWN0dWFsU3Vic2NyaXB0aW9uTG9nczogU3Vic2NyaXB0aW9uTG9nW10pOiB7IHRvQmU6IHN1YnNjcmlwdGlvbkxvZ3NUb0JlRm4gfSB7XG4gICAgY29uc3QgZmx1c2hUZXN0OiBGbHVzaGFibGVUZXN0ID0geyBhY3R1YWw6IGFjdHVhbFN1YnNjcmlwdGlvbkxvZ3MsIHJlYWR5OiBmYWxzZSB9O1xuICAgIHRoaXMuZmx1c2hUZXN0cy5wdXNoKGZsdXNoVGVzdCk7XG4gICAgY29uc3QgeyBydW5Nb2RlIH0gPSB0aGlzO1xuICAgIHJldHVybiB7XG4gICAgICB0b0JlKG1hcmJsZXNPck1hcmJsZXNBcnJheTogc3RyaW5nIHwgc3RyaW5nW10pIHtcbiAgICAgICAgY29uc3QgbWFyYmxlc0FycmF5OiBzdHJpbmdbXSA9IHR5cGVvZiBtYXJibGVzT3JNYXJibGVzQXJyYXkgPT09ICdzdHJpbmcnID8gW21hcmJsZXNPck1hcmJsZXNBcnJheV0gOiBtYXJibGVzT3JNYXJibGVzQXJyYXk7XG4gICAgICAgIGZsdXNoVGVzdC5yZWFkeSA9IHRydWU7XG4gICAgICAgIGZsdXNoVGVzdC5leHBlY3RlZCA9IG1hcmJsZXNBcnJheVxuICAgICAgICAgIC5tYXAoKG1hcmJsZXMpID0+IFRlc3RTY2hlZHVsZXIucGFyc2VNYXJibGVzQXNTdWJzY3JpcHRpb25zKG1hcmJsZXMsIHJ1bk1vZGUpKVxuICAgICAgICAgIC5maWx0ZXIoKG1hcmJsZXMpID0+IG1hcmJsZXMuc3Vic2NyaWJlZEZyYW1lICE9PSBJbmZpbml0eSk7XG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBmbHVzaCgpIHtcbiAgICBjb25zdCBob3RPYnNlcnZhYmxlcyA9IHRoaXMuaG90T2JzZXJ2YWJsZXM7XG4gICAgd2hpbGUgKGhvdE9ic2VydmFibGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGhvdE9ic2VydmFibGVzLnNoaWZ0KCkhLnNldHVwKCk7XG4gICAgfVxuXG4gICAgc3VwZXIuZmx1c2goKTtcblxuICAgIHRoaXMuZmx1c2hUZXN0cyA9IHRoaXMuZmx1c2hUZXN0cy5maWx0ZXIoKHRlc3QpID0+IHtcbiAgICAgIGlmICh0ZXN0LnJlYWR5KSB7XG4gICAgICAgIHRoaXMuYXNzZXJ0RGVlcEVxdWFsKHRlc3QuYWN0dWFsLCB0ZXN0LmV4cGVjdGVkKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG4gIH1cblxuICBzdGF0aWMgcGFyc2VNYXJibGVzQXNTdWJzY3JpcHRpb25zKG1hcmJsZXM6IHN0cmluZyB8IG51bGwsIHJ1bk1vZGUgPSBmYWxzZSk6IFN1YnNjcmlwdGlvbkxvZyB7XG4gICAgaWYgKHR5cGVvZiBtYXJibGVzICE9PSAnc3RyaW5nJykge1xuICAgICAgcmV0dXJuIG5ldyBTdWJzY3JpcHRpb25Mb2coSW5maW5pdHkpO1xuICAgIH1cbiAgICAvLyBTcHJlYWRpbmcgdGhlIG1hcmJsZXMgaW50byBhbiBhcnJheSBsZXZlcmFnZXMgRVMyMDE1J3Mgc3VwcG9ydCBmb3IgZW1vamlcbiAgICAvLyBjaGFyYWN0ZXJzIHdoZW4gaXRlcmF0aW5nIHN0cmluZ3MuXG4gICAgY29uc3QgY2hhcmFjdGVycyA9IFsuLi5tYXJibGVzXTtcbiAgICBjb25zdCBsZW4gPSBjaGFyYWN0ZXJzLmxlbmd0aDtcbiAgICBsZXQgZ3JvdXBTdGFydCA9IC0xO1xuICAgIGxldCBzdWJzY3JpcHRpb25GcmFtZSA9IEluZmluaXR5O1xuICAgIGxldCB1bnN1YnNjcmlwdGlvbkZyYW1lID0gSW5maW5pdHk7XG4gICAgbGV0IGZyYW1lID0gMDtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIGxldCBuZXh0RnJhbWUgPSBmcmFtZTtcbiAgICAgIGNvbnN0IGFkdmFuY2VGcmFtZUJ5ID0gKGNvdW50OiBudW1iZXIpID0+IHtcbiAgICAgICAgbmV4dEZyYW1lICs9IGNvdW50ICogdGhpcy5mcmFtZVRpbWVGYWN0b3I7XG4gICAgICB9O1xuICAgICAgY29uc3QgYyA9IGNoYXJhY3RlcnNbaV07XG4gICAgICBzd2l0Y2ggKGMpIHtcbiAgICAgICAgY2FzZSAnICc6XG4gICAgICAgICAgLy8gV2hpdGVzcGFjZSBubyBsb25nZXIgYWR2YW5jZXMgdGltZVxuICAgICAgICAgIGlmICghcnVuTW9kZSkge1xuICAgICAgICAgICAgYWR2YW5jZUZyYW1lQnkoMSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICctJzpcbiAgICAgICAgICBhZHZhbmNlRnJhbWVCeSgxKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnKCc6XG4gICAgICAgICAgZ3JvdXBTdGFydCA9IGZyYW1lO1xuICAgICAgICAgIGFkdmFuY2VGcmFtZUJ5KDEpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICcpJzpcbiAgICAgICAgICBncm91cFN0YXJ0ID0gLTE7XG4gICAgICAgICAgYWR2YW5jZUZyYW1lQnkoMSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ14nOlxuICAgICAgICAgIGlmIChzdWJzY3JpcHRpb25GcmFtZSAhPT0gSW5maW5pdHkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImZvdW5kIGEgc2Vjb25kIHN1YnNjcmlwdGlvbiBwb2ludCAnXicgaW4gYSBcIiArICdzdWJzY3JpcHRpb24gbWFyYmxlIGRpYWdyYW0uIFRoZXJlIGNhbiBvbmx5IGJlIG9uZS4nKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgc3Vic2NyaXB0aW9uRnJhbWUgPSBncm91cFN0YXJ0ID4gLTEgPyBncm91cFN0YXJ0IDogZnJhbWU7XG4gICAgICAgICAgYWR2YW5jZUZyYW1lQnkoMSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJyEnOlxuICAgICAgICAgIGlmICh1bnN1YnNjcmlwdGlvbkZyYW1lICE9PSBJbmZpbml0eSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiZm91bmQgYSBzZWNvbmQgdW5zdWJzY3JpcHRpb24gcG9pbnQgJyEnIGluIGEgXCIgKyAnc3Vic2NyaXB0aW9uIG1hcmJsZSBkaWFncmFtLiBUaGVyZSBjYW4gb25seSBiZSBvbmUuJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHVuc3Vic2NyaXB0aW9uRnJhbWUgPSBncm91cFN0YXJ0ID4gLTEgPyBncm91cFN0YXJ0IDogZnJhbWU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgLy8gdGltZSBwcm9ncmVzc2lvbiBzeW50YXhcbiAgICAgICAgICBpZiAocnVuTW9kZSAmJiBjLm1hdGNoKC9eWzAtOV0kLykpIHtcbiAgICAgICAgICAgIC8vIFRpbWUgcHJvZ3Jlc3Npb24gbXVzdCBiZSBwcmVjZWRlZCBieSBhdCBsZWFzdCBvbmUgc3BhY2VcbiAgICAgICAgICAgIC8vIGlmIGl0J3Mgbm90IGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIGRpYWdyYW1cbiAgICAgICAgICAgIGlmIChpID09PSAwIHx8IGNoYXJhY3RlcnNbaSAtIDFdID09PSAnICcpIHtcbiAgICAgICAgICAgICAgY29uc3QgYnVmZmVyID0gY2hhcmFjdGVycy5zbGljZShpKS5qb2luKCcnKTtcbiAgICAgICAgICAgICAgY29uc3QgbWF0Y2ggPSBidWZmZXIubWF0Y2goL14oWzAtOV0rKD86XFwuWzAtOV0rKT8pKG1zfHN8bSkgLyk7XG4gICAgICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgICAgIGkgKz0gbWF0Y2hbMF0ubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICAgICBjb25zdCBkdXJhdGlvbiA9IHBhcnNlRmxvYXQobWF0Y2hbMV0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IHVuaXQgPSBtYXRjaFsyXTtcbiAgICAgICAgICAgICAgICBsZXQgZHVyYXRpb25Jbk1zOiBudW1iZXI7XG5cbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHVuaXQpIHtcbiAgICAgICAgICAgICAgICAgIGNhc2UgJ21zJzpcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb25Jbk1zID0gZHVyYXRpb247XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgY2FzZSAncyc6XG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uSW5NcyA9IGR1cmF0aW9uICogMTAwMDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICBjYXNlICdtJzpcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb25Jbk1zID0gZHVyYXRpb24gKiAxMDAwICogNjA7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgYWR2YW5jZUZyYW1lQnkoZHVyYXRpb25Jbk1zISAvIHRoaXMuZnJhbWVUaW1lRmFjdG9yKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInRoZXJlIGNhbiBvbmx5IGJlICdeJyBhbmQgJyEnIG1hcmtlcnMgaW4gYSBcIiArIFwic3Vic2NyaXB0aW9uIG1hcmJsZSBkaWFncmFtLiBGb3VuZCBpbnN0ZWFkICdcIiArIGMgKyBcIicuXCIpO1xuICAgICAgfVxuXG4gICAgICBmcmFtZSA9IG5leHRGcmFtZTtcbiAgICB9XG5cbiAgICBpZiAodW5zdWJzY3JpcHRpb25GcmFtZSA8IDApIHtcbiAgICAgIHJldHVybiBuZXcgU3Vic2NyaXB0aW9uTG9nKHN1YnNjcmlwdGlvbkZyYW1lKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG5ldyBTdWJzY3JpcHRpb25Mb2coc3Vic2NyaXB0aW9uRnJhbWUsIHVuc3Vic2NyaXB0aW9uRnJhbWUpO1xuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyBwYXJzZU1hcmJsZXMoXG4gICAgbWFyYmxlczogc3RyaW5nLFxuICAgIHZhbHVlcz86IGFueSxcbiAgICBlcnJvclZhbHVlPzogYW55LFxuICAgIG1hdGVyaWFsaXplSW5uZXJPYnNlcnZhYmxlczogYm9vbGVhbiA9IGZhbHNlLFxuICAgIHJ1bk1vZGUgPSBmYWxzZVxuICApOiBUZXN0TWVzc2FnZVtdIHtcbiAgICBpZiAobWFyYmxlcy5pbmRleE9mKCchJykgIT09IC0xKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbnZlbnRpb25hbCBtYXJibGUgZGlhZ3JhbXMgY2Fubm90IGhhdmUgdGhlICcgKyAndW5zdWJzY3JpcHRpb24gbWFya2VyIFwiIVwiJyk7XG4gICAgfVxuICAgIC8vIFNwcmVhZGluZyB0aGUgbWFyYmxlcyBpbnRvIGFuIGFycmF5IGxldmVyYWdlcyBFUzIwMTUncyBzdXBwb3J0IGZvciBlbW9qaVxuICAgIC8vIGNoYXJhY3RlcnMgd2hlbiBpdGVyYXRpbmcgc3RyaW5ncy5cbiAgICBjb25zdCBjaGFyYWN0ZXJzID0gWy4uLm1hcmJsZXNdO1xuICAgIGNvbnN0IGxlbiA9IGNoYXJhY3RlcnMubGVuZ3RoO1xuICAgIGNvbnN0IHRlc3RNZXNzYWdlczogVGVzdE1lc3NhZ2VbXSA9IFtdO1xuICAgIGNvbnN0IHN1YkluZGV4ID0gcnVuTW9kZSA/IG1hcmJsZXMucmVwbGFjZSgvXlsgXSsvLCAnJykuaW5kZXhPZignXicpIDogbWFyYmxlcy5pbmRleE9mKCdeJyk7XG4gICAgbGV0IGZyYW1lID0gc3ViSW5kZXggPT09IC0xID8gMCA6IHN1YkluZGV4ICogLXRoaXMuZnJhbWVUaW1lRmFjdG9yO1xuICAgIGNvbnN0IGdldFZhbHVlID1cbiAgICAgIHR5cGVvZiB2YWx1ZXMgIT09ICdvYmplY3QnXG4gICAgICAgID8gKHg6IGFueSkgPT4geFxuICAgICAgICA6ICh4OiBhbnkpID0+IHtcbiAgICAgICAgICAgIC8vIFN1cHBvcnQgT2JzZXJ2YWJsZS1vZi1PYnNlcnZhYmxlc1xuICAgICAgICAgICAgaWYgKG1hdGVyaWFsaXplSW5uZXJPYnNlcnZhYmxlcyAmJiB2YWx1ZXNbeF0gaW5zdGFuY2VvZiBDb2xkT2JzZXJ2YWJsZSkge1xuICAgICAgICAgICAgICByZXR1cm4gdmFsdWVzW3hdLm1lc3NhZ2VzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlc1t4XTtcbiAgICAgICAgICB9O1xuICAgIGxldCBncm91cFN0YXJ0ID0gLTE7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICBsZXQgbmV4dEZyYW1lID0gZnJhbWU7XG4gICAgICBjb25zdCBhZHZhbmNlRnJhbWVCeSA9IChjb3VudDogbnVtYmVyKSA9PiB7XG4gICAgICAgIG5leHRGcmFtZSArPSBjb3VudCAqIHRoaXMuZnJhbWVUaW1lRmFjdG9yO1xuICAgICAgfTtcblxuICAgICAgbGV0IG5vdGlmaWNhdGlvbjogT2JzZXJ2YWJsZU5vdGlmaWNhdGlvbjxhbnk+IHwgdW5kZWZpbmVkO1xuICAgICAgY29uc3QgYyA9IGNoYXJhY3RlcnNbaV07XG4gICAgICBzd2l0Y2ggKGMpIHtcbiAgICAgICAgY2FzZSAnICc6XG4gICAgICAgICAgLy8gV2hpdGVzcGFjZSBubyBsb25nZXIgYWR2YW5jZXMgdGltZVxuICAgICAgICAgIGlmICghcnVuTW9kZSkge1xuICAgICAgICAgICAgYWR2YW5jZUZyYW1lQnkoMSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICctJzpcbiAgICAgICAgICBhZHZhbmNlRnJhbWVCeSgxKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnKCc6XG4gICAgICAgICAgZ3JvdXBTdGFydCA9IGZyYW1lO1xuICAgICAgICAgIGFkdmFuY2VGcmFtZUJ5KDEpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICcpJzpcbiAgICAgICAgICBncm91cFN0YXJ0ID0gLTE7XG4gICAgICAgICAgYWR2YW5jZUZyYW1lQnkoMSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3wnOlxuICAgICAgICAgIG5vdGlmaWNhdGlvbiA9IENPTVBMRVRFX05PVElGSUNBVElPTjtcbiAgICAgICAgICBhZHZhbmNlRnJhbWVCeSgxKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnXic6XG4gICAgICAgICAgYWR2YW5jZUZyYW1lQnkoMSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJyMnOlxuICAgICAgICAgIG5vdGlmaWNhdGlvbiA9IGVycm9yTm90aWZpY2F0aW9uKGVycm9yVmFsdWUgfHwgJ2Vycm9yJyk7XG4gICAgICAgICAgYWR2YW5jZUZyYW1lQnkoMSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgLy8gTWlnaHQgYmUgdGltZSBwcm9ncmVzc2lvbiBzeW50YXgsIG9yIGEgdmFsdWUgbGl0ZXJhbFxuICAgICAgICAgIGlmIChydW5Nb2RlICYmIGMubWF0Y2goL15bMC05XSQvKSkge1xuICAgICAgICAgICAgLy8gVGltZSBwcm9ncmVzc2lvbiBtdXN0IGJlIHByZWNlZGVkIGJ5IGF0IGxlYXN0IG9uZSBzcGFjZVxuICAgICAgICAgICAgLy8gaWYgaXQncyBub3QgYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgZGlhZ3JhbVxuICAgICAgICAgICAgaWYgKGkgPT09IDAgfHwgY2hhcmFjdGVyc1tpIC0gMV0gPT09ICcgJykge1xuICAgICAgICAgICAgICBjb25zdCBidWZmZXIgPSBjaGFyYWN0ZXJzLnNsaWNlKGkpLmpvaW4oJycpO1xuICAgICAgICAgICAgICBjb25zdCBtYXRjaCA9IGJ1ZmZlci5tYXRjaCgvXihbMC05XSsoPzpcXC5bMC05XSspPykobXN8c3xtKSAvKTtcbiAgICAgICAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgICAgICAgaSArPSBtYXRjaFswXS5sZW5ndGggLSAxO1xuICAgICAgICAgICAgICAgIGNvbnN0IGR1cmF0aW9uID0gcGFyc2VGbG9hdChtYXRjaFsxXSk7XG4gICAgICAgICAgICAgICAgY29uc3QgdW5pdCA9IG1hdGNoWzJdO1xuICAgICAgICAgICAgICAgIGxldCBkdXJhdGlvbkluTXM6IG51bWJlcjtcblxuICAgICAgICAgICAgICAgIHN3aXRjaCAodW5pdCkge1xuICAgICAgICAgICAgICAgICAgY2FzZSAnbXMnOlxuICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbkluTXMgPSBkdXJhdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICBjYXNlICdzJzpcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb25Jbk1zID0gZHVyYXRpb24gKiAxMDAwO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgIGNhc2UgJ20nOlxuICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbkluTXMgPSBkdXJhdGlvbiAqIDEwMDAgKiA2MDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBhZHZhbmNlRnJhbWVCeShkdXJhdGlvbkluTXMhIC8gdGhpcy5mcmFtZVRpbWVGYWN0b3IpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbm90aWZpY2F0aW9uID0gbmV4dE5vdGlmaWNhdGlvbihnZXRWYWx1ZShjKSk7XG4gICAgICAgICAgYWR2YW5jZUZyYW1lQnkoMSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG5cbiAgICAgIGlmIChub3RpZmljYXRpb24pIHtcbiAgICAgICAgdGVzdE1lc3NhZ2VzLnB1c2goeyBmcmFtZTogZ3JvdXBTdGFydCA+IC0xID8gZ3JvdXBTdGFydCA6IGZyYW1lLCBub3RpZmljYXRpb24gfSk7XG4gICAgICB9XG5cbiAgICAgIGZyYW1lID0gbmV4dEZyYW1lO1xuICAgIH1cbiAgICByZXR1cm4gdGVzdE1lc3NhZ2VzO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVBbmltYXRvcigpIHtcbiAgICBpZiAoIXRoaXMucnVuTW9kZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdhbmltYXRlKCkgbXVzdCBvbmx5IGJlIHVzZWQgaW4gcnVuIG1vZGUnKTtcbiAgICB9XG5cbiAgICAvLyBUaGUgVGVzdFNjaGVkdWxlciBhc3NpZ25zIGEgZGVsZWdhdGUgdG8gdGhlIHByb3ZpZGVyIHRoYXQncyB1c2VkIGZvclxuICAgIC8vIHJlcXVlc3RBbmltYXRpb25GcmFtZSAockFGKS4gVGhlIGRlbGVnYXRlIHdvcmtzIGluIGNvbmp1bmN0aW9uIHdpdGggdGhlXG4gICAgLy8gYW5pbWF0ZSBydW4gaGVscGVyIHRvIGNvb3JkaW5hdGUgdGhlIGludm9jYXRpb24gb2YgYW55IHJBRiBjYWxsYmFja3MsXG4gICAgLy8gdGhhdCBhcmUgZWZmZWN0ZWQgd2l0aGluIHRlc3RzLCB3aXRoIHRoZSBhbmltYXRpb24gZnJhbWVzIHNwZWNpZmllZCBieVxuICAgIC8vIHRoZSB0ZXN0J3MgYXV0aG9yIC0gaW4gdGhlIG1hcmJsZXMgdGhhdCBhcmUgcGFzc2VkIHRvIHRoZSBhbmltYXRlIHJ1blxuICAgIC8vIGhlbHBlci4gVGhpcyBhbGxvd3MgdGhlIHRlc3QncyBhdXRob3IgdG8gd3JpdGUgZGV0ZXJtaW5pc3RpYyB0ZXN0cyBhbmRcbiAgICAvLyBnaXZlcyB0aGUgYXV0aG9yIGZ1bGwgY29udHJvbCBvdmVyIHdoZW4gLSBvciBpZiAtIGFuaW1hdGlvbiBmcmFtZXMgYXJlXG4gICAgLy8gJ3BhaW50ZWQnLlxuXG4gICAgbGV0IGxhc3RIYW5kbGUgPSAwO1xuICAgIGxldCBtYXA6IE1hcDxudW1iZXIsIEZyYW1lUmVxdWVzdENhbGxiYWNrPiB8IHVuZGVmaW5lZDtcblxuICAgIGNvbnN0IGRlbGVnYXRlID0ge1xuICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGNhbGxiYWNrOiBGcmFtZVJlcXVlc3RDYWxsYmFjaykge1xuICAgICAgICBpZiAoIW1hcCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignYW5pbWF0ZSgpIHdhcyBub3QgY2FsbGVkIHdpdGhpbiBydW4oKScpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGhhbmRsZSA9ICsrbGFzdEhhbmRsZTtcbiAgICAgICAgbWFwLnNldChoYW5kbGUsIGNhbGxiYWNrKTtcbiAgICAgICAgcmV0dXJuIGhhbmRsZTtcbiAgICAgIH0sXG4gICAgICBjYW5jZWxBbmltYXRpb25GcmFtZShoYW5kbGU6IG51bWJlcikge1xuICAgICAgICBpZiAoIW1hcCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignYW5pbWF0ZSgpIHdhcyBub3QgY2FsbGVkIHdpdGhpbiBydW4oKScpO1xuICAgICAgICB9XG4gICAgICAgIG1hcC5kZWxldGUoaGFuZGxlKTtcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIGNvbnN0IGFuaW1hdGUgPSAobWFyYmxlczogc3RyaW5nKSA9PiB7XG4gICAgICBpZiAobWFwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignYW5pbWF0ZSgpIG11c3Qgbm90IGJlIGNhbGxlZCBtb3JlIHRoYW4gb25jZSB3aXRoaW4gcnVuKCknKTtcbiAgICAgIH1cbiAgICAgIGlmICgvW3wjXS8udGVzdChtYXJibGVzKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2FuaW1hdGUoKSBtdXN0IG5vdCBjb21wbGV0ZSBvciBlcnJvcicpO1xuICAgICAgfVxuICAgICAgbWFwID0gbmV3IE1hcDxudW1iZXIsIEZyYW1lUmVxdWVzdENhbGxiYWNrPigpO1xuICAgICAgY29uc3QgbWVzc2FnZXMgPSBUZXN0U2NoZWR1bGVyLnBhcnNlTWFyYmxlcyhtYXJibGVzLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB0cnVlKTtcbiAgICAgIGZvciAoY29uc3QgbWVzc2FnZSBvZiBtZXNzYWdlcykge1xuICAgICAgICB0aGlzLnNjaGVkdWxlKCgpID0+IHtcbiAgICAgICAgICBjb25zdCBub3cgPSB0aGlzLm5vdygpO1xuICAgICAgICAgIC8vIENhcHR1cmUgdGhlIGNhbGxiYWNrcyB3aXRoaW4gdGhlIHF1ZXVlIGFuZCBjbGVhciB0aGUgcXVldWVcbiAgICAgICAgICAvLyBiZWZvcmUgZW51bWVyYXRpbmcgdGhlIGNhbGxiYWNrcywgYXMgY2FsbGJhY2tzIG1pZ2h0XG4gICAgICAgICAgLy8gcmVzY2hlZHVsZSB0aGVtc2VsdmVzLiAoQW5kLCB5ZWFoLCB3ZSdyZSB1c2luZyBhIE1hcCB0byByZXByZXNlbnRcbiAgICAgICAgICAvLyB0aGUgcXVldWUsIGJ1dCB0aGUgdmFsdWVzIGFyZSBndWFyYW50ZWVkIHRvIGJlIHJldHVybmVkIGluXG4gICAgICAgICAgLy8gaW5zZXJ0aW9uIG9yZGVyLCBzbyBpdCdzIGFsbCBnb29kLiBUcnVzdCBtZSwgSSd2ZSByZWFkIHRoZSBkb2NzLilcbiAgICAgICAgICBjb25zdCBjYWxsYmFja3MgPSBBcnJheS5mcm9tKG1hcCEudmFsdWVzKCkpO1xuICAgICAgICAgIG1hcCEuY2xlYXIoKTtcbiAgICAgICAgICBmb3IgKGNvbnN0IGNhbGxiYWNrIG9mIGNhbGxiYWNrcykge1xuICAgICAgICAgICAgY2FsbGJhY2sobm93KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIG1lc3NhZ2UuZnJhbWUpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICByZXR1cm4geyBhbmltYXRlLCBkZWxlZ2F0ZSB9O1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVEZWxlZ2F0ZXMoKSB7XG4gICAgLy8gV2hlbiBpbiBydW4gbW9kZSwgdGhlIFRlc3RTY2hlZHVsZXIgcHJvdmlkZXMgYWx0ZXJuYXRlIGltcGxlbWVudGF0aW9uc1xuICAgIC8vIG9mIHNldC9jbGVhckltbWVkaWF0ZSBhbmQgc2V0L2NsZWFySW50ZXJ2YWwuIFRoZXNlIGltcGxlbWVudGF0aW9ucyBhcmVcbiAgICAvLyBjb25zdW1lZCBieSB0aGUgc2NoZWR1bGVyIGltcGxlbWVudGF0aW9ucyB2aWEgdGhlIHByb3ZpZGVycy4gVGhpcyBpc1xuICAgIC8vIGRvbmUgdG8gZWZmZWN0IGRldGVybWluaXN0aWMgYXNhcCBhbmQgYXN5bmMgc2NoZWR1bGVyIGJlaGF2aW9yIHNvIHRoYXRcbiAgICAvLyBhbGwgb2YgdGhlIHNjaGVkdWxlcnMgYXJlIHRlc3RhYmxlIGluICdydW4gbW9kZScuIFByaW9yIHRvIHY3LFxuICAgIC8vIGRlbGVnYXRpb24gb2NjdXJyZWQgYXQgdGhlIHNjaGVkdWxlciBsZXZlbC4gVGhhdCBpcywgdGhlIGFzYXAgYW5kXG4gICAgLy8gYW5pbWF0aW9uIGZyYW1lIHNjaGVkdWxlcnMgd2VyZSBpZGVudGljYWwgaW4gYmVoYXZpb3IgdG8gdGhlIGFzeW5jXG4gICAgLy8gc2NoZWR1bGVyLiBOb3csIHdoZW4gaW4gcnVuIG1vZGUsIGFzYXAgYWN0aW9ucyBhcmUgcHJpb3JpdGl6ZWQgb3ZlclxuICAgIC8vIGFzeW5jIGFjdGlvbnMgYW5kIGFuaW1hdGlvbiBmcmFtZSBhY3Rpb25zIGFyZSBjb29yZGluYXRlZCB1c2luZyB0aGVcbiAgICAvLyBhbmltYXRlIHJ1biBoZWxwZXIuXG5cbiAgICBsZXQgbGFzdEhhbmRsZSA9IDA7XG4gICAgY29uc3Qgc2NoZWR1bGVMb29rdXAgPSBuZXcgTWFwPFxuICAgICAgVGltZXJIYW5kbGUsXG4gICAgICB7XG4gICAgICAgIGR1ZTogbnVtYmVyO1xuICAgICAgICBkdXJhdGlvbjogbnVtYmVyO1xuICAgICAgICBoYW5kbGU6IFRpbWVySGFuZGxlO1xuICAgICAgICBoYW5kbGVyOiAoKSA9PiB2b2lkO1xuICAgICAgICBzdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcbiAgICAgICAgdHlwZTogJ2ltbWVkaWF0ZScgfCAnaW50ZXJ2YWwnIHwgJ3RpbWVvdXQnO1xuICAgICAgfVxuICAgID4oKTtcblxuICAgIGNvbnN0IHJ1biA9ICgpID0+IHtcbiAgICAgIC8vIFdoZW5ldmVyIGEgc2NoZWR1bGVkIHJ1biBpcyBleGVjdXRlZCwgaXQgbXVzdCBydW4gYSBzaW5nbGUgaW1tZWRpYXRlXG4gICAgICAvLyBvciBpbnRlcnZhbCBhY3Rpb24gLSB3aXRoIGltbWVkaWF0ZSBhY3Rpb25zIGJlaW5nIHByaW9yaXRpemVkIG92ZXJcbiAgICAgIC8vIGludGVydmFsIGFuZCB0aW1lb3V0IGFjdGlvbnMuXG4gICAgICBjb25zdCBub3cgPSB0aGlzLm5vdygpO1xuICAgICAgY29uc3Qgc2NoZWR1bGVkUmVjb3JkcyA9IEFycmF5LmZyb20oc2NoZWR1bGVMb29rdXAudmFsdWVzKCkpO1xuICAgICAgY29uc3Qgc2NoZWR1bGVkUmVjb3Jkc0R1ZSA9IHNjaGVkdWxlZFJlY29yZHMuZmlsdGVyKCh7IGR1ZSB9KSA9PiBkdWUgPD0gbm93KTtcbiAgICAgIGNvbnN0IGR1ZUltbWVkaWF0ZXMgPSBzY2hlZHVsZWRSZWNvcmRzRHVlLmZpbHRlcigoeyB0eXBlIH0pID0+IHR5cGUgPT09ICdpbW1lZGlhdGUnKTtcbiAgICAgIGlmIChkdWVJbW1lZGlhdGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3QgeyBoYW5kbGUsIGhhbmRsZXIgfSA9IGR1ZUltbWVkaWF0ZXNbMF07XG4gICAgICAgIHNjaGVkdWxlTG9va3VwLmRlbGV0ZShoYW5kbGUpO1xuICAgICAgICBoYW5kbGVyKCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGR1ZUludGVydmFscyA9IHNjaGVkdWxlZFJlY29yZHNEdWUuZmlsdGVyKCh7IHR5cGUgfSkgPT4gdHlwZSA9PT0gJ2ludGVydmFsJyk7XG4gICAgICBpZiAoZHVlSW50ZXJ2YWxzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3QgZmlyc3REdWVJbnRlcnZhbCA9IGR1ZUludGVydmFsc1swXTtcbiAgICAgICAgY29uc3QgeyBkdXJhdGlvbiwgaGFuZGxlciB9ID0gZmlyc3REdWVJbnRlcnZhbDtcbiAgICAgICAgZmlyc3REdWVJbnRlcnZhbC5kdWUgPSBub3cgKyBkdXJhdGlvbjtcbiAgICAgICAgLy8gVGhlIGludGVydmFsIGRlbGVnYXRlIG11c3QgYmVoYXZlIGxpa2Ugc2V0SW50ZXJ2YWwsIHNvIHJ1biBuZWVkcyB0b1xuICAgICAgICAvLyBiZSByZXNjaGVkdWxlZC4gVGhpcyB3aWxsIGNvbnRpbnVlIHVudGlsIHRoZSBjbGVhckludGVydmFsIGRlbGVnYXRlXG4gICAgICAgIC8vIHVuc3Vic2NyaWJlcyBhbmQgZGVsZXRlcyB0aGUgaGFuZGxlIGZyb20gdGhlIG1hcC5cbiAgICAgICAgZmlyc3REdWVJbnRlcnZhbC5zdWJzY3JpcHRpb24gPSB0aGlzLnNjaGVkdWxlKHJ1biwgZHVyYXRpb24pO1xuICAgICAgICBoYW5kbGVyKCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGR1ZVRpbWVvdXRzID0gc2NoZWR1bGVkUmVjb3Jkc0R1ZS5maWx0ZXIoKHsgdHlwZSB9KSA9PiB0eXBlID09PSAndGltZW91dCcpO1xuICAgICAgaWYgKGR1ZVRpbWVvdXRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3QgeyBoYW5kbGUsIGhhbmRsZXIgfSA9IGR1ZVRpbWVvdXRzWzBdO1xuICAgICAgICBzY2hlZHVsZUxvb2t1cC5kZWxldGUoaGFuZGxlKTtcbiAgICAgICAgaGFuZGxlcigpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0V4cGVjdGVkIGEgZHVlIGltbWVkaWF0ZSBvciBpbnRlcnZhbCcpO1xuICAgIH07XG5cbiAgICAvLyBUaGUgZm9sbG93aW5nIG9iamVjdHMgYXJlIHRoZSBkZWxlZ2F0ZXMgdGhhdCByZXBsYWNlIGNvbnZlbnRpb25hbFxuICAgIC8vIHJ1bnRpbWUgaW1wbGVtZW50YXRpb25zIHdpdGggVGVzdFNjaGVkdWxlciBpbXBsZW1lbnRhdGlvbnMuXG4gICAgLy9cbiAgICAvLyBUaGUgaW1tZWRpYXRlIGRlbGVnYXRlIGlzIGRlcGVuZGVkIHVwb24gYnkgdGhlIGFzYXBTY2hlZHVsZXIuXG4gICAgLy9cbiAgICAvLyBUaGUgaW50ZXJ2YWwgZGVsZWdhdGUgaXMgZGVwZW5kZWQgdXBvbiBieSB0aGUgYXN5bmNTY2hlZHVsZXIuXG4gICAgLy9cbiAgICAvLyBUaGUgdGltZW91dCBkZWxlZ2F0ZSBpcyBub3QgZGVwZW5kZWQgdXBvbiBieSBhbnkgc2NoZWR1bGVyLCBidXQgaXQnc1xuICAgIC8vIGluY2x1ZGVkIGhlcmUgYmVjYXVzZSB0aGUgb25VbmhhbmRsZWRFcnJvciBhbmQgb25TdG9wcGVkTm90aWZpY2F0aW9uXG4gICAgLy8gY29uZmlndXJhdGlvbiBwb2ludHMgdXNlIHNldFRpbWVvdXQgdG8gYXZvaWQgcHJvZHVjZXIgaW50ZXJmZXJlbmNlLiBJdCdzXG4gICAgLy8gaW5jbHVzaW9uIGFsbG93cyBmb3IgdGhlIHRlc3Rpbmcgb2YgdGhlc2UgY29uZmlndXJhdGlvbiBwb2ludHMuXG5cbiAgICBjb25zdCBpbW1lZGlhdGUgPSB7XG4gICAgICBzZXRJbW1lZGlhdGU6IChoYW5kbGVyOiAoKSA9PiB2b2lkKSA9PiB7XG4gICAgICAgIGNvbnN0IGhhbmRsZSA9ICsrbGFzdEhhbmRsZTtcbiAgICAgICAgc2NoZWR1bGVMb29rdXAuc2V0KGhhbmRsZSwge1xuICAgICAgICAgIGR1ZTogdGhpcy5ub3coKSxcbiAgICAgICAgICBkdXJhdGlvbjogMCxcbiAgICAgICAgICBoYW5kbGUsXG4gICAgICAgICAgaGFuZGxlcixcbiAgICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuc2NoZWR1bGUocnVuLCAwKSxcbiAgICAgICAgICB0eXBlOiAnaW1tZWRpYXRlJyxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBoYW5kbGU7XG4gICAgICB9LFxuICAgICAgY2xlYXJJbW1lZGlhdGU6IChoYW5kbGU6IFRpbWVySGFuZGxlKSA9PiB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gc2NoZWR1bGVMb29rdXAuZ2V0KGhhbmRsZSk7XG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgIHZhbHVlLnN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgIHNjaGVkdWxlTG9va3VwLmRlbGV0ZShoYW5kbGUpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgIH07XG5cbiAgICBjb25zdCBpbnRlcnZhbCA9IHtcbiAgICAgIHNldEludGVydmFsOiAoaGFuZGxlcjogKCkgPT4gdm9pZCwgZHVyYXRpb24gPSAwKSA9PiB7XG4gICAgICAgIGNvbnN0IGhhbmRsZSA9ICsrbGFzdEhhbmRsZTtcbiAgICAgICAgc2NoZWR1bGVMb29rdXAuc2V0KGhhbmRsZSwge1xuICAgICAgICAgIGR1ZTogdGhpcy5ub3coKSArIGR1cmF0aW9uLFxuICAgICAgICAgIGR1cmF0aW9uLFxuICAgICAgICAgIGhhbmRsZSxcbiAgICAgICAgICBoYW5kbGVyLFxuICAgICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy5zY2hlZHVsZShydW4sIGR1cmF0aW9uKSxcbiAgICAgICAgICB0eXBlOiAnaW50ZXJ2YWwnLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGhhbmRsZTtcbiAgICAgIH0sXG4gICAgICBjbGVhckludGVydmFsOiAoaGFuZGxlOiBUaW1lckhhbmRsZSkgPT4ge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHNjaGVkdWxlTG9va3VwLmdldChoYW5kbGUpO1xuICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICB2YWx1ZS5zdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICBzY2hlZHVsZUxvb2t1cC5kZWxldGUoaGFuZGxlKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgY29uc3QgdGltZW91dCA9IHtcbiAgICAgIHNldFRpbWVvdXQ6IChoYW5kbGVyOiAoKSA9PiB2b2lkLCBkdXJhdGlvbiA9IDApID0+IHtcbiAgICAgICAgY29uc3QgaGFuZGxlID0gKytsYXN0SGFuZGxlO1xuICAgICAgICBzY2hlZHVsZUxvb2t1cC5zZXQoaGFuZGxlLCB7XG4gICAgICAgICAgZHVlOiB0aGlzLm5vdygpICsgZHVyYXRpb24sXG4gICAgICAgICAgZHVyYXRpb24sXG4gICAgICAgICAgaGFuZGxlLFxuICAgICAgICAgIGhhbmRsZXIsXG4gICAgICAgICAgc3Vic2NyaXB0aW9uOiB0aGlzLnNjaGVkdWxlKHJ1biwgZHVyYXRpb24pLFxuICAgICAgICAgIHR5cGU6ICd0aW1lb3V0JyxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBoYW5kbGU7XG4gICAgICB9LFxuICAgICAgY2xlYXJUaW1lb3V0OiAoaGFuZGxlOiBUaW1lckhhbmRsZSkgPT4ge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHNjaGVkdWxlTG9va3VwLmdldChoYW5kbGUpO1xuICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICB2YWx1ZS5zdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICBzY2hlZHVsZUxvb2t1cC5kZWxldGUoaGFuZGxlKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgcmV0dXJuIHsgaW1tZWRpYXRlLCBpbnRlcnZhbCwgdGltZW91dCB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBgcnVuYCBtZXRob2QgcGVyZm9ybXMgdGhlIHRlc3QgaW4gJ3J1biBtb2RlJyAtIGluIHdoaWNoIHNjaGVkdWxlcnNcbiAgICogdXNlZCB3aXRoaW4gdGhlIHRlc3QgYXV0b21hdGljYWxseSBkZWxlZ2F0ZSB0byB0aGUgYFRlc3RTY2hlZHVsZXJgLiBUaGF0XG4gICAqIGlzLCBpbiAncnVuIG1vZGUnIHRoZXJlIGlzIG5vIG5lZWQgdG8gZXhwbGljaXRseSBwYXNzIGEgYFRlc3RTY2hlZHVsZXJgXG4gICAqIGluc3RhbmNlIHRvIG9ic2VydmFibGUgY3JlYXRvcnMgb3Igb3BlcmF0b3JzLlxuICAgKlxuICAgKiBAc2VlIHtAbGluayAvZ3VpZGUvdGVzdGluZy9tYXJibGUtdGVzdGluZ31cbiAgICovXG4gIHJ1bjxUPihjYWxsYmFjazogKGhlbHBlcnM6IFJ1bkhlbHBlcnMpID0+IFQpOiBUIHtcbiAgICBjb25zdCBwcmV2RnJhbWVUaW1lRmFjdG9yID0gVGVzdFNjaGVkdWxlci5mcmFtZVRpbWVGYWN0b3I7XG4gICAgY29uc3QgcHJldk1heEZyYW1lcyA9IHRoaXMubWF4RnJhbWVzO1xuXG4gICAgVGVzdFNjaGVkdWxlci5mcmFtZVRpbWVGYWN0b3IgPSAxO1xuICAgIHRoaXMubWF4RnJhbWVzID0gSW5maW5pdHk7XG4gICAgdGhpcy5ydW5Nb2RlID0gdHJ1ZTtcblxuICAgIGNvbnN0IGFuaW1hdG9yID0gdGhpcy5jcmVhdGVBbmltYXRvcigpO1xuICAgIGNvbnN0IGRlbGVnYXRlcyA9IHRoaXMuY3JlYXRlRGVsZWdhdGVzKCk7XG5cbiAgICBhbmltYXRpb25GcmFtZVByb3ZpZGVyLmRlbGVnYXRlID0gYW5pbWF0b3IuZGVsZWdhdGU7XG4gICAgZGF0ZVRpbWVzdGFtcFByb3ZpZGVyLmRlbGVnYXRlID0gdGhpcztcbiAgICBpbW1lZGlhdGVQcm92aWRlci5kZWxlZ2F0ZSA9IGRlbGVnYXRlcy5pbW1lZGlhdGU7XG4gICAgaW50ZXJ2YWxQcm92aWRlci5kZWxlZ2F0ZSA9IGRlbGVnYXRlcy5pbnRlcnZhbDtcbiAgICB0aW1lb3V0UHJvdmlkZXIuZGVsZWdhdGUgPSBkZWxlZ2F0ZXMudGltZW91dDtcbiAgICBwZXJmb3JtYW5jZVRpbWVzdGFtcFByb3ZpZGVyLmRlbGVnYXRlID0gdGhpcztcblxuICAgIGNvbnN0IGhlbHBlcnM6IFJ1bkhlbHBlcnMgPSB7XG4gICAgICBjb2xkOiB0aGlzLmNyZWF0ZUNvbGRPYnNlcnZhYmxlLmJpbmQodGhpcyksXG4gICAgICBob3Q6IHRoaXMuY3JlYXRlSG90T2JzZXJ2YWJsZS5iaW5kKHRoaXMpLFxuICAgICAgZmx1c2g6IHRoaXMuZmx1c2guYmluZCh0aGlzKSxcbiAgICAgIHRpbWU6IHRoaXMuY3JlYXRlVGltZS5iaW5kKHRoaXMpLFxuICAgICAgZXhwZWN0T2JzZXJ2YWJsZTogdGhpcy5leHBlY3RPYnNlcnZhYmxlLmJpbmQodGhpcyksXG4gICAgICBleHBlY3RTdWJzY3JpcHRpb25zOiB0aGlzLmV4cGVjdFN1YnNjcmlwdGlvbnMuYmluZCh0aGlzKSxcbiAgICAgIGFuaW1hdGU6IGFuaW1hdG9yLmFuaW1hdGUsXG4gICAgfTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmV0ID0gY2FsbGJhY2soaGVscGVycyk7XG4gICAgICB0aGlzLmZsdXNoKCk7XG4gICAgICByZXR1cm4gcmV0O1xuICAgIH0gZmluYWxseSB7XG4gICAgICBUZXN0U2NoZWR1bGVyLmZyYW1lVGltZUZhY3RvciA9IHByZXZGcmFtZVRpbWVGYWN0b3I7XG4gICAgICB0aGlzLm1heEZyYW1lcyA9IHByZXZNYXhGcmFtZXM7XG4gICAgICB0aGlzLnJ1bk1vZGUgPSBmYWxzZTtcbiAgICAgIGFuaW1hdGlvbkZyYW1lUHJvdmlkZXIuZGVsZWdhdGUgPSB1bmRlZmluZWQ7XG4gICAgICBkYXRlVGltZXN0YW1wUHJvdmlkZXIuZGVsZWdhdGUgPSB1bmRlZmluZWQ7XG4gICAgICBpbW1lZGlhdGVQcm92aWRlci5kZWxlZ2F0ZSA9IHVuZGVmaW5lZDtcbiAgICAgIGludGVydmFsUHJvdmlkZXIuZGVsZWdhdGUgPSB1bmRlZmluZWQ7XG4gICAgICB0aW1lb3V0UHJvdmlkZXIuZGVsZWdhdGUgPSB1bmRlZmluZWQ7XG4gICAgICBwZXJmb3JtYW5jZVRpbWVzdGFtcFByb3ZpZGVyLmRlbGVnYXRlID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxufVxuIl19
