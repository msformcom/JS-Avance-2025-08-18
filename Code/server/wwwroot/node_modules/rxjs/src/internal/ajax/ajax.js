import{map}from"../operators/map";import{Observable}from"../Observable";import{AjaxResponse}from"./AjaxResponse";import{AjaxTimeoutError,AjaxError}from"./errors";function ajaxGet(e,r){return ajax({method:"GET",url:e,headers:r})}function ajaxPost(e,r,t){return ajax({method:"POST",url:e,body:r,headers:t})}function ajaxDelete(e,r){return ajax({method:"DELETE",url:e,headers:r})}function ajaxPut(e,r,t){return ajax({method:"PUT",url:e,body:r,headers:t})}function ajaxPatch(e,r,t){return ajax({method:"PATCH",url:e,body:r,headers:t})}let mapResponse=map(e=>e.response);function ajaxGetJSON(e,r){return mapResponse(ajax({method:"GET",url:e,headers:r}))}let ajax=(()=>{var e=e=>fromAjax("string"==typeof e?{url:e}:e);return e.get=ajaxGet,e.post=ajaxPost,e.delete=ajaxDelete,e.put=ajaxPut,e.patch=ajaxPatch,e.getJSON=ajaxGetJSON,e})(),UPLOAD="upload",DOWNLOAD="download",LOADSTART="loadstart",PROGRESS="progress",LOAD="load";function fromAjax(m){return new Observable(s=>{var e={async:!0,crossDomain:!1,withCredentials:!1,method:"GET",timeout:0,responseType:"json",...m},{queryParams:r,body:t,headers:a}=e;let o=e.url;if(!o)throw new TypeError("url is required");if(r){let t;if(o.includes("?")){var n=o.split("?");if(2<n.length)throw new TypeError("invalid url");t=new URLSearchParams(n[1]),new URLSearchParams(r).forEach((e,r)=>t.set(r,e)),o=n[0]+"?"+t}else t=new URLSearchParams(r),o=o+"?"+t}var i={};if(a)for(var u in a)a.hasOwnProperty(u)&&(i[u.toLowerCase()]=a[u]);var n=e.crossDomain,{withCredentials:r,xsrfCookieName:d,xsrfHeaderName:f}=(n||"x-requested-with"in i||(i["x-requested-with"]="XMLHttpRequest"),e),n=((r||!n)&&d&&f&&(r=document?.cookie.match(new RegExp(`(^|;\\s*)(${d})=([^;]*)`))?.pop()??"")&&(i[f]=r),extractContentTypeAndMaybeSerializeBody(t,i));let p={...e,url:o,headers:i,body:n},c;c=m.createXHR?m.createXHR():new XMLHttpRequest;{let{progressSubscriber:t,includeDownloadProgress:e=!1,includeUploadProgress:r=!1}=m;d=(e,r)=>{c.addEventListener(e,()=>{var e=r();t?.error?.(e),s.error(e)})};d("timeout",()=>new AjaxTimeoutError(c,p)),d("abort",()=>new AjaxError("aborted",c,p));let a=(e,r)=>new AjaxResponse(r,c,p,e+"_"+r.type),o=(e,r,t)=>{e.addEventListener(r,e=>{s.next(a(t,e))})},n=(r&&[LOADSTART,PROGRESS,LOAD].forEach(e=>o(c.upload,e,UPLOAD)),t&&[LOADSTART,PROGRESS].forEach(e=>c.upload.addEventListener(e,e=>t?.next?.(e))),e&&[LOADSTART,PROGRESS].forEach(e=>o(c,e,DOWNLOAD)),e=>{s.error(new AjaxError("ajax error"+(e?" "+e:""),c,p))});c.addEventListener("error",e=>{t?.error?.(e),n()}),c.addEventListener(LOAD,r=>{var e=c.status;if(e<400){t?.complete?.();let e;try{e=a(DOWNLOAD,r)}catch(e){return void s.error(e)}s.next(e),s.complete()}else t?.error?.(r),n(e)})}var l,{user:f,method:r,async:t}=p;for(l in f?c.open(r,o,t,f,p.password):c.open(r,o,t),t&&(c.timeout=p.timeout,c.responseType=p.responseType),"withCredentials"in c&&(c.withCredentials=p.withCredentials),i)i.hasOwnProperty(l)&&c.setRequestHeader(l,i[l]);return n?c.send(n):c.send(),()=>{c&&4!==c.readyState&&c.abort()}})}function extractContentTypeAndMaybeSerializeBody(e,r){if(!e||"string"==typeof e||isFormData(e)||isURLSearchParams(e)||isArrayBuffer(e)||isFile(e)||isBlob(e)||isReadableStream(e))return e;if(isArrayBufferView(e))return e.buffer;if("object"==typeof e)return r["content-type"]=r["content-type"]??"application/json;charset=utf-8",JSON.stringify(e);throw new TypeError("Unknown body type")}let _toString=Object.prototype.toString;function toStringCheck(e,r){return _toString.call(e)===`[object ${r}]`}function isArrayBuffer(e){return toStringCheck(e,"ArrayBuffer")}function isFile(e){return toStringCheck(e,"File")}function isBlob(e){return toStringCheck(e,"Blob")}function isArrayBufferView(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView(e)}function isFormData(e){return"undefined"!=typeof FormData&&e instanceof FormData}function isURLSearchParams(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams}function isReadableStream(e){return"undefined"!=typeof ReadableStream&&e instanceof ReadableStream}export{ajax,fromAjax};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9yeGpzL3NyYy9pbnRlcm5hbC9hamF4L2FqYXgudHMiXSwibmFtZXMiOlsibWFwIiwiT2JzZXJ2YWJsZSIsIkFqYXhSZXNwb25zZSIsIkFqYXhUaW1lb3V0RXJyb3IiLCJBamF4RXJyb3IiLCJhamF4R2V0IiwidXJsIiwiaGVhZGVycyIsImFqYXgiLCJtZXRob2QiLCJhamF4UG9zdCIsImJvZHkiLCJhamF4RGVsZXRlIiwiYWpheFB1dCIsImFqYXhQYXRjaCIsIm1hcFJlc3BvbnNlIiwieCIsInJlc3BvbnNlIiwiYWpheEdldEpTT04iLCJjcmVhdGUiLCJmcm9tQWpheCIsInVybE9yQ29uZmlnIiwiZ2V0IiwicG9zdCIsImRlbGV0ZSIsInB1dCIsInBhdGNoIiwiZ2V0SlNPTiIsIlVQTE9BRCIsIkRPV05MT0FEIiwiTE9BRFNUQVJUIiwiUFJPR1JFU1MiLCJMT0FEIiwiaW5pdCIsImNvbmZpZyIsImFzeW5jIiwiY3Jvc3NEb21haW4iLCJ3aXRoQ3JlZGVudGlhbHMiLCJ0aW1lb3V0IiwicmVzcG9uc2VUeXBlIiwicXVlcnlQYXJhbXMiLCJjb25maWd1cmVkQm9keSIsImNvbmZpZ3VyZWRIZWFkZXJzIiwibGV0IiwiVHlwZUVycm9yIiwic2VhcmNoUGFyYW1zIiwiaW5jbHVkZXMiLCJwYXJ0cyIsInNwbGl0IiwibGVuZ3RoIiwiVVJMU2VhcmNoUGFyYW1zIiwiZm9yRWFjaCIsInZhbHVlIiwia2V5Iiwic2V0IiwiaGFzT3duUHJvcGVydHkiLCJ0b0xvd2VyQ2FzZSIsInhzcmZDb29raWVOYW1lIiwieHNyZkhlYWRlck5hbWUiLCJ4c3JmQ29va2llIiwiZG9jdW1lbnQiLCJjb29raWUiLCJtYXRjaCIsIlJlZ0V4cCIsInBvcCIsImV4dHJhY3RDb250ZW50VHlwZUFuZE1heWJlU2VyaWFsaXplQm9keSIsIl9yZXF1ZXN0IiwieGhyIiwiY3JlYXRlWEhSIiwiWE1MSHR0cFJlcXVlc3QiLCJwcm9ncmVzc1N1YnNjcmliZXIiLCJpbmNsdWRlRG93bmxvYWRQcm9ncmVzcyIsImluY2x1ZGVVcGxvYWRQcm9ncmVzcyIsImFkZEVycm9yRXZlbnQiLCJ0eXBlIiwiZXJyb3JGYWN0b3J5IiwiYWRkRXZlbnRMaXN0ZW5lciIsImVycm9yIiwiZGVzdGluYXRpb24iLCJjcmVhdGVSZXNwb25zZSIsImRpcmVjdGlvbiIsImV2ZW50IiwiYWRkUHJvZ3Jlc3NFdmVudCIsInRhcmdldCIsIm5leHQiLCJlbWl0RXJyb3IiLCJ1cGxvYWQiLCJlIiwic3RhdHVzIiwiY29tcGxldGUiLCJlcnIiLCJ1c2VyIiwib3BlbiIsInBhc3N3b3JkIiwic2V0UmVxdWVzdEhlYWRlciIsInNlbmQiLCJyZWFkeVN0YXRlIiwiYWJvcnQiLCJpc0Zvcm1EYXRhIiwiaXNVUkxTZWFyY2hQYXJhbXMiLCJpc0FycmF5QnVmZmVyIiwiaXNGaWxlIiwiaXNCbG9iIiwiaXNSZWFkYWJsZVN0cmVhbSIsImlzQXJyYXlCdWZmZXJWaWV3IiwiYnVmZmVyIiwiSlNPTiIsInN0cmluZ2lmeSIsIl90b1N0cmluZyIsIk9iamVjdCIsInByb3RvdHlwZSIsInRvU3RyaW5nIiwidG9TdHJpbmdDaGVjayIsIm9iaiIsIm5hbWUiLCJjYWxsIiwiQXJyYXlCdWZmZXIiLCJpc1ZpZXciLCJGb3JtRGF0YSIsIlJlYWRhYmxlU3RyZWFtIl0sIm1hcHBpbmdzIjoiT0FBU0EsR0FBNkIsS0FBbEIsMEJBQ1hDLFVBQWlDLEtBQWYsdUJBRWxCQyxZQUFvQyxLQUFoQix3QkFDcEJDLGlCQUFrQkMsU0FBMkIsS0FBVixXQXFJNUMsU0FBU0MsUUFBV0MsRUFBYUMsR0FDL0IsT0FBT0MsS0FBSyxDQUFFQyxPQUFRLE1BQU9ILElBQUFBLEVBQUtDLFFBQUFBLENBQU8sQ0FBRSxDQUM3QyxDQUVBLFNBQVNHLFNBQVlKLEVBQWFLLEVBQVlKLEdBQzVDLE9BQU9DLEtBQUssQ0FBRUMsT0FBUSxPQUFRSCxJQUFBQSxFQUFLSyxLQUFBQSxFQUFNSixRQUFBQSxDQUFPLENBQUUsQ0FDcEQsQ0FFQSxTQUFTSyxXQUFjTixFQUFh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aUJBQW1DdkMsYUFBZ0J1QyxlQUNuRSxDQUVBLFNBQVNxRCxpQkFBaUI1RixHQUN4QixNQUFpQyxhQUExQixPQUFPNEcsZ0JBQWtDNUcsYUFBZ0I0RyxjQUNsRSxRQWxXYS9HLEtBMkJHWSxRQXVVaEIiLCJmaWxlIjoibm9kZV9tb2R1bGVzL3J4anMvc3JjL2ludGVybmFsL2FqYXgvYWpheC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IG1hcCB9IGZyb20gJy4uL29wZXJhdG9ycy9tYXAnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJy4uL09ic2VydmFibGUnO1xuaW1wb3J0IHsgQWpheENvbmZpZywgQWpheFJlcXVlc3QsIEFqYXhEaXJlY3Rpb24sIFByb2dyZXNzRXZlbnRUeXBlIH0gZnJvbSAnLi90eXBlcyc7XG5pbXBvcnQgeyBBamF4UmVzcG9uc2UgfSBmcm9tICcuL0FqYXhSZXNwb25zZSc7XG5pbXBvcnQgeyBBamF4VGltZW91dEVycm9yLCBBamF4RXJyb3IgfSBmcm9tICcuL2Vycm9ycyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWpheENyZWF0aW9uTWV0aG9kIHtcbiAgLyoqXG4gICAqIENyZWF0ZXMgYW4gb2JzZXJ2YWJsZSB0aGF0IHdpbGwgcGVyZm9ybSBhbiBBSkFYIHJlcXVlc3QgdXNpbmcgdGhlXG4gICAqIFtYTUxIdHRwUmVxdWVzdF0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1hNTEh0dHBSZXF1ZXN0KSBpblxuICAgKiBnbG9iYWwgc2NvcGUgYnkgZGVmYXVsdC5cbiAgICpcbiAgICogVGhpcyBpcyB0aGUgbW9zdCBjb25maWd1cmFibGUgb3B0aW9uLCBhbmQgdGhlIGJhc2lzIGZvciBhbGwgb3RoZXIgQUpBWCBjYWxscyBpbiB0aGUgbGlicmFyeS5cbiAgICpcbiAgICogIyMgRXhhbXBsZVxuICAgKlxuICAgKiBgYGB0c1xuICAgKiBpbXBvcnQgeyBhamF4IH0gZnJvbSAncnhqcy9hamF4JztcbiAgICogaW1wb3J0IHsgbWFwLCBjYXRjaEVycm9yLCBvZiB9IGZyb20gJ3J4anMnO1xuICAgKlxuICAgKiBjb25zdCBvYnMkID0gYWpheCh7XG4gICAqICAgbWV0aG9kOiAnR0VUJyxcbiAgICogICB1cmw6ICdodHRwczovL2FwaS5naXRodWIuY29tL3VzZXJzP3Blcl9wYWdlPTUnLFxuICAgKiAgIHJlc3BvbnNlVHlwZTogJ2pzb24nXG4gICAqIH0pLnBpcGUoXG4gICAqICAgbWFwKHVzZXJSZXNwb25zZSA9PiBjb25zb2xlLmxvZygndXNlcnM6ICcsIHVzZXJSZXNwb25zZSkpLFxuICAgKiAgIGNhdGNoRXJyb3IoZXJyb3IgPT4ge1xuICAgKiAgICAgY29uc29sZS5sb2coJ2Vycm9yOiAnLCBlcnJvcik7XG4gICAqICAgICByZXR1cm4gb2YoZXJyb3IpO1xuICAgKiAgIH0pXG4gICAqICk7XG4gICAqIGBgYFxuICAgKi9cbiAgPFQ+KGNvbmZpZzogQWpheENvbmZpZyk6IE9ic2VydmFibGU8QWpheFJlc3BvbnNlPFQ+PjtcblxuICAvKipcbiAgICogUGVyZm9ybSBhbiBIVFRQIEdFVCB1c2luZyB0aGVcbiAgICogW1hNTEh0dHBSZXF1ZXN0XShodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvWE1MSHR0cFJlcXVlc3QpIGluXG4gICAqIGdsb2JhbCBzY29wZS4gRGVmYXVsdHMgdG8gYSBgcmVzcG9uc2VUeXBlYCBvZiBgXCJqc29uXCJgLlxuICAgKlxuICAgKiAjIyBFeGFtcGxlXG4gICAqXG4gICAqIGBgYHRzXG4gICAqIGltcG9ydCB7IGFqYXggfSBmcm9tICdyeGpzL2FqYXgnO1xuICAgKiBpbXBvcnQgeyBtYXAsIGNhdGNoRXJyb3IsIG9mIH0gZnJvbSAncnhqcyc7XG4gICAqXG4gICAqIGNvbnN0IG9icyQgPSBhamF4KCdodHRwczovL2FwaS5naXRodWIuY29tL3VzZXJzP3Blcl9wYWdlPTUnKS5waXBlKFxuICAgKiAgIG1hcCh1c2VyUmVzcG9uc2UgPT4gY29uc29sZS5sb2coJ3VzZXJzOiAnLCB1c2VyUmVzcG9uc2UpKSxcbiAgICogICBjYXRjaEVycm9yKGVycm9yID0+IHtcbiAgICogICAgIGNvbnNvbGUubG9nKCdlcnJvcjogJywgZXJyb3IpO1xuICAgKiAgICAgcmV0dXJuIG9mKGVycm9yKTtcbiAgICogICB9KVxuICAgKiApO1xuICAgKiBgYGBcbiAgICovXG4gIDxUPih1cmw6IHN0cmluZyk6IE9ic2VydmFibGU8QWpheFJlc3BvbnNlPFQ+PjtcblxuICAvKipcbiAgICogUGVyZm9ybXMgYW4gSFRUUCBHRVQgdXNpbmcgdGhlXG4gICAqIFtYTUxIdHRwUmVxdWVzdF0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1hNTEh0dHBSZXF1ZXN0KSBpblxuICAgKiBnbG9iYWwgc2NvcGUgYnkgZGVmYXVsdCwgYW5kIGEgYHJlc3BvbnNlVHlwZWAgb2YgYFwianNvblwiYC5cbiAgICpcbiAgICogQHBhcmFtIHVybCBUaGUgVVJMIHRvIGdldCB0aGUgcmVzb3VyY2UgZnJvbVxuICAgKiBAcGFyYW0gaGVhZGVycyBPcHRpb25hbCBoZWFkZXJzLiBDYXNlLUluc2Vuc2l0aXZlLlxuICAgKi9cbiAgZ2V0PFQ+KHVybDogc3RyaW5nLCBoZWFkZXJzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPik6IE9ic2VydmFibGU8QWpheFJlc3BvbnNlPFQ+PjtcblxuICAvKipcbiAgICogUGVyZm9ybXMgYW4gSFRUUCBQT1NUIHVzaW5nIHRoZVxuICAgKiBbWE1MSHR0cFJlcXVlc3RdKGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9YTUxIdHRwUmVxdWVzdCkgaW5cbiAgICogZ2xvYmFsIHNjb3BlIGJ5IGRlZmF1bHQsIGFuZCBhIGByZXNwb25zZVR5cGVgIG9mIGBcImpzb25cImAuXG4gICAqXG4gICAqIEJlZm9yZSBzZW5kaW5nIHRoZSB2YWx1ZSBwYXNzZWQgdG8gdGhlIGBib2R5YCBhcmd1bWVudCwgaXQgaXMgYXV0b21hdGljYWxseSBzZXJpYWxpemVkXG4gICAqIGJhc2VkIG9uIHRoZSBzcGVjaWZpZWQgYHJlc3BvbnNlVHlwZWAuIEJ5IGRlZmF1bHQsIGEgSmF2YVNjcmlwdCBvYmplY3Qgd2lsbCBiZSBzZXJpYWxpemVkXG4gICAqIHRvIEpTT04uIEEgYHJlc3BvbnNlVHlwZWAgb2YgYGFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZGAgd2lsbCBmbGF0dGVuIGFueSBwcm92aWRlZFxuICAgKiBkaWN0aW9uYXJ5IG9iamVjdCB0byBhIHVybC1lbmNvZGVkIHN0cmluZy5cbiAgICpcbiAgICogQHBhcmFtIHVybCBUaGUgVVJMIHRvIGdldCB0aGUgcmVzb3VyY2UgZnJvbVxuICAgKiBAcGFyYW0gYm9keSBUaGUgY29udGVudCB0byBzZW5kLiBUaGUgYm9keSBpcyBhdXRvbWF0aWNhbGx5IHNlcmlhbGl6ZWQuXG4gICAqIEBwYXJhbSBoZWFkZXJzIE9wdGlvbmFsIGhlYWRlcnMuIENhc2UtSW5zZW5zaXRpdmUuXG4gICAqL1xuICBwb3N0PFQ+KHVybDogc3RyaW5nLCBib2R5PzogYW55LCBoZWFkZXJzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPik6IE9ic2VydmFibGU8QWpheFJlc3BvbnNlPFQ+PjtcblxuICAvKipcbiAgICogUGVyZm9ybXMgYW4gSFRUUCBQVVQgdXNpbmcgdGhlXG4gICAqIFtYTUxIdHRwUmVxdWVzdF0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1hNTEh0dHBSZXF1ZXN0KSBpblxuICAgKiBnbG9iYWwgc2NvcGUgYnkgZGVmYXVsdCwgYW5kIGEgYHJlc3BvbnNlVHlwZWAgb2YgYFwianNvblwiYC5cbiAgICpcbiAgICogQmVmb3JlIHNlbmRpbmcgdGhlIHZhbHVlIHBhc3NlZCB0byB0aGUgYGJvZHlgIGFyZ3VtZW50LCBpdCBpcyBhdXRvbWF0aWNhbGx5IHNlcmlhbGl6ZWRcbiAgICogYmFzZWQgb24gdGhlIHNwZWNpZmllZCBgcmVzcG9uc2VUeXBlYC4gQnkgZGVmYXVsdCwgYSBKYXZhU2NyaXB0IG9iamVjdCB3aWxsIGJlIHNlcmlhbGl6ZWRcbiAgICogdG8gSlNPTi4gQSBgcmVzcG9uc2VUeXBlYCBvZiBgYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkYCB3aWxsIGZsYXR0ZW4gYW55IHByb3ZpZGVkXG4gICAqIGRpY3Rpb25hcnkgb2JqZWN0IHRvIGEgdXJsLWVuY29kZWQgc3RyaW5nLlxuICAgKlxuICAgKiBAcGFyYW0gdXJsIFRoZSBVUkwgdG8gZ2V0IHRoZSByZXNvdXJjZSBmcm9tXG4gICAqIEBwYXJhbSBib2R5IFRoZSBjb250ZW50IHRvIHNlbmQuIFRoZSBib2R5IGlzIGF1dG9tYXRpY2FsbHkgc2VyaWFsaXplZC5cbiAgICogQHBhcmFtIGhlYWRlcnMgT3B0aW9uYWwgaGVhZGVycy4gQ2FzZS1JbnNlbnNpdGl2ZS5cbiAgICovXG4gIHB1dDxUPih1cmw6IHN0cmluZywgYm9keT86IGFueSwgaGVhZGVycz86IFJlY29yZDxzdHJpbmcsIHN0cmluZz4pOiBPYnNlcnZhYmxlPEFqYXhSZXNwb25zZTxUPj47XG5cbiAgLyoqXG4gICAqIFBlcmZvcm1zIGFuIEhUVFAgUEFUQ0ggdXNpbmcgdGhlXG4gICAqIFtYTUxIdHRwUmVxdWVzdF0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1hNTEh0dHBSZXF1ZXN0KSBpblxuICAgKiBnbG9iYWwgc2NvcGUgYnkgZGVmYXVsdCwgYW5kIGEgYHJlc3BvbnNlVHlwZWAgb2YgYFwianNvblwiYC5cbiAgICpcbiAgICogQmVmb3JlIHNlbmRpbmcgdGhlIHZhbHVlIHBhc3NlZCB0byB0aGUgYGJvZHlgIGFyZ3VtZW50LCBpdCBpcyBhdXRvbWF0aWNhbGx5IHNlcmlhbGl6ZWRcbiAgICogYmFzZWQgb24gdGhlIHNwZWNpZmllZCBgcmVzcG9uc2VUeXBlYC4gQnkgZGVmYXVsdCwgYSBKYXZhU2NyaXB0IG9iamVjdCB3aWxsIGJlIHNlcmlhbGl6ZWRcbiAgICogdG8gSlNPTi4gQSBgcmVzcG9uc2VUeXBlYCBvZiBgYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkYCB3aWxsIGZsYXR0ZW4gYW55IHByb3ZpZGVkXG4gICAqIGRpY3Rpb25hcnkgb2JqZWN0IHRvIGEgdXJsLWVuY29kZWQgc3RyaW5nLlxuICAgKlxuICAgKiBAcGFyYW0gdXJsIFRoZSBVUkwgdG8gZ2V0IHRoZSByZXNvdXJjZSBmcm9tXG4gICAqIEBwYXJhbSBib2R5IFRoZSBjb250ZW50IHRvIHNlbmQuIFRoZSBib2R5IGlzIGF1dG9tYXRpY2FsbHkgc2VyaWFsaXplZC5cbiAgICogQHBhcmFtIGhlYWRlcnMgT3B0aW9uYWwgaGVhZGVycy4gQ2FzZS1JbnNlbnNpdGl2ZS5cbiAgICovXG4gIHBhdGNoPFQ+KHVybDogc3RyaW5nLCBib2R5PzogYW55LCBoZWFkZXJzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPik6IE9ic2VydmFibGU8QWpheFJlc3BvbnNlPFQ+PjtcblxuICAvKipcbiAgICogUGVyZm9ybXMgYW4gSFRUUCBERUxFVEUgdXNpbmcgdGhlXG4gICAqIFtYTUxIdHRwUmVxdWVzdF0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1hNTEh0dHBSZXF1ZXN0KSBpblxuICAgKiBnbG9iYWwgc2NvcGUgYnkgZGVmYXVsdCwgYW5kIGEgYHJlc3BvbnNlVHlwZWAgb2YgYFwianNvblwiYC5cbiAgICpcbiAgICogQHBhcmFtIHVybCBUaGUgVVJMIHRvIGdldCB0aGUgcmVzb3VyY2UgZnJvbVxuICAgKiBAcGFyYW0gaGVhZGVycyBPcHRpb25hbCBoZWFkZXJzLiBDYXNlLUluc2Vuc2l0aXZlLlxuICAgKi9cbiAgZGVsZXRlPFQ+KHVybDogc3RyaW5nLCBoZWFkZXJzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPik6IE9ic2VydmFibGU8QWpheFJlc3BvbnNlPFQ+PjtcblxuICAvKipcbiAgICogUGVyZm9ybXMgYW4gSFRUUCBHRVQgdXNpbmcgdGhlXG4gICAqIFtYTUxIdHRwUmVxdWVzdF0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1hNTEh0dHBSZXF1ZXN0KSBpblxuICAgKiBnbG9iYWwgc2NvcGUgYnkgZGVmYXVsdCwgYW5kIHJldHVybnMgdGhlIGh5ZHJhdGVkIEphdmFTY3JpcHQgb2JqZWN0IGZyb20gdGhlXG4gICAqIHJlc3BvbnNlLlxuICAgKlxuICAgKiBAcGFyYW0gdXJsIFRoZSBVUkwgdG8gZ2V0IHRoZSByZXNvdXJjZSBmcm9tXG4gICAqIEBwYXJhbSBoZWFkZXJzIE9wdGlvbmFsIGhlYWRlcnMuIENhc2UtSW5zZW5zaXRpdmUuXG4gICAqL1xuICBnZXRKU09OPFQ+KHVybDogc3RyaW5nLCBoZWFkZXJzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPik6IE9ic2VydmFibGU8VD47XG59XG5cbmZ1bmN0aW9uIGFqYXhHZXQ8VD4odXJsOiBzdHJpbmcsIGhlYWRlcnM/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+KTogT2JzZXJ2YWJsZTxBamF4UmVzcG9uc2U8VD4+IHtcbiAgcmV0dXJuIGFqYXgoeyBtZXRob2Q6ICdHRVQnLCB1cmwsIGhlYWRlcnMgfSk7XG59XG5cbmZ1bmN0aW9uIGFqYXhQb3N0PFQ+KHVybDogc3RyaW5nLCBib2R5PzogYW55LCBoZWFkZXJzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPik6IE9ic2VydmFibGU8QWpheFJlc3BvbnNlPFQ+PiB7XG4gIHJldHVybiBhamF4KHsgbWV0aG9kOiAnUE9TVCcsIHVybCwgYm9keSwgaGVhZGVycyB9KTtcbn1cblxuZnVuY3Rpb24gYWpheERlbGV0ZTxUPih1cmw6IHN0cmluZywgaGVhZGVycz86IFJlY29yZDxzdHJpbmcsIHN0cmluZz4pOiBPYnNlcnZhYmxlPEFqYXhSZXNwb25zZTxUPj4ge1xuICByZXR1cm4gYWpheCh7IG1ldGhvZDogJ0RFTEVURScsIHVybCwgaGVhZGVycyB9KTtcbn1cblxuZnVuY3Rpb24gYWpheFB1dDxUPih1cmw6IHN0cmluZywgYm9keT86IGFueSwgaGVhZGVycz86IFJlY29yZDxzdHJpbmcsIHN0cmluZz4pOiBPYnNlcnZhYmxlPEFqYXhSZXNwb25zZTxUPj4ge1xuICByZXR1cm4gYWpheCh7IG1ldGhvZDogJ1BVVCcsIHVybCwgYm9keSwgaGVhZGVycyB9KTtcbn1cblxuZnVuY3Rpb24gYWpheFBhdGNoPFQ+KHVybDogc3RyaW5nLCBib2R5PzogYW55LCBoZWFkZXJzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPik6IE9ic2VydmFibGU8QWpheFJlc3BvbnNlPFQ+PiB7XG4gIHJldHVybiBhamF4KHsgbWV0aG9kOiAnUEFUQ0gnLCB1cmwsIGJvZHksIGhlYWRlcnMgfSk7XG59XG5cbmNvbnN0IG1hcFJlc3BvbnNlID0gbWFwKCh4OiBBamF4UmVzcG9uc2U8YW55PikgPT4geC5yZXNwb25zZSk7XG5cbmZ1bmN0aW9uIGFqYXhHZXRKU09OPFQ+KHVybDogc3RyaW5nLCBoZWFkZXJzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPik6IE9ic2VydmFibGU8VD4ge1xuICByZXR1cm4gbWFwUmVzcG9uc2UoXG4gICAgYWpheDxUPih7XG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgdXJsLFxuICAgICAgaGVhZGVycyxcbiAgICB9KVxuICApO1xufVxuXG4vKipcbiAqIFRoZXJlIGlzIGFuIGFqYXggb3BlcmF0b3Igb24gdGhlIFJ4IG9iamVjdC5cbiAqXG4gKiBJdCBjcmVhdGVzIGFuIG9ic2VydmFibGUgZm9yIGFuIEFqYXggcmVxdWVzdCB3aXRoIGVpdGhlciBhIHJlcXVlc3Qgb2JqZWN0IHdpdGhcbiAqIHVybCwgaGVhZGVycywgZXRjIG9yIGEgc3RyaW5nIGZvciBhIFVSTC5cbiAqXG4gKiAjIyBFeGFtcGxlc1xuICpcbiAqIFVzaW5nIGBhamF4KClgIHRvIGZldGNoIHRoZSByZXNwb25zZSBvYmplY3QgdGhhdCBpcyBiZWluZyByZXR1cm5lZCBmcm9tIEFQSVxuICpcbiAqIGBgYHRzXG4gKiBpbXBvcnQgeyBhamF4IH0gZnJvbSAncnhqcy9hamF4JztcbiAqIGltcG9ydCB7IG1hcCwgY2F0Y2hFcnJvciwgb2YgfSBmcm9tICdyeGpzJztcbiAqXG4gKiBjb25zdCBvYnMkID0gYWpheCgnaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycz9wZXJfcGFnZT01JykucGlwZShcbiAqICAgbWFwKHVzZXJSZXNwb25zZSA9PiBjb25zb2xlLmxvZygndXNlcnM6ICcsIHVzZXJSZXNwb25zZSkpLFxuICogICBjYXRjaEVycm9yKGVycm9yID0+IHtcbiAqICAgICBjb25zb2xlLmxvZygnZXJyb3I6ICcsIGVycm9yKTtcbiAqICAgICByZXR1cm4gb2YoZXJyb3IpO1xuICogICB9KVxuICogKTtcbiAqXG4gKiBvYnMkLnN1YnNjcmliZSh7XG4gKiAgIG5leHQ6IHZhbHVlID0+IGNvbnNvbGUubG9nKHZhbHVlKSxcbiAqICAgZXJyb3I6IGVyciA9PiBjb25zb2xlLmxvZyhlcnIpXG4gKiB9KTtcbiAqIGBgYFxuICpcbiAqIFVzaW5nIGBhamF4LmdldEpTT04oKWAgdG8gZmV0Y2ggZGF0YSBmcm9tIEFQSVxuICpcbiAqIGBgYHRzXG4gKiBpbXBvcnQgeyBhamF4IH0gZnJvbSAncnhqcy9hamF4JztcbiAqIGltcG9ydCB7IG1hcCwgY2F0Y2hFcnJvciwgb2YgfSBmcm9tICdyeGpzJztcbiAqXG4gKiBjb25zdCBvYnMkID0gYWpheC5nZXRKU09OKCdodHRwczovL2FwaS5naXRodWIuY29tL3VzZXJzP3Blcl9wYWdlPTUnKS5waXBlKFxuICogICBtYXAodXNlclJlc3BvbnNlID0+IGNvbnNvbGUubG9nKCd1c2VyczogJywgdXNlclJlc3BvbnNlKSksXG4gKiAgIGNhdGNoRXJyb3IoZXJyb3IgPT4ge1xuICogICAgIGNvbnNvbGUubG9nKCdlcnJvcjogJywgZXJyb3IpO1xuICogICAgIHJldHVybiBvZihlcnJvcik7XG4gKiAgIH0pXG4gKiApO1xuICpcbiAqIG9icyQuc3Vic2NyaWJlKHtcbiAqICAgbmV4dDogdmFsdWUgPT4gY29uc29sZS5sb2codmFsdWUpLFxuICogICBlcnJvcjogZXJyID0+IGNvbnNvbGUubG9nKGVycilcbiAqIH0pO1xuICogYGBgXG4gKlxuICogVXNpbmcgYGFqYXgoKWAgd2l0aCBvYmplY3QgYXMgYXJndW1lbnQgYW5kIG1ldGhvZCBQT1NUIHdpdGggYSB0d28gc2Vjb25kcyBkZWxheVxuICpcbiAqIGBgYHRzXG4gKiBpbXBvcnQgeyBhamF4IH0gZnJvbSAncnhqcy9hamF4JztcbiAqIGltcG9ydCB7IG1hcCwgY2F0Y2hFcnJvciwgb2YgfSBmcm9tICdyeGpzJztcbiAqXG4gKiBjb25zdCB1c2VycyA9IGFqYXgoe1xuICogICB1cmw6ICdodHRwczovL2h0dHBiaW4ub3JnL2RlbGF5LzInLFxuICogICBtZXRob2Q6ICdQT1NUJyxcbiAqICAgaGVhZGVyczoge1xuICogICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gKiAgICAgJ3J4anMtY3VzdG9tLWhlYWRlcic6ICdSeGpzJ1xuICogICB9LFxuICogICBib2R5OiB7XG4gKiAgICAgcnhqczogJ0hlbGxvIFdvcmxkISdcbiAqICAgfVxuICogfSkucGlwZShcbiAqICAgbWFwKHJlc3BvbnNlID0+IGNvbnNvbGUubG9nKCdyZXNwb25zZTogJywgcmVzcG9uc2UpKSxcbiAqICAgY2F0Y2hFcnJvcihlcnJvciA9PiB7XG4gKiAgICAgY29uc29sZS5sb2coJ2Vycm9yOiAnLCBlcnJvcik7XG4gKiAgICAgcmV0dXJuIG9mKGVycm9yKTtcbiAqICAgfSlcbiAqICk7XG4gKlxuICogdXNlcnMuc3Vic2NyaWJlKHtcbiAqICAgbmV4dDogdmFsdWUgPT4gY29uc29sZS5sb2codmFsdWUpLFxuICogICBlcnJvcjogZXJyID0+IGNvbnNvbGUubG9nKGVycilcbiAqIH0pO1xuICogYGBgXG4gKlxuICogVXNpbmcgYGFqYXgoKWAgdG8gZmV0Y2guIEFuIGVycm9yIG9iamVjdCB0aGF0IGlzIGJlaW5nIHJldHVybmVkIGZyb20gdGhlIHJlcXVlc3RcbiAqXG4gKiBgYGB0c1xuICogaW1wb3J0IHsgYWpheCB9IGZyb20gJ3J4anMvYWpheCc7XG4gKiBpbXBvcnQgeyBtYXAsIGNhdGNoRXJyb3IsIG9mIH0gZnJvbSAncnhqcyc7XG4gKlxuICogY29uc3Qgb2JzJCA9IGFqYXgoJ2h0dHBzOi8vYXBpLmdpdGh1Yi5jb20vNDA0JykucGlwZShcbiAqICAgbWFwKHVzZXJSZXNwb25zZSA9PiBjb25zb2xlLmxvZygndXNlcnM6ICcsIHVzZXJSZXNwb25zZSkpLFxuICogICBjYXRjaEVycm9yKGVycm9yID0+IHtcbiAqICAgICBjb25zb2xlLmxvZygnZXJyb3I6ICcsIGVycm9yKTtcbiAqICAgICByZXR1cm4gb2YoZXJyb3IpO1xuICogICB9KVxuICogKTtcbiAqXG4gKiBvYnMkLnN1YnNjcmliZSh7XG4gKiAgIG5leHQ6IHZhbHVlID0+IGNvbnNvbGUubG9nKHZhbHVlKSxcbiAqICAgZXJyb3I6IGVyciA9PiBjb25zb2xlLmxvZyhlcnIpXG4gKiB9KTtcbiAqIGBgYFxuICovXG5leHBvcnQgY29uc3QgYWpheDogQWpheENyZWF0aW9uTWV0aG9kID0gKCgpID0+IHtcbiAgY29uc3QgY3JlYXRlID0gPFQ+KHVybE9yQ29uZmlnOiBzdHJpbmcgfCBBamF4Q29uZmlnKSA9PiB7XG4gICAgY29uc3QgY29uZmlnOiBBamF4Q29uZmlnID1cbiAgICAgIHR5cGVvZiB1cmxPckNvbmZpZyA9PT0gJ3N0cmluZydcbiAgICAgICAgPyB7XG4gICAgICAgICAgICB1cmw6IHVybE9yQ29uZmlnLFxuICAgICAgICAgIH1cbiAgICAgICAgOiB1cmxPckNvbmZpZztcbiAgICByZXR1cm4gZnJvbUFqYXg8VD4oY29uZmlnKTtcbiAgfTtcblxuICBjcmVhdGUuZ2V0ID0gYWpheEdldDtcbiAgY3JlYXRlLnBvc3QgPSBhamF4UG9zdDtcbiAgY3JlYXRlLmRlbGV0ZSA9IGFqYXhEZWxldGU7XG4gIGNyZWF0ZS5wdXQgPSBhamF4UHV0O1xuICBjcmVhdGUucGF0Y2ggPSBhamF4UGF0Y2g7XG4gIGNyZWF0ZS5nZXRKU09OID0gYWpheEdldEpTT047XG5cbiAgcmV0dXJuIGNyZWF0ZTtcbn0pKCk7XG5cbmNvbnN0IFVQTE9BRCA9ICd1cGxvYWQnO1xuY29uc3QgRE9XTkxPQUQgPSAnZG93bmxvYWQnO1xuY29uc3QgTE9BRFNUQVJUID0gJ2xvYWRzdGFydCc7XG5jb25zdCBQUk9HUkVTUyA9ICdwcm9ncmVzcyc7XG5jb25zdCBMT0FEID0gJ2xvYWQnO1xuXG5leHBvcnQgZnVuY3Rpb24gZnJvbUFqYXg8VD4oaW5pdDogQWpheENvbmZpZyk6IE9ic2VydmFibGU8QWpheFJlc3BvbnNlPFQ+PiB7XG4gIHJldHVybiBuZXcgT2JzZXJ2YWJsZSgoZGVzdGluYXRpb24pID0+IHtcbiAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAvLyBEZWZhdWx0c1xuICAgICAgYXN5bmM6IHRydWUsXG4gICAgICBjcm9zc0RvbWFpbjogZmFsc2UsXG4gICAgICB3aXRoQ3JlZGVudGlhbHM6IGZhbHNlLFxuICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgIHRpbWVvdXQ6IDAsXG4gICAgICByZXNwb25zZVR5cGU6ICdqc29uJyBhcyBYTUxIdHRwUmVxdWVzdFJlc3BvbnNlVHlwZSxcblxuICAgICAgLi4uaW5pdCxcbiAgICB9O1xuXG4gICAgY29uc3QgeyBxdWVyeVBhcmFtcywgYm9keTogY29uZmlndXJlZEJvZHksIGhlYWRlcnM6IGNvbmZpZ3VyZWRIZWFkZXJzIH0gPSBjb25maWc7XG5cbiAgICBsZXQgdXJsID0gY29uZmlnLnVybDtcbiAgICBpZiAoIXVybCkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigndXJsIGlzIHJlcXVpcmVkJyk7XG4gICAgfVxuXG4gICAgaWYgKHF1ZXJ5UGFyYW1zKSB7XG4gICAgICBsZXQgc2VhcmNoUGFyYW1zOiBVUkxTZWFyY2hQYXJhbXM7XG4gICAgICBpZiAodXJsLmluY2x1ZGVzKCc/JykpIHtcbiAgICAgICAgLy8gSWYgdGhlIHVzZXIgaGFzIHBhc3NlZCBhIFVSTCB3aXRoIGEgcXVlcnlzdHJpbmcgYWxyZWFkeSBpbiBpdCxcbiAgICAgICAgLy8gd2UgbmVlZCB0byBjb21iaW5lIHRoZW0uIFNvIHdlJ3JlIGdvaW5nIHRvIHNwbGl0IGl0LiBUaGVyZVxuICAgICAgICAvLyBzaG91bGQgb25seSBiZSBvbmUgYD9gIGluIGEgdmFsaWQgVVJMLlxuICAgICAgICBjb25zdCBwYXJ0cyA9IHVybC5zcGxpdCgnPycpO1xuICAgICAgICBpZiAoMiA8IHBhcnRzLmxlbmd0aCkge1xuICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ2ludmFsaWQgdXJsJyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQWRkIHRoZSBwYXNzZWQgcXVlcnlQYXJhbXMgdG8gdGhlIHBhcmFtcyBhbHJlYWR5IGluIHRoZSB1cmwgcHJvdmlkZWQuXG4gICAgICAgIHNlYXJjaFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMocGFydHNbMV0pO1xuICAgICAgICAvLyBxdWVyeVBhcmFtcyBpcyBjb252ZXJ0ZWQgdG8gYW55IGJlY2F1c2UgdGhlIHJ1bnRpbWUgaXMgKm11Y2gqIG1vcmUgcGVybWlzc2l2ZSB0aGFuXG4gICAgICAgIC8vIHRoZSB0eXBlcyBhcmUuXG4gICAgICAgIG5ldyBVUkxTZWFyY2hQYXJhbXMocXVlcnlQYXJhbXMgYXMgYW55KS5mb3JFYWNoKCh2YWx1ZSwga2V5KSA9PiBzZWFyY2hQYXJhbXMuc2V0KGtleSwgdmFsdWUpKTtcbiAgICAgICAgLy8gV2UgaGF2ZSB0byBkbyBzdHJpbmcgY29uY2F0ZW5hdGlvbiBoZXJlLCBiZWNhdXNlIGBuZXcgVVJMKHVybClgIGRvZXNcbiAgICAgICAgLy8gbm90IGxpa2UgcmVsYXRpdmUgVVJMcyBsaWtlIGAvdGhpc2Agd2l0aG91dCBhIGJhc2UgdXJsLCB3aGljaCB3ZSBjYW4ndFxuICAgICAgICAvLyBzcGVjaWZ5LCBub3IgY2FuIHdlIGFzc3VtZSBgbG9jYXRpb25gIHdpbGwgZXhpc3QsIGJlY2F1c2Ugb2Ygbm9kZS5cbiAgICAgICAgdXJsID0gcGFydHNbMF0gKyAnPycgKyBzZWFyY2hQYXJhbXM7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBUaGVyZSBpcyBubyBwcmVleGlzdGluZyBxdWVyeXN0cmluZywgc28gd2UgY2FuIGp1c3QgdXNlIFVSTFNlYXJjaFBhcmFtc1xuICAgICAgICAvLyB0byBjb252ZXJ0IHRoZSBwYXNzZWQgcXVlcnlQYXJhbXMgaW50byB0aGUgcHJvcGVyIGZvcm1hdCBhbmQgZW5jb2RpbmdzLlxuICAgICAgICAvLyBxdWVyeVBhcmFtcyBpcyBjb252ZXJ0ZWQgdG8gYW55IGJlY2F1c2UgdGhlIHJ1bnRpbWUgaXMgKm11Y2gqIG1vcmUgcGVybWlzc2l2ZSB0aGFuXG4gICAgICAgIC8vIHRoZSB0eXBlcyBhcmUuXG4gICAgICAgIHNlYXJjaFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMocXVlcnlQYXJhbXMgYXMgYW55KTtcbiAgICAgICAgdXJsID0gdXJsICsgJz8nICsgc2VhcmNoUGFyYW1zO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIE5vcm1hbGl6ZSB0aGUgaGVhZGVycy4gV2UncmUgZ29pbmcgdG8gbWFrZSB0aGVtIGFsbCBsb3dlcmNhc2UsIHNpbmNlXG4gICAgLy8gSGVhZGVycyBhcmUgY2FzZSBpbnNlbnNpdGl2ZSBieSBkZXNpZ24uIFRoaXMgbWFrZXMgaXQgZWFzaWVyIHRvIHZlcmlmeVxuICAgIC8vIHRoYXQgd2UgYXJlbid0IHNldHRpbmcgb3Igc2VuZGluZyBkdXBsaWNhdGVzLlxuICAgIGNvbnN0IGhlYWRlcnM6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fTtcbiAgICBpZiAoY29uZmlndXJlZEhlYWRlcnMpIHtcbiAgICAgIGZvciAoY29uc3Qga2V5IGluIGNvbmZpZ3VyZWRIZWFkZXJzKSB7XG4gICAgICAgIGlmIChjb25maWd1cmVkSGVhZGVycy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgaGVhZGVyc1trZXkudG9Mb3dlckNhc2UoKV0gPSBjb25maWd1cmVkSGVhZGVyc1trZXldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgY3Jvc3NEb21haW4gPSBjb25maWcuY3Jvc3NEb21haW47XG5cbiAgICAvLyBTZXQgdGhlIHgtcmVxdWVzdGVkLXdpdGggaGVhZGVyLiBUaGlzIGlzIGEgbm9uLXN0YW5kYXJkIGhlYWRlciB0aGF0IGhhc1xuICAgIC8vIGNvbWUgdG8gYmUgYSBkZSBmYWN0byBzdGFuZGFyZCBmb3IgSFRUUCByZXF1ZXN0cyBzZW50IGJ5IGxpYnJhcmllcyBhbmQgZnJhbWV3b3Jrc1xuICAgIC8vIHVzaW5nIFhIUi4gSG93ZXZlciwgd2UgRE8gTk9UIHdhbnQgdG8gc2V0IHRoaXMgaWYgaXQgaXMgYSBDT1JTIHJlcXVlc3QuIFRoaXMgaXNcbiAgICAvLyBiZWNhdXNlIHNvbWV0aW1lcyB0aGlzIGhlYWRlciBjYW4gY2F1c2UgaXNzdWVzIHdpdGggQ09SUy4gVG8gYmUgY2xlYXIsXG4gICAgLy8gTm9uZSBvZiB0aGlzIGlzIG5lY2Vzc2FyeSwgaXQncyBvbmx5IGJlaW5nIHNldCBiZWNhdXNlIGl0J3MgXCJ0aGUgdGhpbmcgbGlicmFyaWVzIGRvXCJcbiAgICAvLyBTdGFydGluZyBiYWNrIGFzIGZhciBhcyBKUXVlcnksIGFuZCBjb250aW51aW5nIHdpdGggb3RoZXIgbGlicmFyaWVzIHN1Y2ggYXMgQW5ndWxhciAxLFxuICAgIC8vIEF4aW9zLCBldCBhbC5cbiAgICBpZiAoIWNyb3NzRG9tYWluICYmICEoJ3gtcmVxdWVzdGVkLXdpdGgnIGluIGhlYWRlcnMpKSB7XG4gICAgICBoZWFkZXJzWyd4LXJlcXVlc3RlZC13aXRoJ10gPSAnWE1MSHR0cFJlcXVlc3QnO1xuICAgIH1cblxuICAgIC8vIEFsbG93IHVzZXJzIHRvIHByb3ZpZGUgdGhlaXIgWFNSRiBjb29raWUgbmFtZSBhbmQgdGhlIG5hbWUgb2YgYSBjdXN0b20gaGVhZGVyIHRvIHVzZSB0b1xuICAgIC8vIHNlbmQgdGhlIGNvb2tpZS5cbiAgICBjb25zdCB7IHdpdGhDcmVkZW50aWFscywgeHNyZkNvb2tpZU5hbWUsIHhzcmZIZWFkZXJOYW1lIH0gPSBjb25maWc7XG4gICAgaWYgKCh3aXRoQ3JlZGVudGlhbHMgfHwgIWNyb3NzRG9tYWluKSAmJiB4c3JmQ29va2llTmFtZSAmJiB4c3JmSGVhZGVyTmFtZSkge1xuICAgICAgY29uc3QgeHNyZkNvb2tpZSA9IGRvY3VtZW50Py5jb29raWUubWF0Y2gobmV3IFJlZ0V4cChgKF58O1xcXFxzKikoJHt4c3JmQ29va2llTmFtZX0pPShbXjtdKilgKSk/LnBvcCgpID8/ICcnO1xuICAgICAgaWYgKHhzcmZDb29raWUpIHtcbiAgICAgICAgaGVhZGVyc1t4c3JmSGVhZGVyTmFtZV0gPSB4c3JmQ29va2llO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEV4YW1pbmUgdGhlIGJvZHkgYW5kIGRldGVybWluZSB3aGV0aGVyIG9yIG5vdCB0byBzZXJpYWxpemUgaXRcbiAgICAvLyBhbmQgc2V0IHRoZSBjb250ZW50LXR5cGUgaW4gYGhlYWRlcnNgLCBpZiB3ZSdyZSBhYmxlLlxuICAgIGNvbnN0IGJvZHkgPSBleHRyYWN0Q29udGVudFR5cGVBbmRNYXliZVNlcmlhbGl6ZUJvZHkoY29uZmlndXJlZEJvZHksIGhlYWRlcnMpO1xuXG4gICAgLy8gVGhlIGZpbmFsIHJlcXVlc3Qgc2V0dGluZ3MuXG4gICAgY29uc3QgX3JlcXVlc3Q6IFJlYWRvbmx5PEFqYXhSZXF1ZXN0PiA9IHtcbiAgICAgIC4uLmNvbmZpZyxcblxuICAgICAgLy8gU2V0IHZhbHVlcyB3ZSBlbnN1cmVkIGFib3ZlXG4gICAgICB1cmwsXG4gICAgICBoZWFkZXJzLFxuICAgICAgYm9keSxcbiAgICB9O1xuXG4gICAgbGV0IHhocjogWE1MSHR0cFJlcXVlc3Q7XG5cbiAgICAvLyBDcmVhdGUgb3VyIFhIUiBzbyB3ZSBjYW4gZ2V0IHN0YXJ0ZWQuXG4gICAgeGhyID0gaW5pdC5jcmVhdGVYSFIgPyBpbml0LmNyZWF0ZVhIUigpIDogbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cbiAgICB7XG4gICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAgIC8vIHNldCB1cCB0aGUgZXZlbnRzIGJlZm9yZSBvcGVuIFhIUlxuICAgICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vZG9jcy9XZWIvQVBJL1hNTEh0dHBSZXF1ZXN0L1VzaW5nX1hNTEh0dHBSZXF1ZXN0XG4gICAgICAvLyBZb3UgbmVlZCB0byBhZGQgdGhlIGV2ZW50IGxpc3RlbmVycyBiZWZvcmUgY2FsbGluZyBvcGVuKCkgb24gdGhlIHJlcXVlc3QuXG4gICAgICAvLyBPdGhlcndpc2UgdGhlIHByb2dyZXNzIGV2ZW50cyB3aWxsIG5vdCBmaXJlLlxuICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgIGNvbnN0IHsgcHJvZ3Jlc3NTdWJzY3JpYmVyLCBpbmNsdWRlRG93bmxvYWRQcm9ncmVzcyA9IGZhbHNlLCBpbmNsdWRlVXBsb2FkUHJvZ3Jlc3MgPSBmYWxzZSB9ID0gaW5pdDtcblxuICAgICAgLyoqXG4gICAgICAgKiBXaXJlcyB1cCBhbiBldmVudCBoYW5kbGVyIHRoYXQgd2lsbCBlbWl0IGFuIGVycm9yIHdoZW4gZmlyZWQuIFVzZWRcbiAgICAgICAqIGZvciB0aW1lb3V0IGFuZCBhYm9ydCBldmVudHMuXG4gICAgICAgKiBAcGFyYW0gdHlwZSBUaGUgdHlwZSBvZiBldmVudCB3ZSdyZSB0cmVhdGluZyBhcyBhbiBlcnJvclxuICAgICAgICogQHBhcmFtIGVycm9yRmFjdG9yeSBBIGZ1bmN0aW9uIHRoYXQgY3JlYXRlcyB0aGUgdHlwZSBvZiBlcnJvciB0byBlbWl0LlxuICAgICAgICovXG4gICAgICBjb25zdCBhZGRFcnJvckV2ZW50ID0gKHR5cGU6IHN0cmluZywgZXJyb3JGYWN0b3J5OiAoKSA9PiBhbnkpID0+IHtcbiAgICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGVycm9yID0gZXJyb3JGYWN0b3J5KCk7XG4gICAgICAgICAgcHJvZ3Jlc3NTdWJzY3JpYmVyPy5lcnJvcj8uKGVycm9yKTtcbiAgICAgICAgICBkZXN0aW5hdGlvbi5lcnJvcihlcnJvcik7XG4gICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgLy8gSWYgdGhlIHJlcXVlc3QgdGltZXMgb3V0LCBoYW5kbGUgZXJyb3JzIGFwcHJvcHJpYXRlbHkuXG4gICAgICBhZGRFcnJvckV2ZW50KCd0aW1lb3V0JywgKCkgPT4gbmV3IEFqYXhUaW1lb3V0RXJyb3IoeGhyLCBfcmVxdWVzdCkpO1xuXG4gICAgICAvLyBJZiB0aGUgcmVxdWVzdCBhYm9ydHMgKGR1ZSB0byBhIG5ldHdvcmsgZGlzY29ubmVjdGlvbiBvciB0aGUgbGlrZSksIGhhbmRsZVxuICAgICAgLy8gaXQgYXMgYW4gZXJyb3IuXG4gICAgICBhZGRFcnJvckV2ZW50KCdhYm9ydCcsICgpID0+IG5ldyBBamF4RXJyb3IoJ2Fib3J0ZWQnLCB4aHIsIF9yZXF1ZXN0KSk7XG5cbiAgICAgIC8qKlxuICAgICAgICogQ3JlYXRlcyBhIHJlc3BvbnNlIG9iamVjdCB0byBlbWl0IHRvIHRoZSBjb25zdW1lci5cbiAgICAgICAqIEBwYXJhbSBkaXJlY3Rpb24gdGhlIGRpcmVjdGlvbiByZWxhdGVkIHRvIHRoZSBldmVudC4gUHJlZml4ZXMgdGhlIGV2ZW50IGB0eXBlYCBpbiB0aGVcbiAgICAgICAqIGBBamF4UmVzcG9uc2VgIG9iamVjdCB3aXRoIFwidXBsb2FkX1wiIGZvciBldmVudHMgcmVsYXRlZCB0byB1cGxvYWRpbmcgYW5kIFwiZG93bmxvYWRfXCJcbiAgICAgICAqIGZvciBldmVudHMgcmVsYXRlZCB0byBkb3dubG9hZGluZy5cbiAgICAgICAqIEBwYXJhbSBldmVudCB0aGUgYWN0dWFsIGV2ZW50IG9iamVjdC5cbiAgICAgICAqL1xuICAgICAgY29uc3QgY3JlYXRlUmVzcG9uc2UgPSAoZGlyZWN0aW9uOiBBamF4RGlyZWN0aW9uLCBldmVudDogUHJvZ3Jlc3NFdmVudCkgPT5cbiAgICAgICAgbmV3IEFqYXhSZXNwb25zZTxUPihldmVudCwgeGhyLCBfcmVxdWVzdCwgYCR7ZGlyZWN0aW9ufV8ke2V2ZW50LnR5cGUgYXMgUHJvZ3Jlc3NFdmVudFR5cGV9YCBhcyBjb25zdCk7XG5cbiAgICAgIC8qKlxuICAgICAgICogV2lyZXMgdXAgYW4gZXZlbnQgaGFuZGxlciB0aGF0IGVtaXRzIGEgUmVzcG9uc2Ugb2JqZWN0IHRvIHRoZSBjb25zdW1lciwgdXNlZCBmb3JcbiAgICAgICAqIGFsbCBldmVudHMgdGhhdCBlbWl0IHJlc3BvbnNlcywgbG9hZHN0YXJ0LCBwcm9ncmVzcywgYW5kIGxvYWQuXG4gICAgICAgKiBOb3RlIHRoYXQgZG93bmxvYWQgbG9hZCBoYW5kbGluZyBpcyBhIGJpdCBkaWZmZXJlbnQgYmVsb3csIGJlY2F1c2UgaXQgaGFzXG4gICAgICAgKiBtb3JlIGxvZ2ljIGl0IG5lZWRzIHRvIHJ1bi5cbiAgICAgICAqIEBwYXJhbSB0YXJnZXQgVGhlIHRhcmdldCwgZWl0aGVyIHRoZSBYSFIgaXRzZWxmIG9yIHRoZSBVcGxvYWQgb2JqZWN0LlxuICAgICAgICogQHBhcmFtIHR5cGUgVGhlIHR5cGUgb2YgZXZlbnQgdG8gd2lyZSB1cFxuICAgICAgICogQHBhcmFtIGRpcmVjdGlvbiBUaGUgXCJkaXJlY3Rpb25cIiwgdXNlZCB0byBwcmVmaXggdGhlIHJlc3BvbnNlIG9iamVjdCB0aGF0IGlzXG4gICAgICAgKiBlbWl0dGVkIHRvIHRoZSBjb25zdW1lci4gKGUuZy4gXCJ1cGxvYWRfXCIgb3IgXCJkb3dubG9hZF9cIilcbiAgICAgICAqL1xuICAgICAgY29uc3QgYWRkUHJvZ3Jlc3NFdmVudCA9ICh0YXJnZXQ6IGFueSwgdHlwZTogc3RyaW5nLCBkaXJlY3Rpb246IEFqYXhEaXJlY3Rpb24pID0+IHtcbiAgICAgICAgdGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgKGV2ZW50OiBQcm9ncmVzc0V2ZW50KSA9PiB7XG4gICAgICAgICAgZGVzdGluYXRpb24ubmV4dChjcmVhdGVSZXNwb25zZShkaXJlY3Rpb24sIGV2ZW50KSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgaWYgKGluY2x1ZGVVcGxvYWRQcm9ncmVzcykge1xuICAgICAgICBbTE9BRFNUQVJULCBQUk9HUkVTUywgTE9BRF0uZm9yRWFjaCgodHlwZSkgPT4gYWRkUHJvZ3Jlc3NFdmVudCh4aHIudXBsb2FkLCB0eXBlLCBVUExPQUQpKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHByb2dyZXNzU3Vic2NyaWJlcikge1xuICAgICAgICBbTE9BRFNUQVJULCBQUk9HUkVTU10uZm9yRWFjaCgodHlwZSkgPT4geGhyLnVwbG9hZC5hZGRFdmVudExpc3RlbmVyKHR5cGUsIChlOiBhbnkpID0+IHByb2dyZXNzU3Vic2NyaWJlcj8ubmV4dD8uKGUpKSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChpbmNsdWRlRG93bmxvYWRQcm9ncmVzcykge1xuICAgICAgICBbTE9BRFNUQVJULCBQUk9HUkVTU10uZm9yRWFjaCgodHlwZSkgPT4gYWRkUHJvZ3Jlc3NFdmVudCh4aHIsIHR5cGUsIERPV05MT0FEKSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGVtaXRFcnJvciA9IChzdGF0dXM/OiBudW1iZXIpID0+IHtcbiAgICAgICAgY29uc3QgbXNnID0gJ2FqYXggZXJyb3InICsgKHN0YXR1cyA/ICcgJyArIHN0YXR1cyA6ICcnKTtcbiAgICAgICAgZGVzdGluYXRpb24uZXJyb3IobmV3IEFqYXhFcnJvcihtc2csIHhociwgX3JlcXVlc3QpKTtcbiAgICAgIH07XG5cbiAgICAgIHhoci5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIChlKSA9PiB7XG4gICAgICAgIHByb2dyZXNzU3Vic2NyaWJlcj8uZXJyb3I/LihlKTtcbiAgICAgICAgZW1pdEVycm9yKCk7XG4gICAgICB9KTtcblxuICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoTE9BRCwgKGV2ZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IHsgc3RhdHVzIH0gPSB4aHI7XG4gICAgICAgIC8vIDR4eCBhbmQgNXh4IHNob3VsZCBlcnJvciAoaHR0cHM6Ly93d3cudzMub3JnL1Byb3RvY29scy9yZmMyNjE2L3JmYzI2MTYtc2VjMTAuaHRtbClcbiAgICAgICAgaWYgKHN0YXR1cyA8IDQwMCkge1xuICAgICAgICAgIHByb2dyZXNzU3Vic2NyaWJlcj8uY29tcGxldGU/LigpO1xuXG4gICAgICAgICAgbGV0IHJlc3BvbnNlOiBBamF4UmVzcG9uc2U8VD47XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIFRoaXMgY2FuIHRocm93IGluIElFLCBiZWNhdXNlIHdlIGVuZCB1cCBuZWVkaW5nIHRvIGRvIGEgSlNPTi5wYXJzZVxuICAgICAgICAgICAgLy8gb2YgdGhlIHJlc3BvbnNlIGluIHNvbWUgY2FzZXMgdG8gcHJvZHVjZSBvYmplY3Qgd2UnZCBleHBlY3QgZnJvbVxuICAgICAgICAgICAgLy8gbW9kZXJuIGJyb3dzZXJzLlxuICAgICAgICAgICAgcmVzcG9uc2UgPSBjcmVhdGVSZXNwb25zZShET1dOTE9BRCwgZXZlbnQpO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgZGVzdGluYXRpb24uZXJyb3IoZXJyKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBkZXN0aW5hdGlvbi5uZXh0KHJlc3BvbnNlKTtcbiAgICAgICAgICBkZXN0aW5hdGlvbi5jb21wbGV0ZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHByb2dyZXNzU3Vic2NyaWJlcj8uZXJyb3I/LihldmVudCk7XG4gICAgICAgICAgZW1pdEVycm9yKHN0YXR1cyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHsgdXNlciwgbWV0aG9kLCBhc3luYyB9ID0gX3JlcXVlc3Q7XG4gICAgLy8gb3BlbiBYSFJcbiAgICBpZiAodXNlcikge1xuICAgICAgeGhyLm9wZW4obWV0aG9kLCB1cmwsIGFzeW5jLCB1c2VyLCBfcmVxdWVzdC5wYXNzd29yZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHhoci5vcGVuKG1ldGhvZCwgdXJsLCBhc3luYyk7XG4gICAgfVxuXG4gICAgLy8gdGltZW91dCwgcmVzcG9uc2VUeXBlIGFuZCB3aXRoQ3JlZGVudGlhbHMgY2FuIGJlIHNldCBvbmNlIHRoZSBYSFIgaXMgb3BlblxuICAgIGlmIChhc3luYykge1xuICAgICAgeGhyLnRpbWVvdXQgPSBfcmVxdWVzdC50aW1lb3V0O1xuICAgICAgeGhyLnJlc3BvbnNlVHlwZSA9IF9yZXF1ZXN0LnJlc3BvbnNlVHlwZTtcbiAgICB9XG5cbiAgICBpZiAoJ3dpdGhDcmVkZW50aWFscycgaW4geGhyKSB7XG4gICAgICB4aHIud2l0aENyZWRlbnRpYWxzID0gX3JlcXVlc3Qud2l0aENyZWRlbnRpYWxzO1xuICAgIH1cblxuICAgIC8vIHNldCBoZWFkZXJzXG4gICAgZm9yIChjb25zdCBrZXkgaW4gaGVhZGVycykge1xuICAgICAgaWYgKGhlYWRlcnMuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihrZXksIGhlYWRlcnNba2V5XSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gZmluYWxseSBzZW5kIHRoZSByZXF1ZXN0XG4gICAgaWYgKGJvZHkpIHtcbiAgICAgIHhoci5zZW5kKGJvZHkpO1xuICAgIH0gZWxzZSB7XG4gICAgICB4aHIuc2VuZCgpO1xuICAgIH1cblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBpZiAoeGhyICYmIHhoci5yZWFkeVN0YXRlICE9PSA0IC8qWEhSIGRvbmUqLykge1xuICAgICAgICB4aHIuYWJvcnQoKTtcbiAgICAgIH1cbiAgICB9O1xuICB9KTtcbn1cblxuLyoqXG4gKiBFeGFtaW5lcyB0aGUgYm9keSB0byBkZXRlcm1pbmUgaWYgd2UgbmVlZCB0byBzZXJpYWxpemUgaXQgZm9yIHRoZW0gb3Igbm90LlxuICogSWYgdGhlIGJvZHkgaXMgYSB0eXBlIHRoYXQgWEhSIGhhbmRsZXMgbmF0aXZlbHksIHdlIGp1c3QgYWxsb3cgaXQgdGhyb3VnaCxcbiAqIG90aGVyd2lzZSwgaWYgdGhlIGJvZHkgaXMgc29tZXRoaW5nIHRoYXQgKndlKiBjYW4gc2VyaWFsaXplIGZvciB0aGUgdXNlcixcbiAqIHdlIHdpbGwgc2VyaWFsaXplIGl0LCBhbmQgYXR0ZW1wdCB0byBzZXQgdGhlIGBjb250ZW50LXR5cGVgIGhlYWRlciwgaWYgaXQnc1xuICogbm90IGFscmVhZHkgc2V0LlxuICogQHBhcmFtIGJvZHkgVGhlIGJvZHkgcGFzc2VkIGluIGJ5IHRoZSB1c2VyXG4gKiBAcGFyYW0gaGVhZGVycyBUaGUgbm9ybWFsaXplZCBoZWFkZXJzXG4gKi9cbmZ1bmN0aW9uIGV4dHJhY3RDb250ZW50VHlwZUFuZE1heWJlU2VyaWFsaXplQm9keShib2R5OiBhbnksIGhlYWRlcnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4pIHtcbiAgaWYgKFxuICAgICFib2R5IHx8XG4gICAgdHlwZW9mIGJvZHkgPT09ICdzdHJpbmcnIHx8XG4gICAgaXNGb3JtRGF0YShib2R5KSB8fFxuICAgIGlzVVJMU2VhcmNoUGFyYW1zKGJvZHkpIHx8XG4gICAgaXNBcnJheUJ1ZmZlcihib2R5KSB8fFxuICAgIGlzRmlsZShib2R5KSB8fFxuICAgIGlzQmxvYihib2R5KSB8fFxuICAgIGlzUmVhZGFibGVTdHJlYW0oYm9keSlcbiAgKSB7XG4gICAgLy8gVGhlIFhIUiBpbnN0YW5jZSBpdHNlbGYgY2FuIGhhbmRsZSBzZXJpYWxpemluZyB0aGVzZSwgYW5kIHNldCB0aGUgY29udGVudC10eXBlIGZvciB1c1xuICAgIC8vIHNvIHdlIGRvbid0IG5lZWQgdG8gZG8gdGhhdC4gaHR0cHM6Ly94aHIuc3BlYy53aGF0d2cub3JnLyN0aGUtc2VuZCgpLW1ldGhvZFxuICAgIHJldHVybiBib2R5O1xuICB9XG5cbiAgaWYgKGlzQXJyYXlCdWZmZXJWaWV3KGJvZHkpKSB7XG4gICAgLy8gVGhpcyBpcyBhIHR5cGVkIGFycmF5IChlLmcuIEZsb2F0MzJBcnJheSBvciBVaW50OEFycmF5KSwgb3IgYSBEYXRhVmlldy5cbiAgICAvLyBYSFIgY2FuIGhhbmRsZSB0aGlzIG9uZSB0b286IGh0dHBzOi8vZmV0Y2guc3BlYy53aGF0d2cub3JnLyNjb25jZXB0LWJvZHlpbml0LWV4dHJhY3RcbiAgICByZXR1cm4gYm9keS5idWZmZXI7XG4gIH1cblxuICBpZiAodHlwZW9mIGJvZHkgPT09ICdvYmplY3QnKSB7XG4gICAgLy8gSWYgd2UgaGF2ZSBtYWRlIGl0IGhlcmUsIHRoaXMgaXMgYW4gb2JqZWN0LCBwcm9iYWJseSBhIFBPSk8sIGFuZCB3ZSdsbCB0cnlcbiAgICAvLyB0byBzZXJpYWxpemUgaXQgZm9yIHRoZW0uIElmIHRoaXMgZG9lc24ndCB3b3JrLCBpdCB3aWxsIHRocm93LCBvYnZpb3VzbHksIHdoaWNoXG4gICAgLy8gaXMgb2theS4gVGhlIHdvcmthcm91bmQgZm9yIHVzZXJzIHdvdWxkIGJlIHRvIG1hbnVhbGx5IHNldCB0aGUgYm9keSB0byB0aGVpciBvd25cbiAgICAvLyBzZXJpYWxpemVkIHN0cmluZyAoYWNjb3VudGluZyBmb3IgY2lyY3VsYXIgcmVmZXJlbmNlcyBvciB3aGF0ZXZlciksIHRoZW4gc2V0XG4gICAgLy8gdGhlIGNvbnRlbnQtdHlwZSBtYW51YWxseSBhcyB3ZWxsLlxuICAgIGhlYWRlcnNbJ2NvbnRlbnQtdHlwZSddID0gaGVhZGVyc1snY29udGVudC10eXBlJ10gPz8gJ2FwcGxpY2F0aW9uL2pzb247Y2hhcnNldD11dGYtOCc7XG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGJvZHkpO1xuICB9XG5cbiAgLy8gSWYgd2UndmUgZ290dGVuIHBhc3QgZXZlcnl0aGluZyBhYm92ZSwgdGhpcyBpcyBzb21ldGhpbmcgd2UgZG9uJ3QgcXVpdGUga25vdyBob3cgdG9cbiAgLy8gaGFuZGxlLiBUaHJvdyBhbiBlcnJvci4gVGhpcyB3aWxsIGJlIGNhdWdodCBhbmQgZW1pdHRlZCBmcm9tIHRoZSBvYnNlcnZhYmxlLlxuICB0aHJvdyBuZXcgVHlwZUVycm9yKCdVbmtub3duIGJvZHkgdHlwZScpO1xufVxuXG5jb25zdCBfdG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nO1xuXG5mdW5jdGlvbiB0b1N0cmluZ0NoZWNrKG9iajogYW55LCBuYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgcmV0dXJuIF90b1N0cmluZy5jYWxsKG9iaikgPT09IGBbb2JqZWN0ICR7bmFtZX1dYDtcbn1cblxuZnVuY3Rpb24gaXNBcnJheUJ1ZmZlcihib2R5OiBhbnkpOiBib2R5IGlzIEFycmF5QnVmZmVyIHtcbiAgcmV0dXJuIHRvU3RyaW5nQ2hlY2soYm9keSwgJ0FycmF5QnVmZmVyJyk7XG59XG5cbmZ1bmN0aW9uIGlzRmlsZShib2R5OiBhbnkpOiBib2R5IGlzIEZpbGUge1xuICByZXR1cm4gdG9TdHJpbmdDaGVjayhib2R5LCAnRmlsZScpO1xufVxuXG5mdW5jdGlvbiBpc0Jsb2IoYm9keTogYW55KTogYm9keSBpcyBCbG9iIHtcbiAgcmV0dXJuIHRvU3RyaW5nQ2hlY2soYm9keSwgJ0Jsb2InKTtcbn1cblxuZnVuY3Rpb24gaXNBcnJheUJ1ZmZlclZpZXcoYm9keTogYW55KTogYm9keSBpcyBBcnJheUJ1ZmZlclZpZXcge1xuICByZXR1cm4gdHlwZW9mIEFycmF5QnVmZmVyICE9PSAndW5kZWZpbmVkJyAmJiBBcnJheUJ1ZmZlci5pc1ZpZXcoYm9keSk7XG59XG5cbmZ1bmN0aW9uIGlzRm9ybURhdGEoYm9keTogYW55KTogYm9keSBpcyBGb3JtRGF0YSB7XG4gIHJldHVybiB0eXBlb2YgRm9ybURhdGEgIT09ICd1bmRlZmluZWQnICYmIGJvZHkgaW5zdGFuY2VvZiBGb3JtRGF0YTtcbn1cblxuZnVuY3Rpb24gaXNVUkxTZWFyY2hQYXJhbXMoYm9keTogYW55KTogYm9keSBpcyBVUkxTZWFyY2hQYXJhbXMge1xuICByZXR1cm4gdHlwZW9mIFVSTFNlYXJjaFBhcmFtcyAhPT0gJ3VuZGVmaW5lZCcgJiYgYm9keSBpbnN0YW5jZW9mIFVSTFNlYXJjaFBhcmFtcztcbn1cblxuZnVuY3Rpb24gaXNSZWFkYWJsZVN0cmVhbShib2R5OiBhbnkpOiBib2R5IGlzIFJlYWRhYmxlU3RyZWFtIHtcbiAgcmV0dXJuIHR5cGVvZiBSZWFkYWJsZVN0cmVhbSAhPT0gJ3VuZGVmaW5lZCcgJiYgYm9keSBpbnN0YW5jZW9mIFJlYWRhYmxlU3RyZWFtO1xufVxuIl19
