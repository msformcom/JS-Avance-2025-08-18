Object.defineProperty(exports,"__esModule",{value:!0}),exports.timeout=exports.TimeoutError=void 0;var async_1=require("../scheduler/async"),isDate_1=require("../util/isDate"),lift_1=require("../util/lift"),innerFrom_1=require("../observable/innerFrom"),createErrorClass_1=require("../util/createErrorClass"),OperatorSubscriber_1=require("./OperatorSubscriber"),executeSchedule_1=require("../util/executeSchedule");function timeout(e,r){var e=isDate_1.isValidDate(e)?{first:e}:"number"==typeof e?{each:e}:e,s=e.first,c=e.each,t=e.with,l=void 0===t?timeoutErrorFactory:t,t=e.scheduler,a=void 0===t?null!=r?r:async_1.asyncScheduler:t,r=e.meta,b=void 0===r?null:r;if(null==s&&null==c)throw new TypeError("No timeout provided.");return lift_1.operate(function(e,r){function t(e){u=executeSchedule_1.executeSchedule(r,a,function(){try{n.unsubscribe(),innerFrom_1.innerFrom(l({meta:b,lastValue:i,seen:o})).subscribe(r)}catch(e){r.error(e)}},e)}var u,i=null,o=0,n=e.subscribe(OperatorSubscriber_1.createOperatorSubscriber(r,function(e){null!=u&&u.unsubscribe(),o++,r.next(i=e),0<c&&t(c)},void 0,void 0,function(){null!=u&&u.closed||null!=u&&u.unsubscribe(),i=null}));o||t(null!=s?"number"==typeof s?s:+s-a.now():c)})}function timeoutErrorFactory(e){throw new exports.TimeoutError(e)}exports.TimeoutError=createErrorClass_1.createErrorClass(function(r){return function(e){void 0===e&&(e=null),r(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}}),exports.timeout=timeout;