var __extends=this&&this.__extends||(()=>{var n=function(t,e){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}))(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}})(),Observable_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.ConnectableObservable=void 0,require("../Observable")),Subscription_1=require("../Subscription"),refCount_1=require("../operators/refCount"),OperatorSubscriber_1=require("../operators/OperatorSubscriber"),lift_1=require("../util/lift"),ConnectableObservable=(n=>{function t(t,e){var r=n.call(this)||this;return r.source=t,r.subjectFactory=e,r._subject=null,r._refCount=0,r._connection=null,lift_1.hasLift(t)&&(r.lift=t.lift),r}return __extends(t,n),t.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},t.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype._teardown=function(){this._refCount=0;var t=this._connection;(this._subject=this._connection=null)!=t&&t.unsubscribe()},t.prototype.connect=function(){var e,r=this,t=this._connection;return t||(t=this._connection=new Subscription_1.Subscription,e=this.getSubject(),t.add(this.source.subscribe(OperatorSubscriber_1.createOperatorSubscriber(e,void 0,function(){r._teardown(),e.complete()},function(t){r._teardown(),e.error(t)},function(){return r._teardown()}))),t.closed&&(this._connection=null,t=Subscription_1.Subscription.EMPTY)),t},t.prototype.refCount=function(){return refCount_1.refCount()(this)},t})(Observable_1.Observable);exports.ConnectableObservable=ConnectableObservable;