var __extends=this&&this.__extends||(()=>{var r=function(e,t){return(r=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}})(),Subject_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.ReplaySubject=void 0,require("./Subject")),dateTimestampProvider_1=require("./scheduler/dateTimestampProvider"),ReplaySubject=(s=>{function e(e,t,i){void 0===e&&(e=1/0),void 0===t&&(t=1/0),void 0===i&&(i=dateTimestampProvider_1.dateTimestampProvider);var r=s.call(this)||this;return r._bufferSize=e,r._windowTime=t,r._timestampProvider=i,r._buffer=[],r._infiniteTimeWindow=!0,r._infiniteTimeWindow=t===1/0,r._bufferSize=Math.max(1,e),r._windowTime=Math.max(1,t),r}return __extends(e,s),e.prototype.next=function(e){var t=this,i=t.isStopped,r=t._buffer,o=t._infiniteTimeWindow,n=t._timestampProvider,t=t._windowTime;i||(r.push(e),o)||r.push(n.now()+t),this._trimBuffer(),s.prototype.next.call(this,e)},e.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),i=this._infiniteTimeWindow,r=this._buffer.slice(),o=0;o<r.length&&!e.closed;o+=i?1:2)e.next(r[o]);return this._checkFinalizedStatuses(e),t},e.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,i=e._timestampProvider,r=e._buffer,e=e._infiniteTimeWindow,o=(e?1:2)*t;if(t<1/0&&o<r.length&&r.splice(0,r.length-o),!e){for(var n=i.now(),s=0,u=1;u<r.length&&r[u]<=n;u+=2)s=u;s&&r.splice(0,s+1)}},e})(Subject_1.Subject);exports.ReplaySubject=ReplaySubject;