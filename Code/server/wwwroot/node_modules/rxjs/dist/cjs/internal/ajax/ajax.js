var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var a in r=arguments[t])Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a]);return e}).apply(this,arguments)},map_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.fromAjax=exports.ajax=void 0,require("../operators/map")),Observable_1=require("../Observable"),AjaxResponse_1=require("./AjaxResponse"),errors_1=require("./errors");function ajaxGet(e,r){return exports.ajax({method:"GET",url:e,headers:r})}function ajaxPost(e,r,t){return exports.ajax({method:"POST",url:e,body:r,headers:t})}function ajaxDelete(e,r){return exports.ajax({method:"DELETE",url:e,headers:r})}function ajaxPut(e,r,t){return exports.ajax({method:"PUT",url:e,body:r,headers:t})}function ajaxPatch(e,r,t){return exports.ajax({method:"PATCH",url:e,body:r,headers:t})}var mapResponse=map_1.map(function(e){return e.response});function ajaxGetJSON(e,r){return mapResponse(exports.ajax({method:"GET",url:e,headers:r}))}exports.ajax=(()=>{function e(e){return fromAjax("string"==typeof e?{url:e}:e)}return e.get=ajaxGet,e.post=ajaxPost,e.delete=ajaxDelete,e.put=ajaxPut,e.patch=ajaxPatch,e.getJSON=ajaxGetJSON,e})();var UPLOAD="upload",DOWNLOAD="download",LOADSTART="loadstart",PROGRESS="progress",LOAD="load";function fromAjax(j){return new Observable_1.Observable(function(n){var t,e=__assign({async:!0,crossDomain:!1,withCredentials:!1,method:"GET",timeout:0,responseType:"json"},j),r=e.queryParams,a=e.body,o=e.headers,i=e.url;if(!i)throw new TypeError("url is required");if(r)if(i.includes("?")){var s=i.split("?");if(2<s.length)throw new TypeError("invalid url");t=new URLSearchParams(s[1]),new URLSearchParams(r).forEach(function(e,r){return t.set(r,e)}),i=s[0]+"?"+t}else i=i+"?"+(t=new URLSearchParams(r));var u={};if(o)for(var l in o)o.hasOwnProperty(l)&&(u[l.toLowerCase()]=o[l]);var s=e.crossDomain;s||"x-requested-with"in u||(u["x-requested-with"]="XMLHttpRequest");function c(e,t){x.addEventListener(e,function(){var e,r=t();null!=(e=null==m?void 0:m.error)&&e.call(m,r),n.error(r)})}function d(e,r,t){e.addEventListener(r,function(e){n.next(y(t,e))})}function f(e){n.error(new errors_1.AjaxError("ajax error"+(e?" "+e:""),x,h))}var r=e.xsrfCookieName,p=e.xsrfHeaderName,r=((e.withCredentials||!s)&&r&&p&&(s=null!=(r=null==(s=null==document?void 0:document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)")))?void 0:s.pop())?r:"")&&(u[p]=s),extractContentTypeAndMaybeSerializeBody(a,u)),h=__assign(__assign({},e),{url:i,headers:u,body:r}),x=j.createXHR?j.createXHR():new XMLHttpRequest,m=j.progressSubscriber,p=j.includeDownloadProgress,s=void 0!==p&&p,a=j.includeUploadProgress,e=void 0!==a&&a,y=(c("timeout",function(){return new errors_1.AjaxTimeoutError(x,h)}),c("abort",function(){return new errors_1.AjaxError("aborted",x,h)}),function(e,r){return new AjaxResponse_1.AjaxResponse(r,x,h,e+"_"+r.type)}),p=(e&&[LOADSTART,PROGRESS,LOAD].forEach(function(e){return d(x.upload,e,UPLOAD)}),m&&[LOADSTART,PROGRESS].forEach(function(e){return x.upload.addEventListener(e,function(e){var r;return null==(r=null==m?void 0:m.next)?void 0:r.call(m,e)})}),s&&[LOADSTART,PROGRESS].forEach(function(e){return d(x,e,DOWNLOAD)}),x.addEventListener("error",function(e){var r;null!=(r=null==m?void 0:m.error)&&r.call(m,e),f()}),x.addEventListener(LOAD,function(e){var r=x.status;if(r<400){null!=(t=null==m?void 0:m.complete)&&t.call(m);var t=void 0;try{t=y(DOWNLOAD,e)}catch(e){return void n.error(e)}n.next(t),n.complete()}else null!=(t=null==m?void 0:m.error)&&t.call(m,e),f(r)}),h.user),a=h.method,e=h.async;for(l in p?x.open(a,i,e,p,h.password):x.open(a,i,e),e&&(x.timeout=h.timeout,x.responseType=h.responseType),"withCredentials"in x&&(x.withCredentials=h.withCredentials),u)u.hasOwnProperty(l)&&x.setRequestHeader(l,u[l]);return r?x.send(r):x.send(),function(){x&&4!==x.readyState&&x.abort()}})}function extractContentTypeAndMaybeSerializeBody(e,r){if(!e||"string"==typeof e||isFormData(e)||isURLSearchParams(e)||isArrayBuffer(e)||isFile(e)||isBlob(e)||isReadableStream(e))return e;if(isArrayBufferView(e))return e.buffer;if("object"==typeof e)return r["content-type"]=null!=(r=r["content-type"])?r:"application/json;charset=utf-8",JSON.stringify(e);throw new TypeError("Unknown body type")}exports.fromAjax=fromAjax;var _toString=Object.prototype.toString;function toStringCheck(e,r){return _toString.call(e)==="[object "+r+"]"}function isArrayBuffer(e){return toStringCheck(e,"ArrayBuffer")}function isFile(e){return toStringCheck(e,"File")}function isBlob(e){return toStringCheck(e,"Blob")}function isArrayBufferView(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView(e)}function isFormData(e){return"undefined"!=typeof FormData&&e instanceof FormData}function isURLSearchParams(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams}function isReadableStream(e){return"undefined"!=typeof ReadableStream&&e instanceof ReadableStream}