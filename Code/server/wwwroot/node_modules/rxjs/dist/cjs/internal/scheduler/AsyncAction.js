var __extends=this&&this.__extends||(()=>{var i=function(t,e){return(i=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}))(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}})(),Action_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.AsyncAction=void 0,require("./Action")),intervalProvider_1=require("./intervalProvider"),arrRemove_1=require("../util/arrRemove"),AsyncAction=(i=>{function t(t,e){var r=i.call(this,t,e)||this;return r.scheduler=t,r.work=e,r.pending=!1,r}return __extends(t,i),t.prototype.schedule=function(t,e){var r;return void 0===e&&(e=0),this.closed||(this.state=t,t=this.id,r=this.scheduler,null!=t&&(this.id=this.recycleAsyncId(r,t,e)),this.pending=!0,this.delay=e,this.id=null!=(t=this.id)?t:this.requestAsyncId(r,this.id,e)),this},t.prototype.requestAsyncId=function(t,e,r){return void 0===r&&(r=0),intervalProvider_1.intervalProvider.setInterval(t.flush.bind(t,this),r)},t.prototype.recycleAsyncId=function(t,e,r){if(null!=(r=void 0===r?0:r)&&this.delay===r&&!1===this.pending)return e;null!=e&&intervalProvider_1.intervalProvider.clearInterval(e)},t.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;t=this._execute(t,e);if(t)return t;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(t,e){var r,i=!1;try{this.work(t)}catch(t){i=!0,r=t||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r},t.prototype.unsubscribe=function(){var t,e,r;this.closed||(t=this.id,r=(e=this.scheduler).actions,this.work=this.state=this.scheduler=null,this.pending=!1,arrRemove_1.arrRemove(r,this),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null,i.prototype.unsubscribe.call(this))},t})(Action_1.Action);exports.AsyncAction=AsyncAction;