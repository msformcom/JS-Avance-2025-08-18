import{__read,__spreadArray,__values}from"tslib";import{isFunction}from"./util/isFunction";import{UnsubscriptionError}from"./util/UnsubscriptionError";import{arrRemove}from"./util/arrRemove";var Subscription=(()=>{function e(r){this.initialTeardown=r,this.closed=!1,this._parentage=null,this._finalizers=null}var r;return e.prototype.unsubscribe=function(){var i,r,e;if(!this.closed){this.closed=!0;var t=this._parentage;if(t)if(this._parentage=null,Array.isArray(t))try{for(var n=__values(t),a=n.next();!a.done;a=n.next())a.value.remove(this)}catch(r){o={error:r}}finally{try{a&&!a.done&&(s=n.return)&&s.call(n)}finally{if(o)throw o.error}}else t.remove(this);var s=this.initialTeardown;if(isFunction(s))try{s()}catch(r){e=r instanceof UnsubscriptionError?r.errors:[r]}var o=this._finalizers;if(o){this._finalizers=null;try{for(var u=__values(o),c=u.next();!c.done;c=u.next()){var l=c.value;try{execFinalizer(l)}catch(r){e=null!=e?e:[],r instanceof UnsubscriptionError?e=__spreadArray(__spreadArray([],__read(e)),__read(r.errors)):e.push(r)}}}catch(r){i={error:r}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(i)throw i.error}}}if(e)throw new UnsubscriptionError(e)}},e.prototype.add=function(r){var i;if(r&&r!==this)if(this.closed)execFinalizer(r);else{if(r instanceof e){if(r.closed||r._hasParent(this))return;r._addParent(this)}(this._finalizers=null!=(i=this._finalizers)?i:[]).push(r)}},e.prototype._hasParent=function(r){var i=this._parentage;return i===r||Array.isArray(i)&&i.includes(r)},e.prototype._addParent=function(r){var i=this._parentage;this._parentage=Array.isArray(i)?(i.push(r),i):i?[i,r]:r},e.prototype._removeParent=function(r){var i=this._parentage;i===r?this._parentage=null:Array.isArray(i)&&arrRemove(i,r)},e.prototype.remove=function(r){var i=this._finalizers;i&&arrRemove(i,r),r instanceof e&&r._removeParent(this)},e.EMPTY=((r=new e).closed=!0,r),e})(),EMPTY_SUBSCRIPTION=Subscription.EMPTY;function isSubscription(r){return r instanceof Subscription||r&&"closed"in r&&isFunction(r.remove)&&isFunction(r.add)&&isFunction(r.unsubscribe)}function execFinalizer(r){isFunction(r)?r():r.unsubscribe()}export{Subscription,EMPTY_SUBSCRIPTION,isSubscription};