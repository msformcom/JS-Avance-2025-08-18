import{__read,__spreadArray}from"tslib";import{innerFrom}from"../observable/innerFrom";import{Subject}from"../Subject";import{SafeSubscriber}from"../Subscriber";import{operate}from"../util/lift";function share(e){var r=(e=void 0===e?{}:e).connector,l=void 0===r?function(){return new Subject}:r,r=e.resetOnError,d=void 0===r||r,r=e.resetOnComplete,m=void 0===r||r,r=e.resetOnRefCountZero,p=void 0===r||r;return function(e){function o(){var e=t;a(),null!=e&&e.unsubscribe()}var t,i,u,c=0,s=!1,b=!1,f=function(){null!=i&&i.unsubscribe(),i=void 0},a=function(){f(),t=u=void 0,s=b=!1};return operate(function(e,r){c++,b||s||f();var n=u=null!=u?u:l();r.add(function(){0!==--c||b||s||(i=handleReset(o,p))}),n.subscribe(r),!t&&0<c&&(t=new SafeSubscriber({next:function(e){return n.next(e)},error:function(e){b=!0,f(),i=handleReset(a,d,e),n.error(e)},complete:function(){s=!0,f(),i=handleReset(a,m),n.complete()}}),innerFrom(e).subscribe(t))})(e)}}function handleReset(e,r){for(var n,o=[],t=2;t<arguments.length;t++)o[t-2]=arguments[t];if(!0===r)e();else if(!1!==r)return n=new SafeSubscriber({next:function(){n.unsubscribe(),e()}}),innerFrom(r.apply(void 0,__spreadArray([],__read(o)))).subscribe(n)}export{share};