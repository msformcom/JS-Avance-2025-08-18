import{__extends}from"tslib";import{Subject}from"./Subject";import{dateTimestampProvider}from"./scheduler/dateTimestampProvider";var ReplaySubject=(f=>{function i(i,e,t){void 0===i&&(i=1/0),void 0===e&&(e=1/0),void 0===t&&(t=dateTimestampProvider);var r=f.call(this)||this;return r._bufferSize=i,r._windowTime=e,r._timestampProvider=t,r._buffer=[],r._infiniteTimeWindow=!0,r._infiniteTimeWindow=e===1/0,r._bufferSize=Math.max(1,i),r._windowTime=Math.max(1,e),r}return __extends(i,f),i.prototype.next=function(i){var e=this,t=e.isStopped,r=e._buffer,o=e._infiniteTimeWindow,n=e._timestampProvider,e=e._windowTime;t||(r.push(i),o)||r.push(n.now()+e),this._trimBuffer(),f.prototype.next.call(this,i)},i.prototype._subscribe=function(i){this._throwIfClosed(),this._trimBuffer();for(var e=this._innerSubscribe(i),t=this._infiniteTimeWindow,r=this._buffer.slice(),o=0;o<r.length&&!i.closed;o+=t?1:2)i.next(r[o]);return this._checkFinalizedStatuses(i),e},i.prototype._trimBuffer=function(){var i=this,e=i._bufferSize,t=i._timestampProvider,r=i._buffer,i=i._infiniteTimeWindow,o=(i?1:2)*e;if(e<1/0&&o<r.length&&r.splice(0,r.length-o),!i){for(var n=t.now(),f=0,s=1;s<r.length&&r[s]<=n;s+=2)f=s;f&&r.splice(0,f+1)}},i})(Subject);export{ReplaySubject};