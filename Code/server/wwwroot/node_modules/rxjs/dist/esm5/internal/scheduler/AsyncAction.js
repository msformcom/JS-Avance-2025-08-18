import{__extends}from"tslib";import{Action}from"./Action";import{intervalProvider}from"./intervalProvider";import{arrRemove}from"../util/arrRemove";var AsyncAction=(r=>{function t(t,e){var i=r.call(this,t,e)||this;return i.scheduler=t,i.work=e,i.pending=!1,i}return __extends(t,r),t.prototype.schedule=function(t,e){var i;return void 0===e&&(e=0),this.closed||(this.state=t,t=this.id,i=this.scheduler,null!=t&&(this.id=this.recycleAsyncId(i,t,e)),this.pending=!0,this.delay=e,this.id=null!=(t=this.id)?t:this.requestAsyncId(i,this.id,e)),this},t.prototype.requestAsyncId=function(t,e,i){return void 0===i&&(i=0),intervalProvider.setInterval(t.flush.bind(t,this),i)},t.prototype.recycleAsyncId=function(t,e,i){if(null!=(i=void 0===i?0:i)&&this.delay===i&&!1===this.pending)return e;null!=e&&intervalProvider.clearInterval(e)},t.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;t=this._execute(t,e);if(t)return t;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(t,e){var i,r=!1;try{this.work(t)}catch(t){r=!0,i=t||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),i},t.prototype.unsubscribe=function(){var t,e,i;this.closed||(t=this.id,i=(e=this.scheduler).actions,this.work=this.state=this.scheduler=null,this.pending=!1,arrRemove(i,this),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null,r.prototype.unsubscribe.call(this))},t})(Action);export{AsyncAction};