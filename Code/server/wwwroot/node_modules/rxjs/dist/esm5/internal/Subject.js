import{__extends,__values}from"tslib";import{Observable}from"./Observable";import{Subscription,EMPTY_SUBSCRIPTION}from"./Subscription";import{ObjectUnsubscribedError}from"./util/ObjectUnsubscribedError";import{arrRemove}from"./util/arrRemove";import{errorContext}from"./util/errorContext";var Subject=(e=>{function r(){var r=e.call(this)||this;return r.closed=!1,r.currentObservers=null,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return __extends(r,e),r.prototype.lift=function(r){var e=new AnonymousSubject(this,this);return e.operator=r,e},r.prototype._throwIfClosed=function(){if(this.closed)throw new ObjectUnsubscribedError},r.prototype.next=function(n){var s=this;errorContext(function(){var e,r;if(s._throwIfClosed(),!s.isStopped){s.currentObservers||(s.currentObservers=Array.from(s.observers));try{for(var t=__values(s.currentObservers),o=t.next();!o.done;o=t.next())o.value.next(n)}catch(r){e={error:r}}finally{try{o&&!o.done&&(r=t.return)&&r.call(t)}finally{if(e)throw e.error}}}})},r.prototype.error=function(e){var t=this;errorContext(function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var r=t.observers;r.length;)r.shift().error(e)}})},r.prototype.complete=function(){var e=this;errorContext(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var r=e.observers;r.length;)r.shift().complete()}})},r.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(r.prototype,"observed",{get:function(){var r;return 0<(null==(r=this.observers)?void 0:r.length)},enumerable:!1,configurable:!0}),r.prototype._trySubscribe=function(r){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,r)},r.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},r.prototype._innerSubscribe=function(r){var e=this,t=this,o=t.hasError,n=t.observers;return o||t.isStopped?EMPTY_SUBSCRIPTION:(this.currentObservers=null,n.push(r),new Subscription(function(){e.currentObservers=null,arrRemove(n,r)}))},r.prototype._checkFinalizedStatuses=function(r){var e=this,t=e.hasError,o=e.isStopped;t?r.error(e.thrownError):o&&r.complete()},r.prototype.asObservable=function(){var r=new Observable;return r.source=this,r},r.create=function(r,e){return new AnonymousSubject(r,e)},r})(Observable),AnonymousSubject=(o=>{function r(r,e){var t=o.call(this)||this;return t.destination=r,t.source=e,t}return __extends(r,o),r.prototype.next=function(r){var e,t;null!=(t=null==(e=this.destination)?void 0:e.next)&&t.call(e,r)},r.prototype.error=function(r){var e,t;null!=(t=null==(e=this.destination)?void 0:e.error)&&t.call(e,r)},r.prototype.complete=function(){var r,e;null!=(e=null==(r=this.destination)?void 0:r.complete)&&e.call(r)},r.prototype._subscribe=function(r){var e;return null!=(e=null==(e=this.source)?void 0:e.subscribe(r))?e:EMPTY_SUBSCRIPTION},r})(Subject);export{Subject,AnonymousSubject};