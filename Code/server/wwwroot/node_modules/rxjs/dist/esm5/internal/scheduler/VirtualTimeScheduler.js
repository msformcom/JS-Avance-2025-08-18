import{__extends}from"tslib";import{AsyncAction}from"./AsyncAction";import{Subscription}from"../Subscription";import{AsyncScheduler}from"./AsyncScheduler";var VirtualTimeScheduler=(r=>{function t(t,e){void 0===e&&(e=1/0);var i=r.call(this,t=void 0===t?VirtualAction:t,function(){return i.frame})||this;return i.maxFrames=e,i.frame=0,i.index=-1,i}return __extends(t,r),t.prototype.flush=function(){for(var t,e,i=this.actions,r=this.maxFrames;(e=i[0])&&e.delay<=r&&(i.shift(),this.frame=e.delay,!(t=e.execute(e.state,e.delay))););if(t){for(;e=i.shift();)e.unsubscribe();throw t}},t.frameTimeFactor=10,t})(AsyncScheduler),VirtualAction=(n=>{function r(t,e,i){void 0===i&&(i=t.index+=1);var r=n.call(this,t,e)||this;return r.scheduler=t,r.work=e,r.index=i,r.active=!0,r.index=t.index=i,r}return __extends(r,n),r.prototype.schedule=function(t,e){if(void 0===e&&(e=0),Number.isFinite(e)){if(!this.id)return n.prototype.schedule.call(this,t,e);this.active=!1;var i=new r(this.scheduler,this.work);return this.add(i),i.schedule(t,e)}return Subscription.EMPTY},r.prototype.requestAsyncId=function(t,e,i){this.delay=t.frame+(i=void 0===i?0:i);i=t.actions;return i.push(this),i.sort(r.sortActions),1},r.prototype.recycleAsyncId=function(t,e,i){void 0===i&&(i=0)},r.prototype._execute=function(t,e){if(!0===this.active)return n.prototype._execute.call(this,t,e)},r.sortActions=function(t,e){return t.delay===e.delay?t.index===e.index?0:t.index>e.index?1:-1:t.delay>e.delay?1:-1},r})(AsyncAction);export{VirtualTimeScheduler,VirtualAction};