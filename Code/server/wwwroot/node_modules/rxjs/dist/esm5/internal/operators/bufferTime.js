import{__values}from"tslib";import{Subscription}from"../Subscription";import{operate}from"../util/lift";import{createOperatorSubscriber}from"./OperatorSubscriber";import{arrRemove}from"../util/arrRemove";import{asyncScheduler}from"../scheduler/async";import{popScheduler}from"../util/args";import{executeSchedule}from"../util/executeSchedule";function bufferTime(o){for(var r,e=[],u=1;u<arguments.length;u++)e[u-1]=arguments[u];var i=null!=(r=popScheduler(e))?r:asyncScheduler,l=null!=(r=e[0])?r:null,a=e[1]||1/0;return operate(function(r,u){var c=[],t=!1,f=function(r){var e=r.buffer;r.subs.unsubscribe(),arrRemove(c,r),u.next(e),t&&n()},n=function(){var r,e;c&&(r=new Subscription,u.add(r),c.push(e={buffer:[],subs:r}),executeSchedule(r,i,function(){return f(e)},o))},e=(null!==l&&0<=l?executeSchedule(u,i,n,l,!0):t=!0,n(),createOperatorSubscriber(u,function(r){var e,u,t=c.slice();try{for(var n=__values(t),o=n.next();!o.done;o=n.next()){var i=o.value,l=i.buffer;l.push(r),a<=l.length&&f(i)}}catch(r){e={error:r}}finally{try{o&&!o.done&&(u=n.return)&&u.call(n)}finally{if(e)throw e.error}}},function(){for(;null!=c&&c.length;)u.next(c.shift().buffer);null!=e&&e.unsubscribe(),u.complete(),u.unsubscribe()},void 0,function(){return c=null}));r.subscribe(e)})}export{bufferTime};