import{innerFrom}from"../observable/innerFrom";import{Subject}from"../Subject";import{SafeSubscriber}from"../Subscriber";import{operate}from"../util/lift";function share(e={}){let{connector:a=()=>new Subject,resetOnError:f=!0,resetOnComplete:p=!0,resetOnRefCountZero:S=!0}=e;return e=>{let t,o,s,i=0,u=!1,b=!1,l=()=>{null!=o&&o.unsubscribe(),o=void 0},c=()=>{l(),t=s=void 0,u=b=!1},m=()=>{var e=t;c(),null!=e&&e.unsubscribe()};return operate((e,r)=>{i++,b||u||l();let n=s=null!=s?s:a();r.add(()=>{0!==--i||b||u||(o=handleReset(m,S))}),n.subscribe(r),!t&&0<i&&(t=new SafeSubscriber({next:e=>n.next(e),error:e=>{b=!0,l(),o=handleReset(c,f,e),n.error(e)},complete:()=>{u=!0,l(),o=handleReset(c,p),n.complete()}}),innerFrom(e).subscribe(t))})(e)}}function handleReset(r,n,...t){if(!0===n)r();else if(!1!==n){let e=new SafeSubscriber({next:()=>{e.unsubscribe(),r()}});return innerFrom(n(...t)).subscribe(e)}}export{share};