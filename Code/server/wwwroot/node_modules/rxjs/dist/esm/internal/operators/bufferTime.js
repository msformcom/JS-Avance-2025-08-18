import{Subscription}from"../Subscription";import{operate}from"../util/lift";import{createOperatorSubscriber}from"./OperatorSubscriber";import{arrRemove}from"../util/arrRemove";import{asyncScheduler}from"../scheduler/async";import{popScheduler}from"../util/args";import{executeSchedule}from"../util/executeSchedule";function bufferTime(s,...e){let r,u,f=null!=(r=popScheduler(e))?r:asyncScheduler,b=null!=(u=e[0])?u:null,n=e[1]||1/0;return operate((e,t)=>{let l=[],o=!1,i=e=>{var{buffer:r,subs:u}=e;u.unsubscribe(),arrRemove(l,e),t.next(r),o&&c()},c=()=>{if(l){var r=new Subscription,u=(t.add(r),[]);let e={buffer:u,subs:r};l.push(e),executeSchedule(r,f,()=>i(e),s)}},r=(null!==b&&0<=b?executeSchedule(t,f,c,b,!0):o=!0,c(),createOperatorSubscriber(t,e=>{var r;for(r of l.slice()){var u=r.buffer;u.push(e),n<=u.length&&i(r)}},()=>{for(;null!=l&&l.length;)t.next(l.shift().buffer);null!=r&&r.unsubscribe(),t.complete(),t.unsubscribe()},void 0,()=>l=null));e.subscribe(r)})}export{bufferTime};