import{Subject}from"../Subject";import{asyncScheduler}from"../scheduler/async";import{Subscription}from"../Subscription";import{operate}from"../util/lift";import{createOperatorSubscriber}from"./OperatorSubscriber";import{arrRemove}from"../util/arrRemove";import{popScheduler}from"../util/args";import{executeSchedule}from"../util/executeSchedule";function windowTime(s,...e){let r,u,p=null!=(r=popScheduler(e))?r:asyncScheduler,m=null!=(u=e[0])?u:null,b=e[1]||1/0;return operate((e,o)=>{let t=[],i=!1,c=e=>{var{window:r,subs:u}=e;r.complete(),u.unsubscribe(),arrRemove(t,e),i&&l()},l=()=>{if(t){var r=new Subscription,u=(o.add(r),new Subject);let e={window:u,subs:r,seen:0};t.push(e),o.next(u.asObservable()),executeSchedule(r,p,()=>c(e),s)}},u=(null!==m&&0<=m?executeSchedule(o,p,l,m,!0):i=!0,l(),e=>t.slice().forEach(e)),n=r=>{u(({window:e})=>r(e)),r(o),o.unsubscribe()};return e.subscribe(createOperatorSubscriber(o,r=>{u(e=>{e.window.next(r),b<=++e.seen&&c(e)})},()=>n(e=>e.complete()),r=>n(e=>e.error(r)))),()=>{t=null}})}export{windowTime};